import{j as e,r as c}from"./index-CdvnMJDF.js";import{g as U}from"./Evidence-pcqnr397.js";import{S as w}from"./Select-DZj4XGu3.js";import{ae as _,af as P,R as M,ag as L,J as H}from"./Views-CxF1MRNz.js";import"./FormContainer-grfML9lp.js";import{E as z,q,x as T}from"./Tag-CxkAlyD2.js";import{I as v,B as F}from"./hoist-non-react-statics.cjs-sUaFkZ5N.js";import{b as $,e as B}from"./Upload-BfnOvjia.js";import"./toast-BcWTRMKr.js";import{S as K,h as W}from"./html2canvas.esm-DPU3DTfn.js";const Y=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"SECTION 7 : CONFIRMATION AND ACKNOWLEDGEMENTS"})})})}),G=({submittedEvidence:s})=>{if(!s||s.length===0)return e.jsx("p",{className:"text-gray-500",children:"No submitted evidence available."});const r=async t=>{try{const i=(await U(t)).data,o=URL.createObjectURL(i);window.open(o,"_blank")}catch(a){console.error("Error fetching evidence data:",a)}};return e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-800 font-semibold mb-1.5 block",children:"Submitted Evidence:"}),e.jsx("div",{className:"flex flex-col gap-4",children:s.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-md",children:[e.jsx("span",{className:"text-blue-600 underline max-w-[250px] truncate cursor-pointer",onClick:()=>r(t.evidence_id),children:t.evidence_id}),e.jsx("div",{className:"flex-1 text-right",children:e.jsxs("p",{className:"text-gray-500 text-sm",children:[e.jsx("strong",{children:"Created:"})," ",new Date(t.created_at).toLocaleDateString()]})})]},t.id))})]})},J=({evidenceList:s=[],onChange:r})=>{const[t,a]=c.useState(!1),[i,o]=c.useState([]),m=Array.isArray(s)?s.map(l=>({label:l.name,value:l.evidence_id})):[],u=l=>{i.some(x=>x.value===l.evidence_id)||o(x=>[...x,{label:l.name,value:l.evidence_id}]),a(!1)},d=l=>{var x;const g=((x=l.split(".").pop())==null?void 0:x.toLowerCase())||"";return["jpg","jpeg","png","gif"].includes(g)?e.jsx(z,{className:"w-8 h-8 text-blue-600"}):g==="pdf"?e.jsx(q,{className:"w-8 h-8 text-red-600"}):["xls","xlsx"].includes(g)?e.jsx(T,{className:"w-8 h-8 text-green-600"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})};return c.useEffect(()=>{const l=i.map(g=>g.value);r(l)},[i,r]),e.jsxs("div",{className:"w-full sm:w-1/2 mb-4",children:[e.jsx("label",{className:"text-gray-800 font-semibold mb-1.5 block",children:"Evidence Information:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsx(w,{isMulti:!0,placeholder:"Please Select",className:"w-full flex-1",options:m,value:i,onChange:o}),e.jsx(_,{className:"w-6 h-6 text-gray-500 hover:text-gray-700 cursor-pointer mt-1 sm:mt-0",onClick:()=>a(!0)}),e.jsx($,{title:"Evidence Details",isOpen:t,width:500,onClose:()=>a(!1),onRequestClose:()=>a(!1),children:e.jsx("div",{className:"space-y-4 p-4 max-w-full",children:Array.isArray(s)&&s.map(l=>e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-100 border-blue-500 flex flex-col sm:flex-row justify-between items-start sm:items-center cursor-pointer hover:bg-blue-50",onClick:()=>u(l),children:[e.jsxs("div",{className:"space-y-1 w-full sm:w-3/4",children:[e.jsx("h4",{className:"font-semibold text-lg",children:l.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:l.description}),e.jsx("a",{href:l.file_path,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline mt-2 block text-sm font-bold",children:"View File"})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-4",children:d(l.file_path)})]},l.id))})})]})]})},X=({comments:s,onAppraiseeCommentChange:r,showValidationError:t,commentInputRef:a})=>{var u;const[i,o]=c.useState("");c.useEffect(()=>{const d=s.staff.comment||"";o(d),r(d)},[s.staff.comment,r]);const m=d=>{const l=d.target.value;o(l),r(l)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Appraisee's Comments:"}),e.jsx(v,{required:!0,ref:a,textArea:!0,value:i,placeholder:"Enter your comments here",className:`textarea mt-2 w-full rounded-md border px-3 py-2 focus:outline-none ${t&&!i?"border-red-500":"border-gray-300"}`,onChange:m}),t&&!i&&e.jsxs("div",{className:"flex items-center text-red-500 mt-1",children:[e.jsx(P,{className:"mr-1"}),"This field is required."]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Appraiser's Comments:"}),e.jsx(v,{disabled:!0,textArea:!0,value:s.supervisor.comment||"",className:"input-textarea mt-2"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Countersigning Officer's Comments:"}),e.jsx(v,{disabled:!0,textArea:!0,value:((u=s.officer)==null?void 0:u.comment)||"",className:"input-textarea mt-2"})]})]})},S=[{value:1,label:"Agree"},{value:0,label:"Disagree"}],Q=({Staff:s,onChange:r,officeDeclaration:t,supervisorDeclaration:a})=>{const[i,o]=c.useState(null),[m,u]=c.useState(null),[d,l]=c.useState(null),[g,x]=c.useState(null),[y,j]=c.useState(!1),[b,p]=c.useState(0),N=c.useRef(null),f=c.useRef(null),C=c.useRef(null);c.useEffect(()=>{s&&(o(s.declaration),l(s.signature),u(s.date?new Date(s.date):null),p((s.signature,0)))},[s]);const O=n=>{var D;const h=(D=n.target.files)==null?void 0:D[0];if(h){if(h.size>70*1024){alert("File size exceeds 70Kb. Please upload a smaller file.");return}if(!h.type.startsWith("image/")){alert("Invalid file type. Please upload an image.");return}const A=new FileReader;A.onloadend=()=>{const R=A.result;l(R),x(h.name),p(1)},A.readAsDataURL(h)}},k=()=>{j(!0)},E=async()=>{if(f.current&&!f.current.isEmpty()){if(C.current){const h=(await W(C.current)).toDataURL("image/png");l(h),p(1),j(!1)}}else alert("Please draw a signature before saving.")},I=()=>{var n;(n=f.current)==null||n.clear()};return c.useEffect(()=>{const n=m!==null?new Date(m.getFullYear(),m.getMonth(),m.getDate()+1):null,h={declaration:i,date:n,flag:b};b===1&&(h.signature=d),r(h)},[i,m,d,b]),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4 items-start mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Appraisee's Declaration:"}),e.jsx(w,{isDisabled:t===1||a===1,placeholder:"Please Select",options:S,className:"mt-2",value:S.find(n=>n.value===i),onChange:n=>o((n==null?void 0:n.value)??null)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Date:"}),e.jsx(B,{disabled:t===1||a===1,className:"mt-2",value:m,onChange:n=>u(n)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold mb-1",children:"Appraisee's Signature:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",disabled:t===1||a===1,className:`flex items-center gap-2 focus:outline-none text-white font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2
                ${t===1||a===1?"bg-gray-400 cursor-not-allowed":"bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300"}`,onClick:k,children:[e.jsx(M,{className:"w-5 h-5"}),"Add Signature"]}),e.jsxs("button",{type:"button",disabled:t===1||a===1,className:`flex items-center gap-2 focus:outline-none text-white font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2
                ${t===1||a===1?"bg-gray-400 cursor-not-allowed":"bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300"}`,onClick:()=>{var n;return(n=N.current)==null?void 0:n.click()},children:[e.jsx(L,{className:"w-5 h-5"}),"Upload"]}),e.jsx("input",{ref:N,type:"file",accept:"image/*",className:"hidden",onChange:O})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Uploaded Image:"}),d&&e.jsx("div",{className:"border border-gray-400 p-2 rounded-md mt-2 w-50 h-44 flex items-center justify-center",children:e.jsx("img",{src:d,alt:"Uploaded Preview",className:"h-full w-full object-fill rounded-md"})})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Draw Your Signature"}),e.jsx("button",{onClick:()=>j(!1),children:e.jsx(H,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{ref:C,className:" rounded-md mt-4 bg-white",children:e.jsx(K,{ref:f,canvasProps:{width:330,height:150,className:"sigCanvas"}})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(F,{size:"sm",variant:"default",onClick:I,children:"Clear"}),e.jsx(F,{size:"sm",variant:"solid",onClick:E,children:"Save"})]})]})})]})},V=({Supervisor:s})=>{const r=[{value:1,label:"Agree"},{value:0,label:"Disagree"}],t=r.find(a=>a.value===(s==null?void 0:s.declaration));return e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"bg-gray-400 h-0.5"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"flex flex-col order-1",children:[e.jsx("label",{htmlFor:"declaration",className:"text-gray-800 font-semibold",children:"Appraiser's Declaration:"}),e.jsx(w,{isDisabled:!0,id:"declaration",value:t,options:r,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col order-2",children:[e.jsx("label",{htmlFor:"date",className:"text-gray-800 font-semibold",children:"Date:"}),e.jsx(v,{disabled:!0,id:"date",value:(s==null?void 0:s.date)||"",className:"mt-2"})]}),e.jsx("div",{className:"order-3",children:e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold",children:"Appraiser's Signature:"})}),e.jsxs("div",{className:"flex flex-col order-4",children:[e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold underline",children:"Signatured by Appraiser"}),e.jsx("div",{id:"signature",className:"border border-gray-300 p-2 rounded-md mt-2 w-full h-35 flex items-center justify-center",children:s!=null&&s.signature?e.jsx("img",{src:s.signature,alt:"Appraiser's Signature",className:"h-full w-full rounded-md object-contain"}):e.jsx("span",{className:"text-gray-400",children:"No Signature"})})]})]})]})},Z=({officer:s})=>{const r=[{value:1,label:"Agree"},{value:0,label:"Disagree"}],t=r.find(a=>a.value===(s==null?void 0:s.declaration));return e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"bg-gray-400 h-0.5"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"flex flex-col order-1",children:[e.jsx("label",{htmlFor:"declaration",className:"text-gray-800 font-semibold",children:"Countersigning Officer's Declaration:"}),e.jsx(w,{isDisabled:!0,id:"declaration",value:t,options:r,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col order-2",children:[e.jsx("label",{htmlFor:"date",className:"text-gray-800 font-semibold",children:"Date:"}),e.jsx(v,{disabled:!0,id:"date",value:(s==null?void 0:s.date)||"",className:"mt-2"})]}),e.jsx("div",{className:"order-3",children:e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold",children:"Countersigning Officer's Signature:"})}),e.jsxs("div",{className:"flex flex-col order-4",children:[e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold underline",children:"Signatured by Countersigning Officer's"}),e.jsx("div",{id:"signature",className:"border border-gray-300 p-2 rounded-md mt-2 w-full h-35 flex items-center justify-center",children:s!=null&&s.signature?e.jsx("img",{src:s.signature,alt:"Appraiser's Signature",className:"h-full w-full rounded-md object-contain"}):e.jsx("span",{className:"text-gray-400",children:"No Signature"})})]})]})]})},me=({data:s,commentInputRef:r,setSelectedEvidenceIds:t,setCommentText:a,showValidationError:i,setDeclarationData:o})=>{var m,u,d,l,g,x,y,j,b,p,N,f;return e.jsxs("div",{className:"mt-4",children:[e.jsx(Y,{}),e.jsxs("div",{className:"bg-white p-4",children:[e.jsx("div",{className:"mt-4",children:e.jsx(G,{submittedEvidence:((u=(m=s==null?void 0:s.comments)==null?void 0:m.staff)==null?void 0:u.evidence)||[]})}),e.jsx("div",{className:"mt-4",children:e.jsx(J,{evidenceList:(s==null?void 0:s.evidence_list)||[],onChange:t})}),e.jsx("div",{className:"mt-4",children:e.jsx(X,{commentInputRef:r,comments:{staff:((d=s==null?void 0:s.comments)==null?void 0:d.staff)||{comment:""},supervisor:((l=s==null?void 0:s.comments)==null?void 0:l.supervisor)||{comment:""},officer:((g=s==null?void 0:s.comments)==null?void 0:g.officer)||{comment:""}},showValidationError:i,onAppraiseeCommentChange:a})}),e.jsx("div",{className:"mt-4",children:e.jsx(Q,{Staff:(x=s==null?void 0:s.comments)==null?void 0:x.staff,onChange:o,officeDeclaration:(j=(y=s==null?void 0:s.comments)==null?void 0:y.officer)==null?void 0:j.declaration,supervisorDeclaration:(p=(b=s==null?void 0:s.comments)==null?void 0:b.supervisor)==null?void 0:p.declaration})}),e.jsx("div",{className:"mt-4",children:e.jsx(V,{Supervisor:(N=s==null?void 0:s.comments)==null?void 0:N.supervisor})}),e.jsx("div",{className:"mt-4",children:e.jsx(Z,{officer:(f=s==null?void 0:s.comments)==null?void 0:f.officer})})]})]})};export{me as A};
