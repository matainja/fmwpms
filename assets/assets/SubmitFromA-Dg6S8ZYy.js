import{j as e,r as d,a0 as z,$ as B,p as Te,aM as te,G as ve,a as ue,u as Y,aZ as we,J as Ee,aQ as ke,aR as Fe,a2 as Ie,a_ as $e}from"./index-CdvnMJDF.js";import{S as ce}from"./Select-DZj4XGu3.js";import{ae as oe,af as Re,R as xe,ag as Oe,J as Ae,ah as Pe}from"./Views-CxF1MRNz.js";import"./FormContainer-grfML9lp.js";import{E as Qe,q as Me,x as qe,b as L,C as Le,G as he}from"./Tag-CxkAlyD2.js";import{I as k,B as q}from"./hoist-non-react-statics.cjs-sUaFkZ5N.js";import{b as ie,e as Ye,T as Se}from"./Upload-BfnOvjia.js";import{t as A,N as P}from"./toast-BcWTRMKr.js";import{S as We,h as ze}from"./html2canvas.esm-DPU3DTfn.js";import{g as He}from"./Evidence-pcqnr397.js";import{F as Be,H as Ue,I as Ge}from"./FooterButtonpart-CnewVfW5.js";import{C as Ve,a as Ce,g as Ke}from"./competency-Dsfe_Da9.js";import"./SvgIcon-f57X2RSa.js";import"./index-BE3rFSTS.js";import"./index-CSqXTapl.js";import"./quill.snow-kKRIGMjE.js";import"./cloneDeep-DznBgb_t.js";import"./useThemeClass-jVloYh0I.js";const Je=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"SECTION 7 : CONFIRMATION AND ACKNOWLEDGEMENTS"})})})}),Xe=({evidenceList:t=[],onChange:r})=>{const[n,x]=d.useState(!1),[u,y]=d.useState([]),b=Array.isArray(t)?t.map(j=>({label:j.name,value:j.evidence_id})):[],m=j=>{u.some(N=>N.value===j.evidence_id)||y(N=>[...N,{label:j.name,value:j.evidence_id}]),x(!1)},p=j=>{var N;const S=((N=j.split(".").pop())==null?void 0:N.toLowerCase())||"";return["jpg","jpeg","png","gif"].includes(S)?e.jsx(Qe,{className:"w-8 h-8 text-blue-600"}):S==="pdf"?e.jsx(Me,{className:"w-8 h-8 text-red-600"}):["xls","xlsx"].includes(S)?e.jsx(qe,{className:"w-8 h-8 text-green-600"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})};return d.useEffect(()=>{const j=u.map(S=>S.value);r(j)},[u,r]),e.jsxs("div",{className:"w-full sm:w-1/2 mb-4",children:[e.jsx("label",{className:"text-gray-800 font-semibold mb-1.5 block",children:"Evidence Information:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsx(ce,{isMulti:!0,placeholder:"Please Select",className:"w-full flex-1",options:b,value:u,onChange:y}),e.jsx(oe,{className:"w-6 h-6 text-gray-500 hover:text-gray-700 cursor-pointer mt-1 sm:mt-0",onClick:()=>x(!0)}),e.jsx(ie,{title:"Evidence Details",isOpen:n,width:500,onClose:()=>x(!1),onRequestClose:()=>x(!1),children:e.jsx("div",{className:"space-y-4 p-4 max-w-full",children:Array.isArray(t)&&t.map(j=>e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-100 border-blue-500 flex flex-col sm:flex-row justify-between items-start sm:items-center cursor-pointer hover:bg-blue-50",onClick:()=>m(j),children:[e.jsxs("div",{className:"space-y-1 w-full sm:w-3/4",children:[e.jsx("h4",{className:"font-semibold text-lg",children:j.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:j.description}),e.jsx("a",{href:j.file_path,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline mt-2 block text-sm font-bold",children:"View File"})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-4",children:p(j.file_path)})]},j.id))})})]})]})},Ze=({comments:t,onAppraisersCommentChange:r,showValidationError:n,commentInputRef:x})=>{var m;const[u,y]=d.useState("");d.useEffect(()=>{const p=t.staff.comment||"";y(p),r(p)},[t.staff.comment]);const b=p=>{const j=p.target.value;y(j),r(j)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Appraisee's Comments:"}),e.jsx(k,{textArea:!0,disabled:!0,className:"input-textarea mt-2",value:t.staff.comment||""})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Appraiser's Comments:"}),e.jsx(k,{required:!0,ref:x,textArea:!0,value:u,placeholder:"Enter your comments here",className:`textarea mt-2 w-full rounded-md border px-3 py-2 focus:outline-none ${n&&!u?"border-red-500":"border-gray-300"}`,onChange:b}),n&&!u&&e.jsxs("div",{className:"flex items-center text-red-500 mt-1",children:[e.jsx(Re,{className:"mr-1"}),"This field is required."]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Countersigning Officer's Comments:"}),e.jsx(k,{disabled:!0,textArea:!0,value:((m=t.officer)==null?void 0:m.comment)||"",className:"input-textarea mt-2"})]})]})},et=({Staff:t})=>{const r=[{value:1,label:"Agree"},{value:0,label:"Disagree"}],n=r.find(x=>x.value===(t==null?void 0:t.declaration));return e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"bg-gray-400 h-0.5"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"flex flex-col order-1",children:[e.jsx("label",{htmlFor:"declaration",className:"text-gray-800 font-semibold",children:"Appraisee's Declaration:"}),e.jsx(ce,{isDisabled:!0,id:"declaration",value:n,options:r,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col order-2",children:[e.jsx("label",{htmlFor:"date",className:"text-gray-800 font-semibold",children:"Date:"}),e.jsx(k,{disabled:!0,id:"date",value:(t==null?void 0:t.date)||"",className:"mt-2"})]}),e.jsx("div",{className:"order-3",children:e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold",children:"Appraisee's Signature:"})}),e.jsxs("div",{className:"flex flex-col order-4",children:[e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold underline",children:"Signatured by Appraisee"}),e.jsx("div",{id:"signature",className:"border border-gray-300 p-2 rounded-md mt-2 w-full h-35 flex items-center justify-center",children:t!=null&&t.signature?e.jsx("img",{src:t.signature,alt:"Appraiser's Signature",className:"h-full w-full rounded-md object-contain"}):e.jsx("span",{className:"text-gray-400",children:"No Signature"})})]})]})]})},pe=[{value:1,label:"Agree"},{value:0,label:"Disagree"}],tt=({Supervisor:t,onChange:r,officerDeclaration:n})=>{const[x,u]=d.useState(null),[y,b]=d.useState(null),[m,p]=d.useState(null),[j,S]=d.useState(null),[N,_]=d.useState(!1),[C,w]=d.useState(0),D=d.useRef(null),g=d.useRef(null),h=d.useRef(null);d.useEffect(()=>{t&&(u(t.declaration),p(t.signature),b(t.date?new Date(t.date):null),w((t.signature,0)))},[t]);const o=l=>{var v;const f=(v=l.target.files)==null?void 0:v[0];if(f){if(f.size>70*1024){alert("File size exceeds 70Kb. Please upload a smaller file.");return}if(!f.type.startsWith("image/")){alert("Invalid file type. Please upload an image.");return}const T=new FileReader;T.onloadend=()=>{const F=T.result;p(F),S(f.name),w(1)},T.readAsDataURL(f)}},s=()=>{_(!0)},a=async()=>{if(g.current&&!g.current.isEmpty()){if(h.current){const f=(await ze(h.current)).toDataURL("image/png");p(f),w(1),_(!1)}}else alert("Please draw a signature before saving.")},i=()=>{var l;(l=g.current)==null||l.clear()};return d.useEffect(()=>{const l=y!==null?new Date(y.getFullYear(),y.getMonth(),y.getDate()+1):null,f={declaration:x,date:l,flag:C};C===1&&(f.signature=m),r(f)},[x,y,m,C]),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4 items-start mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Appraiser's Declaration:"}),e.jsx(ce,{isDisabled:n===1,placeholder:"Please Select",options:pe,className:"mt-2",value:pe.find(l=>l.value===x),onChange:l=>u((l==null?void 0:l.value)??null)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Date:"}),e.jsx(Ye,{disabled:n===1,className:"mt-2",value:y,onChange:l=>b(l)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold mb-1",children:"Appraiser's Signature:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",disabled:n===1,className:`flex items-center gap-2 focus:outline-none text-white font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2
                ${n===1?"bg-gray-400 cursor-not-allowed":"bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300"}`,onClick:s,children:[e.jsx(xe,{className:"w-5 h-5"}),"Add Signature"]}),e.jsxs("button",{type:"button",disabled:n===1,className:`flex items-center gap-2 focus:outline-none text-white font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2
                ${n===1?"bg-gray-400 cursor-not-allowed":"bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300"}`,onClick:()=>{var l;return(l=D.current)==null?void 0:l.click()},children:[e.jsx(Oe,{className:"w-5 h-5"}),"Upload"]}),e.jsx("input",{ref:D,type:"file",accept:"image/*",className:"hidden",onChange:o})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Uploaded Image:"}),m&&e.jsx("div",{className:"border border-gray-400 p-2 rounded-md mt-2 w-50 h-44 flex items-center justify-center",children:e.jsx("img",{src:m,alt:"Uploaded Preview",className:"h-full w-full object-fill rounded-md"})})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Draw Your Signature"}),e.jsx("button",{onClick:()=>_(!1),children:e.jsx(Ae,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{ref:h,className:" rounded-md mt-4 bg-white",children:e.jsx(We,{ref:g,canvasProps:{width:330,height:150,className:"sigCanvas "}})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(q,{size:"sm",variant:"default",onClick:i,children:"Clear"}),e.jsx(q,{size:"sm",variant:"solid",onClick:a,children:"Save"})]})]})})]})},st=({officer:t})=>{const r=[{value:1,label:"Agree"},{value:0,label:"Disagree"}],n=r.find(x=>x.value===(t==null?void 0:t.declaration));return e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"bg-gray-400 h-0.5"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"flex flex-col order-1",children:[e.jsx("label",{htmlFor:"declaration",className:"text-gray-800 font-semibold",children:"Countersigning Officer's Declaration:"}),e.jsx(ce,{isDisabled:!0,id:"declaration",value:n,options:r,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col order-2",children:[e.jsx("label",{htmlFor:"date",className:"text-gray-800 font-semibold",children:"Date:"}),e.jsx(k,{disabled:!0,id:"date",value:(t==null?void 0:t.date)||"",className:"mt-2"})]}),e.jsx("div",{className:"order-3",children:e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold",children:"Countersigning Officer's Signature:"})}),e.jsxs("div",{className:"flex flex-col order-4",children:[e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold underline",children:"Signatured by Countersigning Officer's"}),e.jsx("div",{id:"signature",className:"border border-gray-300 p-2 rounded-md mt-2 w-full h-35 flex items-center justify-center",children:t!=null&&t.signature?e.jsx("img",{src:t.signature,alt:"Appraiser's Signature",className:"h-full w-full rounded-md object-contain"}):e.jsx("span",{className:"text-gray-400",children:"No Signature"})})]})]})]})},rt=async(t,r,n,x)=>{try{const u=await z({url:`/supervisor/form_a_comments?department_id=${t}&team_id=${r}&year=${n}&staff_id=${x}`,method:"get"});return console.log(u),u}catch(u){throw console.error("Error fetching information data:",u),u}},at=async t=>{try{const r=await z({url:"/supervisor/form_a_comments",method:"post",data:t});return console.log(r),r}catch(r){throw console.error("Error fetching information data:",r),r}},nt=({submittedEvidence:t})=>{if(!t||t.length===0)return e.jsx("p",{className:"text-gray-500",children:"No submitted evidence available."});const r=async n=>{try{const u=(await He(n)).data,y=URL.createObjectURL(u);window.open(y,"_blank")}catch(x){console.error("Error fetching evidence data:",x)}};return e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-800 font-semibold mb-1.5 block",children:"Submitted Evidence:"}),e.jsx("div",{className:"flex flex-col gap-4",children:t.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-md",children:[e.jsx("span",{className:"text-blue-600 underline max-w-[250px] truncate cursor-pointer",onClick:()=>r(n.evidence_id),children:n.evidence_id}),e.jsx("div",{className:"flex-1 text-right",children:e.jsxs("p",{className:"text-gray-500 text-sm",children:[e.jsx("strong",{children:"Created:"})," ",new Date(n.created_at).toLocaleDateString()]})})]},n.id))})]})},lt=()=>{var i,l,f,v,T,F,H,X,U,se;const{id:t}=B(),r=Te(),[n,x]=d.useState(null),[u,y]=d.useState(!0),[b,m]=d.useState(null),[p,j]=d.useState([]),[S,N]=d.useState(""),[_,C]=d.useState(!1),w=async()=>{try{const Q=localStorage.getItem("selectedDepartmentID")||"",G=localStorage.getItem("selectedTeamID"),V=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),c=await rt(Q,G?Number(G):null,V,String(t));if(c&&c.data)x(c.data);else throw new Error("Invalid response data")}catch(Q){console.error("Error fetching data:",Q),m("Failed to load data. Please try again.")}finally{y(!1)}};d.useEffect(()=>{w()},[]);const[D,g]=d.useState({declaration:null,date:null,signature:null,flag:0}),h=d.useRef(null),o=async()=>{var Q,G,V;if(!S.trim()){C(!0),(Q=h.current)==null||Q.scrollIntoView({behavior:"smooth",block:"center"}),A.push(e.jsx(P,{title:"Error",type:"danger",children:"Appraiser 's Comments is reuired"}),{placement:"top-center"});return}try{const c=D.date instanceof Date?D.date.toISOString().split("T")[0]:null,E={department_id:localStorage.getItem("selectedDepartmentID")||"",team_id:localStorage.getItem("selectedTeamID"),year:localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),evidence_ids:p,comment:S,date:c,signature:D.signature,declaration:D.declaration,flag:D.flag,staff_id:String(t)};(await at(E)).status===200?A.push(e.jsx(P,{title:"Success",type:"success",children:"Data submitted successfully!"}),{placement:"top-center"}):A.push(e.jsx(P,{title:"Error",type:"danger",children:"Unexpected response from the server. Please try again."}),{placement:"top-center"})}catch(c){const E=((V=(G=c.response)==null?void 0:G.data)==null?void 0:V.error)||c.message||"An unexpected error occurred.";A.push(e.jsx(P,{title:"Error",type:"danger",children:E}),{placement:"top-center"}),console.error("Error submitting data:",c)}},s=()=>{r(-1)},a=()=>{r(`/form/supervisor/review/${t}`)};return u?e.jsx("div",{children:"Loading..."}):b?e.jsx("div",{className:"text-red-500",children:b}):e.jsxs("div",{className:"mt-4  mx-auto w-full ",children:[e.jsx(Je,{}),e.jsxs("div",{className:"bg-white p-4",children:[e.jsx("div",{className:"mt-4",children:e.jsx(nt,{submittedEvidence:((l=(i=n==null?void 0:n.comments)==null?void 0:i.staff)==null?void 0:l.evidence)||[]})}),e.jsx("div",{className:"mt-4",children:e.jsx(Xe,{evidenceList:(n==null?void 0:n.evidence_list)||[],onChange:j})}),e.jsx("div",{className:"mt-4",children:e.jsx(Ze,{commentInputRef:h,comments:{staff:((f=n==null?void 0:n.comments)==null?void 0:f.staff)||{comment:""},supervisor:((v=n==null?void 0:n.comments)==null?void 0:v.supervisor)||{comment:""},officer:((T=n==null?void 0:n.comments)==null?void 0:T.officer)||{comment:""}},showValidationError:_,onAppraisersCommentChange:N})}),e.jsx("div",{className:"mt-4",children:e.jsx(et,{Staff:(F=n==null?void 0:n.comments)==null?void 0:F.staff})}),e.jsx("div",{className:"mt-4",children:e.jsx(tt,{Supervisor:(H=n==null?void 0:n.comments)==null?void 0:H.supervisor,onChange:Q=>{g(Q)},officerDeclaration:(U=(X=n==null?void 0:n.comments)==null?void 0:X.officer)==null?void 0:U.declaration})}),e.jsx("div",{className:"mt-4",children:e.jsx(st,{officer:(se=n==null?void 0:n.comments)==null?void 0:se.officer})})]}),e.jsx(Be,{back:"Back",handleBack:s,save:"Save",handleSave:o,next:"Next",handleNext:a})]})},{Tr:be,Th:re,Td:ae,THead:ct,TBody:ot}=L,it=[{grade:"O",description:"Outstanding - 100%",quarter:"Q1",value:"First Quarter"},{grade:"E",description:"Excellent - 90%",quarter:"Q2",value:"Second Quarter"},{grade:"VG",description:"Very Good - 80%",quarter:"Q3",value:"Third Quarter"},{grade:"G",description:"Good - 70%",quarter:"Q4",value:"Fourth Quarter"}],dt=()=>{const[t,r]=d.useState(!1),[n,x]=d.useState(window.innerWidth<=1024);te(b=>b.quaterTab.selectedQuarter),d.useEffect(()=>{const b=()=>{x(window.innerWidth<=1024)};return window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]);const u=()=>{r(!0)},y=()=>{r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"SECTION 3 : EMPLOYEE'S TASKS (70%)"}),e.jsx("div",{className:"flex space-x-2 ml-auto",children:e.jsx(q,{variant:"twoTone",size:"xs",icon:e.jsx(oe,{}),"aria-label":"View Scoring Criteria Values",onClick:u,children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Scoring Criteria Values"})})})]})}),e.jsx(ie,{title:"Vertical Drawer",isOpen:t,placement:"right",width:n?"100%":800,onClose:y,onRequestClose:y,children:e.jsxs(L,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(ct,{children:e.jsxs(be,{className:"bg-gray-100",children:[e.jsx(re,{className:"border border-gray-300 p-2",children:"Grade"}),e.jsx(re,{className:"border border-gray-300 p-2",children:"Description"}),e.jsx(re,{className:"border border-gray-300 p-2",children:"Quarter"}),e.jsx(re,{className:"border border-gray-300 p-2",children:"Value"})]})}),e.jsx(ot,{children:it.map((b,m)=>e.jsxs(be,{children:[e.jsx(ae,{className:"border border-gray-300 p-2",children:b.grade}),e.jsx(ae,{className:"border border-gray-300 p-2",children:b.description}),e.jsx(ae,{className:"border border-gray-300 p-2",children:b.quarter}),e.jsx(ae,{className:"border border-gray-300 p-2",children:b.value})]},m))})]})})]})},mt=async(t,r,n,x)=>{try{return await z({url:`/supervisor/employeetask?department_id=${t}&team_id=${r}&year=${n}&staff_id=${x}`,method:"get"})}catch(u){throw console.error("Error fetching information data:",u),u}},ut=async t=>{try{return await z({url:"supervisor/employeetask",method:"post",data:t})}catch(r){throw console.error("Error saving employee task:",r),r}},{Tr:de,Th:W,Td:$,THead:xt,TBody:gt}=L,ht=({MainData:t})=>{const{id:r}=B(),n=te(g=>g.quaterTab.selectedQuarter),x=Number(localStorage.getItem("selectedTeamID"))||0,u=Number(localStorage.getItem("selectedYear"))||new Date().getFullYear(),y=localStorage.getItem("selectedDepartmentID")||"";console.log(t);const[b,m]=d.useState(t);d.useEffect(()=>{m(t)},[t]),console.log(b);const p=g=>g.reduce((h,o)=>h+Number(S(o.objectiveWeight||"0")),0),j=(g,h,o)=>{const s=g.target.value;if(/^[0-9]*\.?[0-9]*$/.test(s)){const a=[...b];a[h].rows[o].objectiveWeight=s,m(a)}},S=g=>{if(!g||parseFloat(g)===0)return 0;const h=b.reduce((o,s)=>o+s.rows.reduce((a,i)=>a+parseFloat(i.objectiveWeight||"0"),0),0);return h===0?0:70/h*parseFloat(g)},N=b.reduce((g,h)=>g+h.rows.reduce((o,s)=>o+parseFloat(s.objectiveWeight||"0"),0),0),_=b.reduce((g,h)=>g+h.rows.reduce((o,s)=>o+Number(S(s.objectiveWeight||"0")),0),0),C=g=>{const h=[...b];h.splice(g,1),m(h)},w=(g,h)=>{const o=[...b];o[g].rows.splice(h,1),m(o)},D=async()=>{const g=b.map(o=>({kra_name:o.selectedKRA,kra_weight:parseFloat(p(o.rows).toFixed(2)),objective:o.rows.map(s=>({objective_name:s.selectedObjective,objective_weight:parseFloat(s.objectiveWeight),gradeed_weight:parseFloat(S(s.objectiveWeight).toFixed(2)),target:parseFloat(s.target),kpi:s.selectedKPI,unit:s.notes,aggregate:null,quarter_marks:0,target_achieved:0,raw:0,weighted:0}))})),h={department_id:y,staff_id:r,team_id:x,year:u,quater:n,employee_task:g,total_weight:70,total_graded_weight:parseFloat(_.toFixed(2))};console.log("Saved Data:",h);try{(await ut(h)).status===201&&A.push(e.jsx(P,{title:"Success",type:"success",children:"Data saves Successfully"}),{placement:"top-center"})}catch(o){console.error("Error saving data:",o),A.push(e.jsx(P,{title:"Error",type:"danger",children:"Failed to save data. Please try again."}),{placement:"top-center"})}};return e.jsxs("div",{children:[e.jsxs(L,{compact:!0,className:"border border-gray-400 bg-white",children:[e.jsx(xt,{children:e.jsxs(de,{className:"bg-gray-200",children:[e.jsx(W,{className:"border border-gray-400 p-2",children:"S/N"}),e.jsx(W,{className:"border border-gray-400 p-2",children:"Key Result Areas"}),e.jsx(W,{className:"border border-gray-400 p-2",children:"Weight"}),e.jsx(W,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(W,{className:"border border-gray-400 p-2",children:"Weight"}),e.jsx(W,{className:"border border-gray-400 p-2",children:"Grade Weight"}),e.jsx(W,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(W,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(W,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsxs(gt,{children:[b.map((g,h)=>g.rows.map((o,s)=>e.jsxs(de,{children:[s===0&&e.jsxs(e.Fragment,{children:[e.jsxs($,{className:"border border-gray-400",rowSpan:g.rows.length,children:[g.serialNumber||h+1,e.jsx(Ve,{className:"text-xl text-red-600 cursor-pointer",onClick:()=>C(h)})]}),e.jsx($,{className:"border border-gray-400",rowSpan:g.rows.length,children:g.selectedKRA}),e.jsx($,{className:"border border-gray-400",rowSpan:g.rows.length,children:p(g.rows).toFixed(2)})]}),e.jsxs($,{className:"border border-gray-400",children:[g.rows.length>2&&e.jsx(Ce,{className:"text-xl text-red-600 cursor-pointer m-auto",onClick:()=>w(h,s)}),e.jsx(k,{textArea:!0,value:o.selectedObjective,onChange:a=>{const i=[...b];i[h].rows[s].selectedObjective=a.target.value,m(i)}})]}),e.jsx($,{className:"border border-gray-400",children:e.jsx(k,{className:"w-full",value:o.objectiveWeight,onChange:a=>j(a,h,s)})}),e.jsx($,{className:"border border-gray-400 text-center",children:S(o.objectiveWeight).toFixed(2)}),e.jsx($,{className:"border border-gray-400",children:e.jsx(k,{value:o.target,onChange:a=>{const i=a.target.value;if(/^\d*\.?\d*$/.test(i)){const l=[...b];l[h].rows[s].target=i,m(l)}}})}),e.jsx($,{className:"border border-gray-400",children:e.jsx(k,{textArea:!0,value:o.selectedKPI,onChange:a=>{const i=[...b];i[h].rows[s].selectedKPI=a.target.value,m(i)}})}),e.jsx($,{className:"border border-gray-400",children:e.jsx(k,{textArea:!0,value:o.notes,onChange:a=>{const i=[...b];i[h].rows[s].notes=a.target.value,m(i)}})})]},`${h}-${s}`))),e.jsxs(de,{children:[e.jsx($,{className:"border border-gray-400 text-center",colSpan:2,children:"Total"}),e.jsx($,{className:"border border-gray-400 text-center",children:"70"}),e.jsx($,{className:"border border-gray-400 text-center"}),e.jsx($,{className:"border border-gray-400 text-center",children:N.toFixed(2)}),e.jsx($,{className:"border border-gray-400 text-center",children:_.toFixed(2)}),e.jsx($,{className:"border border-gray-400 text-center",colSpan:3})]})]})]}),e.jsx("div",{className:"text-right mt-4",children:e.jsx(q,{variant:"solid",color:"green-700",onClick:D,children:"Save"})})]})},pt=()=>{const t=te(N=>N.quaterTab.selectedQuarter);console.log("Selected Quarter:",t);const{id:r}=B(),[n,x]=d.useState(!0),[u,y]=d.useState(null),[b,m]=d.useState({1:[],2:[],3:[],4:[]}),p=d.useCallback(async()=>{x(!0),y(null);try{const N=localStorage.getItem("selectedDepartmentID"),_=localStorage.getItem("selectedTeamID"),C=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),w=await mt(N,_?Number(_):null,C,r);m(w.data||{})}catch(N){console.error("Error fetching data:",N),y("Failed to load data. Please try again.")}finally{x(!1)}},[r]);d.useEffect(()=>{r&&p()},[p,r]);const S=(b[t]||[]).map((N,_)=>({serialNumber:_+1,selectedKRA:N.kra_name,rows:N.objectives.map(C=>({selectedObjective:C.objective_name,objectiveWeight:C.objective_weight.toString(),target:C.target.toString(),selectedKPI:C.kpi,notes:C.unit}))}));return console.log("Transformed Data:",S),e.jsxs("div",{className:"mt-4",children:[e.jsx(dt,{}),e.jsx(ht,{MainData:S})]})},bt=async(t,r,n,x)=>{try{return await z({url:`/supervisor/competencies?department_id=${t}&team_id=${r}&year=${n}&staff_id=${x}`,method:"get"})}catch(u){throw console.error("Error fetching information data:",u),u}},jt=async t=>{try{return await z({url:"supervisor/competencies",method:"post",data:t})}catch(r){throw console.error("Error fetching information data:",r),r}};function me(t){return ve({attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 3c-4.963 0-9 4.038-9 9s4.037 9 9 9 9-4.038 9-9-4.037-9-9-9zm0 16c-3.859 0-7-3.14-7-7s3.141-7 7-7 7 3.14 7 7-3.141 7-7 7zM12.707 12l2.646-2.646c.194-.194.194-.512 0-.707-.195-.194-.513-.194-.707 0l-2.646 2.646-2.646-2.647c-.195-.194-.513-.194-.707 0-.195.195-.195.513 0 .707l2.646 2.647-2.646 2.646c-.195.195-.195.513 0 .707.097.098.225.147.353.147s.256-.049.354-.146l2.646-2.647 2.646 2.646c.098.098.226.147.354.147s.256-.049.354-.146c.194-.194.194-.512 0-.707l-2.647-2.647z"},child:[]}]})(t)}function ft(t){return ve({attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16.972 6.251c-.967-.538-2.185-.188-2.72.777l-3.713 6.682-2.125-2.125c-.781-.781-2.047-.781-2.828 0-.781.781-.781 2.047 0 2.828l4 4c.378.379.888.587 1.414.587l.277-.02c.621-.087 1.166-.46 1.471-1.009l5-9c.537-.966.189-2.183-.776-2.72z"},child:[]}]})(t)}const{Tr:Z,Th:K,Td:O,THead:yt,TBody:Nt}=L,vt=({loading:t,allQuarterData:r,onCopy:n,isConfirmed:x,updateAllCompetencyData:u})=>{const{id:y}=B(),b=ue(),m=Y(o=>o.quaterTab.selectedQuarter),p=Y(o=>o.competency.isEditing),j=()=>{const o=parseInt(m);if(o===1)return;const s=(o-1).toString(),a=r[s];if(!a||a.length===0){alert(`No data available in Q${s} to copy`);return}const i=JSON.parse(JSON.stringify(a));n(m,i),alert(`Data copied from Q${s} to Q${m}`)},S=()=>!t&&r[m].length===0&&parseInt(m)>1,N=(o,s)=>{const a=[...r[m]],i={...a[o]},l=i.competencies_details.filter((f,v)=>v!==s);l.length===0?a.splice(o,1):(i.competencies_details=l,a[o]=i),u&&u(m,a)},_=(o,s,a,i)=>{const l=[...r[m]],f={...l[o]},v=[...f.competencies_details||[]];if(!v[s])return;const T={...v[s]};if(i==="")T[a]=0;else{const X=Number(i);T[a]=X}const{min_score:F,max_score:H}=T;if(F<0||F>4){A.push(e.jsx(P,{title:"Validation Error",type:"danger",children:"Min Score must be between 0 and 4"}),{placement:"top-center"});return}if(H<1||H>5){A.push(e.jsx(P,{title:"Validation Error",type:"danger",children:"Max Score must be between 1 and 5"}),{placement:"top-center"});return}if(H<=F){A.push(e.jsx(P,{title:"Validation Error",type:"danger",children:"Max Score must be greater than Min Score"}),{placement:"top-center"});return}v[s]=T,f.competencies_details=v,l[o]=f,u&&u(m,l)},C=(o,s,a,i)=>{const l=[...r[m]],f={...l[o]};if(a==="competencies")f.competencies=i;else{const v=[...f.competencies_details||[]];v[s]&&(v[s]={...v[s],[a]:i}),f.competencies_details=v}l[o]=f,u&&u(m,l)},w=r[m].reduce((o,s)=>o+s.competencies_details.reduce((a,i)=>a+Number(i.min_score),0),0),D=r[m].reduce((o,s)=>o+s.competencies_details.reduce((a,i)=>a+Number(i.max_score),0),0),g=D>0?20*w/D:0,h=async()=>{b(we(!1));const o=localStorage.getItem("selectedDepartmentID")||"",s=localStorage.getItem("selectedTeamID"),a=localStorage.getItem("selectedYear")||new Date().getFullYear().toString(),i=m,l=r[m],f=l.map(T=>({competencies_name:T.competencies,details:T.competencies_details.map(F=>({cluster:F.cluster,sub_cluster:F.sub_cluster,describe_expectations:F.describe_expectations,min_score:Number(F.min_score),max_score:Number(F.max_score),quarter_marks:0}))})),v={department_id:o,staff_id:y,team_id:s?Number(s):null,year:Number(a),quater:Number(i),data:f,total_max_score:20,total_min_score:g};try{(await jt(v)).status===201&&(A.push(e.jsx(P,{title:"Success",type:"success",children:"Data saved successfully"}),{placement:"top-center"}),u&&u(m,l))}catch(T){console.error("Error saving data:",T),A.push(e.jsx(P,{title:"Error",type:"danger",children:"Failed to save data. Please try again."}),{placement:"top-center"})}};return e.jsxs("div",{children:[e.jsxs(L,{compact:!0,className:"w-full border border-gray-400 bg-white",children:[e.jsx(yt,{children:e.jsxs(Z,{className:"bg-gray-200",children:[e.jsx(K,{className:"border text-center w-[5%]",children:"Action"}),e.jsx(K,{className:"border",children:"Competency"}),e.jsx(K,{className:"border",children:"Cluster"}),e.jsx(K,{className:"border",children:"Sub Cluster"}),e.jsx(K,{className:"border",children:"Description"}),e.jsx(K,{className:"border text-center w-[8%]",children:"Min"}),e.jsx(K,{className:"border text-center w-[8%]",children:"Max"})]})}),e.jsxs(Nt,{children:[t?e.jsx(Z,{children:e.jsx(O,{colSpan:7,className:"text-center py-4 text-blue-500",children:"Loading..."})}):S()?e.jsx(Z,{children:e.jsx(O,{colSpan:7,className:"text-center py-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("span",{className:"text-black font-semibold text-lg mb-3",children:["No data for Q",m,". Copy from Q",parseInt(m)-1,"?"]}),e.jsxs(q,{className:"w-64",onClick:j,children:["Copy from Q",parseInt(m)-1]})]})})}):r[m].length===0?e.jsx(Z,{children:e.jsx(O,{colSpan:7,className:"text-center py-4",children:e.jsxs("span",{className:"text-black font-semibold text-lg",children:["No data available for Q",m]})})}):r[m].map((o,s)=>o.competencies_details.map((a,i)=>e.jsxs(Z,{children:[e.jsx(O,{className:"text-center border",children:p?e.jsx("button",{className:"text-red-500 text-xl",onClick:()=>N(s,i),children:e.jsx(me,{})}):x(o)?e.jsx("span",{className:"text-green-600 text-xl",children:e.jsx(ft,{})}):null}),e.jsx(O,{className:"px-2 py-1 border",children:p?e.jsx(k,{value:o.competencies,className:"w-full",onChange:l=>C(s,i,"competencies",l.target.value)}):o.competencies}),e.jsx(O,{className:"border",children:p?e.jsx(k,{textArea:!0,value:a.cluster,className:"w-full",onChange:l=>C(s,i,"cluster",l.target.value)}):a.cluster}),e.jsx(O,{className:"border",children:p?e.jsx(k,{textArea:!0,value:a.sub_cluster,className:"w-full",onChange:l=>C(s,i,"sub_cluster",l.target.value)}):a.sub_cluster}),e.jsx(O,{className:"border",children:p?e.jsx(k,{textArea:!0,value:a.describe_expectations,className:"w-full",onChange:l=>C(s,i,"describe_expectations",l.target.value)}):a.describe_expectations}),e.jsx(O,{className:"text-center border",children:p?e.jsx(k,{value:a.min_score.toString(),className:"text-center",onChange:l=>_(s,i,"min_score",l.target.value)}):a.min_score}),e.jsx(O,{className:"text-center border",children:p?e.jsx(k,{value:a.max_score.toString(),className:"text-center",onChange:l=>_(s,i,"max_score",l.target.value)}):a.max_score})]},`${o.id}-${a.id}`))),e.jsxs(Z,{className:"bg-gray-200",children:[e.jsx(O,{className:"text-center",colSpan:5,children:"Total"}),e.jsx(O,{className:"text-center border",children:g.toFixed(2)}),e.jsx(O,{className:"text-center border",children:"20"})]})]})]}),e.jsx("div",{className:"text-right mt-4",children:e.jsx(q,{variant:"solid",color:"green-700",onClick:h,children:"Save"})})]})},wt=({onClose:t,onConfirm:r})=>{var V;const n=te(c=>c.quaterTab.selectedQuarter),[x,u]=d.useState([]),[y,b]=d.useState(!0),[m,p]=d.useState(null),[j,S]=d.useState([]),[N,_]=d.useState(""),[C,w]=d.useState(""),[D,g]=d.useState(""),[h,o]=d.useState(""),[s,a]=d.useState(!0),[i,l]=d.useState(!1),f=async()=>{b(!0),p(null);try{const c=await Ke();u(c.data||[])}catch(c){console.error("Error fetching data:",c),p("Failed to load data. Please try again.")}finally{b(!1)}};d.useEffect(()=>{f()},[]);const v=()=>{N&&(S(c=>[...c,{competency:N,subcategory:C||"",title:D||"",description:h||"",isCustom:!1}]),_(""),w(""),g(""),o(""),a(!0))},T=()=>{i||(S(c=>[...c,{competency:"",subcategory:"",title:"",description:"",isCustom:!0}]),l(!0),setTimeout(()=>l(!1),3e3))},F=c=>{_(c),w(""),g(""),o(""),a(!c)},H=c=>{w(c),g(""),o("")},X=c=>{g(c),o("")},U=(c,E,I)=>{S(_e=>_e.map((ge,De)=>De===c?{...ge,[E]:I}:ge))},se=()=>{const c=j.filter(I=>I.competency.trim()!=="");if(c.length===0){alert("Please select at least a competency.");return}const E=c.map(I=>({id:"",staff_id:"",dept_id:"",team_id:"",year:"",competencies:I.competency,quarter:n,aggregate:null,created_at:"",updated_at:"",competencies_details:[{id:"",competencies_id:"",cluster:I.subcategory||"",sub_cluster:I.title||"",describe_expectations:I.description||"",min_score:0,max_score:0,quarter_marks:0,created_at:null,updated_at:null}]}));r(n,E),t()},Q=()=>{var c;return((c=x.find(E=>E.competencies_name===N))==null?void 0:c.details[C])||[]},G=()=>{const c=Q();return Array.from(new Map(c.map(E=>[E.title,E])).values())};return e.jsxs("div",{className:"p-2",children:[y?e.jsx("div",{className:"text-center text-gray-500",children:e.jsx(Ee,{loading:!0})}):m?e.jsx("div",{className:"text-center text-red-500",children:m}):x.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No data available."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block mb-2 text-sm font-semibold text-gray-900",children:"Select Competency"}),e.jsxs("select",{value:N,className:"bg-gray-50 border-2 border-gray-300 text-gray-500 text-sm rounded-lg block w-full p-2.5",onChange:c=>F(c.target.value),children:[e.jsx("option",{value:"",children:"-- Select Competency --"}),x.map(c=>e.jsx("option",{value:c.competencies_name,children:c.competencies_name},c.competencies_name))]})]}),N&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block mb-2 text-sm font-semibold text-gray-900",children:"Select Cluster"}),e.jsxs("select",{value:C,className:"bg-gray-50 border-2 border-gray-300 text-gray-500 text-sm rounded-lg block w-full p-2.5",onChange:c=>H(c.target.value),children:[e.jsx("option",{value:"",children:"-- Select Cluster --"}),Object.keys(((V=x.find(c=>c.competencies_name===N))==null?void 0:V.details)||{}).map(c=>e.jsx("option",{value:c,children:c},c))]})]}),C&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 text-sm font-semibold text-gray-900",children:"Select SubCluster"}),e.jsxs("select",{value:D,className:"bg-gray-50 border-2 border-gray-300 text-gray-500 text-sm rounded-lg block w-full p-2.5",onChange:c=>X(c.target.value),children:[e.jsx("option",{value:"",children:"-- Select SubCluster --"}),G().map((c,E)=>e.jsx("option",{value:c.title,children:c.title},`${c.title}-${E}`))]})]}),D&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 text-sm font-semibold text-gray-900",children:"Select Description"}),e.jsxs("select",{value:h,className:"bg-gray-50 border-2 border-gray-300 text-gray-500 text-sm rounded-lg block w-full p-2.5",onChange:c=>o(c.target.value),children:[e.jsx("option",{value:"",children:"-- Select Description --"}),Q().filter(c=>c.title===D).map((c,E)=>e.jsx("option",{value:c.describe_expectations,children:c.describe_expectations},`${c.describe_expectations}-${E}`))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded disabled:bg-gray-300 mr-2",disabled:!N,onClick:v,children:"Add Row"}),e.jsx("button",{className:"px-4 py-2 bg-green-500 text-white rounded disabled:bg-gray-300",disabled:!s||i,onClick:T,children:"Add Custom Row"})]})]}),e.jsxs("table",{className:"min-w-full border border-gray-500 text-sm",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border",children:"Competency"}),e.jsx("th",{className:"px-4 py-2 border",children:"Cluster"}),e.jsx("th",{className:"px-4 py-2 border",children:"Sub Cluster"}),e.jsx("th",{className:"px-4 py-2 border",children:"Description"})]})}),e.jsx("tbody",{children:j.map((c,E)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2 border",children:c.isCustom?e.jsx("input",{type:"text",className:"w-full border p-1 rounded",value:c.competency,onChange:I=>U(E,"competency",I.target.value)}):e.jsx("span",{children:c.competency})}),e.jsx("td",{className:"px-4 py-2 border",children:c.isCustom?e.jsx("input",{type:"text",className:"w-full border p-1 rounded",value:c.subcategory,onChange:I=>U(E,"subcategory",I.target.value)}):e.jsx("span",{children:c.subcategory})}),e.jsx("td",{className:"px-4 py-2 border",children:c.isCustom?e.jsx("input",{type:"text",className:"w-full border p-1 rounded",value:c.title,onChange:I=>U(E,"title",I.target.value)}):e.jsx("span",{children:c.title})}),e.jsx("td",{className:"px-4 py-2 border",children:c.isCustom?e.jsx("textarea",{className:"w-full border p-1 rounded",value:c.description,onChange:I=>U(E,"description",I.target.value)}):e.jsx("span",{children:c.description})})]},E))})]})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{className:"px-4 py-2 bg-green-500 text-white rounded disabled:bg-gray-500",disabled:j.length===0,onClick:se,children:"Confirm"})})]})},{Tr:je,Th:fe,Td:ye,THead:St,TBody:Ct}=L,_t=({onConfirm:t})=>{const r=ue(),n=Y(w=>w.competency.isEditing),x=Y(w=>w.quaterTab.selectedQuarter),[u,y]=d.useState(!1),[b,m]=d.useState(window.innerWidth<=1024),[p,j]=d.useState("rating");d.useEffect(()=>{const w=()=>{m(window.innerWidth<=1024)};return window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]);const S=w=>{j(w),y(!0)},N=()=>{y(!1)},_=()=>{n||r(we(!0))},C=(w,D)=>{t(w,D)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 4 : COMPETENCIES (20%)"}),e.jsxs("div",{className:"flex space-x-2 ml-auto",children:[e.jsx(q,{className:"mr-2",size:"xs",icon:e.jsx(Pe,{}),onClick:_,children:e.jsx("span",{className:"hidden sm:block",children:"Edit"})}),e.jsx(q,{className:"mr-2",size:"xs",icon:e.jsx(xe,{}),onClick:()=>S("competency"),children:e.jsx("span",{className:"hidden sm:block",children:"Add Competency"})}),e.jsx(q,{variant:"twoTone",size:"xs",icon:e.jsx(oe,{}),onClick:()=>S("rating"),children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})]})]})}),e.jsx(ie,{title:p==="rating"?"Performance Rating Scale":`Add Competency(Q${x})`,isOpen:u,width:b?"100%":750,onClose:N,onRequestClose:N,children:p==="rating"?e.jsxs(L,{compact:!0,className:"w-full text-left mt-4 border border-gray-300",children:[e.jsx(St,{children:e.jsxs(je,{className:"bg-gray-100",children:[e.jsx(fe,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(fe,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsx(Ct,{children:[{title:"Greatly Exceeds Expectations (5)",desc:"Performance far exceeded agreed target(s)..."},{title:"Exceeds Expectations (4)",desc:"Performance exceeded agreed target(s)..."},{title:"Meets Expectations (3)",desc:"Performance target(s) achieved..."},{title:"Occasionally Meets Expectations (2)",desc:"Performance failed to meet expectations..."}].map((w,D)=>e.jsxs(je,{children:[e.jsx(ye,{className:"border border-gray-300 p-2",children:w.title}),e.jsx(ye,{className:"border border-gray-300 p-2",children:w.desc})]},D))})]}):e.jsx(wt,{onClose:N,onConfirm:C})})]})},Dt=()=>{const t=Y(g=>g.quaterTab.selectedQuarter),{id:r}=B(),[n,x]=d.useState({1:[],2:[],3:[],4:[]}),[u,y]=d.useState(!1),[b,m]=d.useState(null),[p,j]=d.useState([]),S=Y(g=>g.competency.isEditing),N=(g,h)=>{x(s=>({...s,[g]:[...s[g],...h]}));const o=h.map(s=>({...s,isConfirmed:!0}));j(s=>[...s,...o])};d.useEffect(()=>{(async()=>{y(!0),m(null);try{const h=localStorage.getItem("selectedDepartmentID"),o=localStorage.getItem("selectedTeamID"),s=localStorage.getItem("selectedYear")||new Date().getFullYear().toString(),a=await bt(h,o?Number(o):null,Number(s),r??null);x(i=>({...i,[t]:a.data[t]||[]}))}catch{m("Failed to load data. Please try again.")}finally{y(!1)}})()},[r,t]);const _=n[t]||[],C=p.filter(g=>g.quarter===t),w=[..._,...C],D=(g,h)=>{x(o=>({...o,[g]:h}))};return e.jsxs("div",{className:"mt-4",children:[u&&e.jsx("div",{children:"Loading..."}),b&&e.jsx("div",{className:"text-red-500",children:b}),e.jsx(_t,{onConfirm:N}),e.jsx(vt,{competencyData:w,loading:u,allQuarterData:n,isConfirmed:g=>!!g.isConfirmed,onCopy:(g,h)=>{x(o=>({...o,[g]:h}))},updateAllCompetencyData:D,isEditing:S})]})},{TabNav:ne,TabList:Tt}=Se,Et=()=>{const t=ke(),r=te(x=>x.quaterTab.selectedQuarter),n=x=>{t(Fe(x))};return e.jsx("div",{children:e.jsx(Le,{className:"bg-gray-50 card-body-padding mt-8",children:e.jsx(Se,{value:r,variant:"pill",onChange:n,children:e.jsxs(Tt,{children:[e.jsx(ne,{value:"1",className:`${r==="1"?"bg-green-700 text-white":""}`,children:"First Quarter"}),e.jsx(ne,{value:"2",className:`${r==="2"?"bg-green-700 text-white":""}`,children:"Second Quarter"}),e.jsx(ne,{value:"3",className:`${r==="3"?"bg-green-700 text-white":""}`,children:"Third Quarter"}),e.jsx(ne,{value:"4",className:`${r==="4"?"bg-green-700 text-white":""}`,children:"Fourth Quarter"})]})})})})},kt=async(t,r,n,x)=>{try{const u=await z({url:`/supervisor/form_a?department_id=${t}&team_id=${r}&year=${n}&staff_id=${x}`,method:"get"});return console.log(u),u}catch(u){throw console.error("Error fetching information data:",u),u}},Ft=()=>{const{id:t}=B(),[r,n]=d.useState(null),[x,u]=d.useState(!0),[y,b]=d.useState(null),m=async()=>{try{const w=localStorage.getItem("selectedDepartmentID")||"",D=localStorage.getItem("selectedTeamID"),g=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),h=await kt(w,D?Number(D):null,g,t);if(h&&h.data)n(h.data);else throw new Error("Invalid response data")}catch(w){console.error("Error fetching data:",w),b("Failed to load data. Please try again.")}finally{u(!1)}};if(d.useEffect(()=>{m()},[]),x)return e.jsx("div",{children:"Loading..."});if(y)return e.jsx("div",{className:"text-red-500",children:y});const{department:p,team:j,supervisor:S,staff:N,officer:_,progress:C}=r||{};return e.jsxs("div",{children:[e.jsx(Ue,{department:p,team:j,progress:C,title:"EMPLOYEE PERFORMANCE CONTRACT"}),N&&S&&_&&e.jsx(Ge,{staff:N,supervisor:S,officer:_}),e.jsx(Et,{})]})},{Tr:J,Th:Ne,Td:M,THead:It,TBody:$t}=L,Rt=()=>e.jsx("div",{children:e.jsxs(L,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(It,{children:e.jsxs(J,{className:"bg-gray-100",children:[e.jsx(Ne,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(Ne,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsxs($t,{children:[e.jsxs(J,{children:[e.jsx(M,{className:"border border-gray-300 p-2",children:"Greatly Exceeds Expectations (5)"}),e.jsx(M,{className:"border border-gray-300 p-2",children:"Performance far exceeded agreed target(s) on all critical parameters on a consistent basis; overall quality of work and performance is excellent."})]}),e.jsxs(J,{children:[e.jsx(M,{className:"border border-gray-300 p-2",children:"Exceeds Expectations (4)"}),e.jsx(M,{className:"border border-gray-300 p-2",children:"Performance exceeded agreed target(s) on all critical parameters; overall quality of work and performance is very good."})]}),e.jsxs(J,{children:[e.jsx(M,{className:"border border-gray-300 p-2",children:"Meets Expectations (3)"}),e.jsx(M,{className:"border border-gray-300 p-2",children:"Performance target(s) achieved on all critical parameters; overall quality of work and performance is good."})]}),e.jsxs(J,{children:[e.jsx(M,{className:"border border-gray-300 p-2",children:"Occasionally Meets Expectations (2)"}),e.jsx(M,{className:"border border-gray-300 p-2",children:"Performance failed to meet expectations on agreed target(s) and on some critical parameters; performance deficiencies can however be addressed with support through guidance, coaching, mentoring and/ or training."})]}),e.jsxs(J,{children:[e.jsx(M,{className:"border border-gray-300 p-2",children:"Unsatisfactory (1)"}),e.jsx(M,{className:"border border-gray-300 p-2",children:"Performance failed to meet expectations on agreed target(s) and on most critical parameters; definite and significant corrective action needs to be taken immediately."})]}),e.jsxs(J,{children:[e.jsx(M,{className:"border border-gray-300 p-2",children:"Not Applicable (N/A):"}),e.jsx(M,{className:"border border-gray-300 p-2",children:"The activity(s) is not being carried out within the Assessment Quarter."})]})]})]})}),Ot=async(t,r,n,x)=>{try{return await z({url:`/supervisor/operation_and_process?department_id=${t}&team_id=${r}&year=${n}&staff_id=${x}`,method:"get"})}catch(u){throw console.error("Error fetching information data:",u),u}},At=async t=>{try{return await z({url:"/supervisor/operation_and_process",method:"post",data:t})}catch(r){throw console.error("Error fetching information data:",r),r}},{Tr:le,Th:ee,Td:R,THead:Pt,TBody:Qt}=L,Mt=({addRowTrigger:t,setAddRowTrigger:r})=>{const{id:n}=B(),x=Y(s=>s.quaterTab.selectedQuarter),[u,y]=d.useState(!1),b=Y(s=>s.OprationProcess2.data),m=d.useMemo(()=>b[x]||[],[b,x]),[p,j]=d.useState([]),S=s=>{const a=[...p];a[s].children.push({expectation:"",min:1,max:5,QuarterMarks:0}),j(a)},N=d.useCallback(()=>{j(s=>[...s,{title:"",children:[]}])},[]);d.useEffect(()=>{t&&(N(),r(!1))},[t,N,r]),d.useEffect(()=>{const s=["Punctuality/Attendance","Work turn around time","Innovation on the job"],a=s.map(l=>{const f=m==null?void 0:m.find(v=>v.operations_and_process===l);return{title:l,children:f?f.details.map(v=>({expectation:v.describe_expectations,min:String(v.min_score),max:String(v.max_score),QuarterMarks:String(v.quarter_marks)})):[]}}),i=(m==null?void 0:m.filter(l=>!s.includes(l.operations_and_process)).map(l=>({title:l.operations_and_process,children:l.details.map(f=>({expectation:f.describe_expectations,min:String(f.min_score),max:String(f.max_score),QuarterMarks:String(f.quarter_marks)}))})))||[];j([...a,...i])},[m]);const _=(s,a,i,l)=>{const f=[...p];f[s].children[a][i]=l,j(f)},C=(s,a)=>{const i=[...p];i[s].title=a,j(i)},w=s=>{const a=[...p];a.splice(s,1),j(a)},D=(s,a)=>{const i=[...p];i[s].children.splice(a,1),j(i)},g=()=>{const s=p.reduce((l,f)=>l+f.children.reduce((v,T)=>{const F=Number(T.min)||0;return v+F},0),0),a=p.reduce((l,f)=>l+f.children.reduce((v,T)=>{const F=Number(T.max)||0;return v+F},0),0);return{total_value:a>0?s/a*10:0}},{total_value:h}=g(),o=async()=>{const s=p.map(i=>({operations_and_process:i.title,details:i.children.map(l=>({describe_expectations:l.expectation,min_score:l.min,max_score:l.max,quarter_marks:l.QuarterMarks}))})).filter(i=>i.details.length>0),a={department_id:localStorage.getItem("selectedDepartmentID"),team_id:localStorage.getItem("selectedTeamID"),year:localStorage.getItem("selectedYear")||new Date().getFullYear().toString(),quater:x,staff_id:n,data:s,total_min_score:h,total_max_score:10};try{y(!0),(await At(a)).status===201&&(localStorage.setItem(`oprationData-Q${x}`,JSON.stringify(p)),A.push(e.jsx(P,{title:"Success",type:"success",children:"Data saved successfully!"}),{placement:"top-center"}))}catch{A.push(e.jsx(P,{title:"Error",type:"danger",children:"Something went wrong."}),{placement:"top-center"})}finally{y(!1)}};return e.jsxs("div",{children:[e.jsxs(L,{compact:!0,className:"bg-white w-full",children:[e.jsx(Pt,{children:e.jsxs(le,{className:"bg-gray-200",children:[e.jsx(ee,{className:"border border-green-600 p-2 w-[28%]",children:"Operations and Processes"}),e.jsx(ee,{className:"border border-green-600 p-2",children:"Describe Expectations"}),e.jsx(ee,{className:"border border-green-600 p-2 text-center w-[10%]",children:"Min Score"}),e.jsx(ee,{className:"border border-green-600 p-2 text- w-[10%]",children:"Max Score"}),e.jsxs(ee,{className:"border border-green-600 p-2 text-center w-[12%]",children:["Quarter Marks (Q",x,")"]})]})}),e.jsxs(Qt,{children:[p.map((s,a)=>e.jsx(Ie.Fragment,{children:s.children.length>0?s.children.map((i,l)=>e.jsxs(le,{children:[l===0&&e.jsxs(R,{rowSpan:s.children.length,className:"border border-gray-400 p-2 relative w-[250px]",children:[e.jsx(me,{className:"text-red-600 cursor-pointer text-2xl absolute top-1 left-1",onClick:()=>w(a)}),e.jsxs("div",{className:"flex justify-between items-center mt-6 gap-2",children:[a<3?e.jsx("span",{className:"text-sm font-medium",children:s.title}):e.jsx(k,{value:s.title,className:"text-sm font-medium",onChange:f=>C(a,f.target.value)}),e.jsx(he,{className:"text-green-700 h-4 w-4 cursor-pointer",onClick:()=>S(a)})]})]}),e.jsxs(R,{className:"border border-gray-400 p-2",children:[s.children.length>1&&e.jsx(Ce,{className:"text-xl text-red-600 cursor-pointer m-auto mb-1",onClick:()=>D(a,l)}),e.jsx(k,{value:i.expectation,onChange:f=>_(a,l,"expectation",f.target.value)})]}),e.jsx(R,{className:"border border-gray-400 p-2",children:e.jsx(k,{type:"number",value:i.min,onChange:f=>{const v=f.target.value;v===""||Number(v)>=0&&Number(v)<=4?_(a,l,"min",v):alert("Min value must be between 0 and 4")}})}),e.jsx(R,{className:"border border-gray-400 p-2",children:e.jsx(k,{type:"number",value:i.max,onChange:f=>{const v=f.target.value;v===""||Number(v)>=1&&Number(v)<=5?_(a,l,"max",v):alert("Max value must be between 1 and 5")}})}),e.jsx(R,{className:"border border-gray-400 p-2 text-center",children:i.QuarterMarks})]},`${a}-${l}`)):e.jsxs(le,{children:[e.jsxs(R,{className:"border border-gray-400 p-2 relative w-[250px]",children:[e.jsx(me,{className:"text-red-600 cursor-pointer text-2xl absolute top-1 left-1",onClick:()=>w(a)}),e.jsxs("div",{className:"flex justify-between items-center mt-6 gap-2",children:[a<3?e.jsx("span",{className:"text-sm font-medium",children:s.title}):e.jsx(k,{value:s.title,className:"text-sm font-medium",onChange:i=>C(a,i.target.value)}),e.jsx(he,{className:"text-green-700 h-4 w-4 cursor-pointer",onClick:()=>S(a)})]})]}),e.jsx(R,{className:"border border-gray-400 p-2"}),e.jsx(R,{className:"border border-gray-400 p-2"}),e.jsx(R,{className:"border border-gray-400 p-2"}),e.jsx(R,{className:"border border-gray-400 p-2"})]})},a)),p.length>0&&e.jsxs(le,{className:"bg-gray-100 border ",children:[e.jsx(R,{className:"border border-gray-400 text-center font-bold",colSpan:2,children:"Total"}),e.jsx(R,{className:"border border-gray-400 text-center",children:Math.round(h)}),e.jsx(R,{className:"border border-gray-400 text-center",children:"10"}),e.jsx(R,{className:"border border-gray-400"})]})]})]}),p.length>0&&e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(q,{variant:"solid",color:"green-700",loading:u,onClick:o,children:"Save"})})]})},qt=()=>{const[t,r]=d.useState(!1),[n,x]=d.useState(!1),[u,y]=d.useState(window.innerWidth<=1024);d.useEffect(()=>{const j=()=>{y(window.innerWidth<=1024)};return window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]);const b=()=>r(!0),m=()=>r(!1),p=()=>x(!0);return e.jsx("div",{children:e.jsxs("section",{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2 mt-4 ",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 5 : OPERATIONS AND PROCESSES (10%)"}),e.jsxs("div",{className:"flex space-x-2 ml-auto",children:[e.jsx(q,{className:"mr-2",size:"xs",icon:e.jsx(xe,{}),onClick:p,children:e.jsx("span",{className:"hidden sm:block",children:"Add Row"})}),e.jsx(q,{variant:"twoTone",size:"xs",icon:e.jsx(oe,{}),onClick:b,children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})]})]})}),e.jsx(Mt,{addRowTrigger:n,setAddRowTrigger:x}),e.jsx(ie,{title:"Performance Rating Scale",isOpen:t,width:u?"100%":750,onClose:m,onRequestClose:m,children:e.jsx(Rt,{})})]})})},Lt=()=>{const t=ue(),r=Y(p=>p.quaterTab.selectedQuarter),{id:n}=B(),[x,u]=d.useState(!0),[y,b]=d.useState(null),m=Y(p=>p.OprationProcess2.data);return console.log("redux Data",m),d.useEffect(()=>{(async()=>{try{const j=localStorage.getItem("selectedDepartmentID"),S=localStorage.getItem("selectedTeamID"),N=localStorage.getItem("selectedYear")||new Date().getFullYear().toString(),C=(await Ot(j,S?Number(S):null,Number(N),n??null)).data||{},w=Array.isArray(C[r])?C[r]:[];t($e({quarter:r,data:w}))}catch(j){console.error("Error fetching data:",j),b("Failed to load data. Please try again.")}finally{u(!1)}})()},[n,r,t]),e.jsx(e.Fragment,{children:x?e.jsx("p",{children:"Loading..."}):y?e.jsx("p",{className:"text-red-500",children:y}):e.jsx(qt,{})})},ls=()=>e.jsxs("div",{children:[e.jsx(Ft,{}),e.jsx(pt,{}),e.jsx(Dt,{}),e.jsx(Lt,{}),e.jsx(lt,{})]});export{ls as default};
