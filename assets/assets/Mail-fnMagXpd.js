import{j as e,c as C,a0 as k,a as N,a3 as $,a4 as Q,r as d,u as w,a5 as z,a6 as G,a7 as q,a8 as ee,a9 as se,aa as te,$ as A,p as V,J as U}from"./index-CdvnMJDF.js";import{A as ae}from"./AdaptableCard-y--jzvZ8.js";import{D as re,C as F,A as I}from"./Tag-CxkAlyD2.js";import{R as le}from"./SvgIcon-f57X2RSa.js";import{I as ie,B as v}from"./hoist-non-react-statics.cjs-sUaFkZ5N.js";import{T as ne,U as ce,W as oe,X as de,Y as me,e as fe,Z as ue,G as he}from"./Views-CxF1MRNz.js";import{F as xe,a as E}from"./FormContainer-grfML9lp.js";import{b as pe,S as X}from"./Upload-BfnOvjia.js";import{S as ge}from"./Select-DZj4XGu3.js";import{t as je,N as be}from"./toast-BcWTRMKr.js";import{F as ve,a as Me,b as R,u as ye}from"./formik.esm-C3Bd1Npv.js";import{c as we,b as B}from"./index.esm-1LQfzTiS.js";import{M as Ne,a as De}from"./index-CSqXTapl.js";import{D as Ce}from"./DoubleSidedImage-BRaKeukt.js";import{u as ke}from"./useResponsive-BZ_pnCcL.js";import{R as Se}from"./index-DYa0XHYX.js";import"./index-BE3rFSTS.js";import"./quill.snow-kKRIGMjE.js";import"./cloneDeep-DznBgb_t.js";import"./useThemeClass-jVloYh0I.js";const Ee=({className:s,asElement:t="span",icon:l,children:m})=>e.jsxs(t,{className:C("flex items-center gap-2",s),children:[l,m]}),_=(s,t)=>{je.push(e.jsx(be,{title:s.charAt(0).toUpperCase()+s.slice(1),type:s,children:t}))},Re=async()=>{try{const s=await k({url:"/chat_dashboard",method:"get"});return console.log(s),s}catch(s){throw console.error("Error fetching mail list:",s),s}},_e=async s=>{try{return await k({url:"/chat",method:"post",data:s})}catch(t){throw console.error("Error adding mail:",t),t}},Ie=async s=>{try{return await k({url:`/chat?chat_id=${s}`,method:"get"})}catch(t){throw console.error("Error fetching mail by ID:",t),t}},Ae=async()=>{try{return await k({url:"/user_chat",method:"get"})}catch(s){throw console.error("Error fetching chat list:",s),s}};function H(){const s=N(),t=async()=>await Re(),l=async()=>{var c,a;try{const n=await t();if(n.status===200){const r=n.data||[];return s(Q(r)),{status:"success",message:"Mail details get successfully"}}return{status:"warning",message:"Error fetching Mail details"}}catch(n){return console.error("Error fetching Mail details:",n),{status:"danger",message:((a=(c=n==null?void 0:n.response)==null?void 0:c.data)==null?void 0:a.message)||n.toString()}}};return{getMail:l,addMail:async c=>{var a,n;try{const r=await _e(c);return r.status===201?(await l(),{status:"success",message:r.data.message}):{status:"warning",message:r.data.message}}catch(r){return console.error("Error fetching Mail details:",r),{status:"danger",message:((n=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:n.message)||r.toString()}}},getMailById:async c=>{var a,n;try{const r=await Ie(c);return r.status===200?(s($(r.data.data)),{status:"success",message:r.data.message}):{status:"warning",message:r.data.message}}catch(r){return console.error("Error fetching Mail details:",r),{status:"danger",message:((n=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:n.message)||r.toString()}}}}}const Fe="Error",He="warning",Le=we().shape({title:B().required("Title Required"),message:B().max(200,"Message must be at most 200 characters long")}),Oe=()=>{const{values:s}=ye(),t=N();return d.useEffect(()=>{t(G(s))},[s,t]),null},L=d.forwardRef((s,t)=>{const{mode:l="new",chatId:m,mailReceiver:o,updateReply:c,onDialogClose:a}=s,n=d.useRef(null),r=d.useRef(null);d.useImperativeHandle(t,()=>({formikRef:n.current,editorRef:r.current}));const j=N(),x=w(z(m||"")),p=w(f=>f.draftMailList),[M,D]=d.useState({title:"",send:[],message:""}),[i,g]=d.useState([]),J=f=>{const u=(f==null?void 0:f.map(({staff_id:b,name:y})=>({staff_id:b,value:y,label:y,isDisabled:!1})))||[];g(u)},{addMail:W,getMailById:Z}=H();d.useEffect(()=>{(async()=>{const u=await Ae();u.status===200&&J(u.data.data)})(),l==="reply"&&D({...M,title:(x==null?void 0:x.chat_name)||""})},[]),d.useEffect(()=>{if(p.selectedMail!==null){const f=p.draftMails[p.selectedMail];D({...M,title:f.title,send:f.send,message:f.message})}},[p.selectedMail]);const O=f=>{j(G(f))},K=async f=>{if(l==="reply"){const u={reciver_staff_id:o||"",chat_id:m||"",name:"",title:(x==null?void 0:x.chat_name)||"",message:f.message,files:[]};await T(u),await Z(m||""),_("success","Reply send successfully"),c==null||c(!1)}if(l==="new"){let u=!0;if(f.send.map(async b=>{const y={reciver_staff_id:b.staff_id,chat_id:"",name:"",title:f.title,message:f.message,files:[]},h=await T(y);if((h==null?void 0:h.status)!=="success"){u=!1,_((h==null?void 0:h.status)||He,(h==null?void 0:h.message)||Fe);return}}),!u)return;_("success","Message send successfully"),p.selectedMail!==null&&j(q(p.selectedMail)),a==null||a()}},T=async f=>await W(f);return e.jsx(ve,{enableReinitialize:!0,innerRef:n,initialValues:M,validationSchema:Le,onSubmit:(f,{resetForm:u,setSubmitting:b})=>{K(f),setTimeout(()=>{b(!1),u()},400)},children:({values:f,touched:u,errors:b})=>e.jsxs(Me,{children:[e.jsx(Oe,{}),e.jsxs(xe,{className:"max-h-[400px] overflow-y-auto px-1",children:[e.jsx(E,{className:l==="reply"?"!hidden":"",label:"Title",labelClass:"!justify-start",invalid:b.title&&u.title,errorMessage:b.title,children:e.jsx(R,{autoComplete:"off",name:"title",placeholder:"Please Enter Title",component:ie})}),e.jsx(E,{className:l==="reply"?"!hidden":"",label:"To",labelClass:"!justify-start",children:e.jsx(R,{name:"send",children:({field:y,form:h})=>e.jsx(ge,{isMulti:!0,placeholder:"Please Select",onChange:S=>{h.setFieldValue("send",S),O(f)},value:f.send,options:i})})}),e.jsx(E,{label:l==="new"?"Message":"",className:"mb-0",labelClass:"!justify-start",invalid:b.message&&u.message,errorMessage:b.message,children:e.jsx(R,{name:"message",children:({field:y,form:h})=>e.jsx(le,{ref:r,value:y.value,onChange:S=>{h.setFieldValue(y.name,S),O(f)}})})})]}),l==="new"&&e.jsxs("div",{className:"text-right mt-4",children:[e.jsx(v,{type:"button",className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:a,children:"Discard"}),e.jsx(v,{type:"submit",variant:"solid",children:"Send"})]})]})})});L.displayName="MailEditor";const Te=s=>{const t=d.useRef(null),l=N(),[m,o]=d.useState(!1),c=w(r=>r.draftMailList);d.useEffect(()=>{c.selectedMail!==null&&c.selectedMail>=0&&o(!0)},[c.selectedMail]);const a=()=>{o(!0),l(ee())},n=()=>{o(!1),l(se())};return e.jsxs("div",{className:"mr-1",children:[e.jsx(v,{variant:"solid",icon:e.jsx(ne,{}),onClick:a}),e.jsxs(re,{isOpen:m,width:1e3,height:550,onClose:n,onRequestClose:n,children:[e.jsx("h5",{className:"mb-4",children:"Message"}),e.jsx("div",{children:e.jsx(L,{ref:t,mode:"new",onDialogClose:n})})]})]})},Be=({title:s,titleTag:t,subTitle:l,showYear:m,classNames:o})=>e.jsx("div",{className:`flex items-center gap-2 mb-4 break-all ${o}`,children:e.jsxs("div",{children:[t==="h5"&&e.jsx("h5",{className:"mb-4 lg:mb-0",children:s}),(!t||t==="")&&e.jsx("h3",{className:"mb-4 lg:mb-0",children:s}),e.jsx("p",{children:l})]})}),Pe=({deleteIndex:s})=>{const t=N(),l=(m,o)=>{o.stopPropagation(),t(q(m))};return e.jsx(v,{shape:"circle",variant:"plain",icon:e.jsx(De,{}),onClick:m=>l(s,m)})},$e=s=>{const t=document.createElement("div");return t.innerHTML=s,t.textContent||t.innerText||""},ze=s=>{const[t,l]=d.useState(!1),m=N(),o=w(r=>r.draftMailList)||[],c=()=>{l(!0)},a=()=>{l(!1)},n=r=>{m(te(r)),a()};return e.jsxs("div",{children:[e.jsx(v,{icon:e.jsx(Ne,{}),onClick:c}),e.jsxs(pe,{title:"All Message Draft",isOpen:t,onClose:a,onRequestClose:a,children:[o.draftMails.length===0&&e.jsx("div",{children:"No Drafts Found..."}),o.draftMails.length!==0&&o.draftMails.map((r,j)=>e.jsxs(F,{clickable:!0,className:"hover:shadow-lg transition duration-150 ease-in-out mb-2",onClick:()=>n(j),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Be,{title:r.title===""?"No content found...":r.title,titleTag:"h5"}),e.jsx(Pe,{deleteIndex:j})]}),e.jsx(I.Group,{chained:!0,maxCount:4,omittedAvatarProps:{shape:"circle"},omittedAvatarTooltip:!0,children:r.send.map((x,p)=>e.jsx(I,{shape:"circle",src:x.staff_img},p))}),r.message===""?e.jsx("p",{children:"No content found..."}):e.jsx("p",{className:"w-full truncate text-sm",children:$e(r.message||"")})]},j))]})]})},Ge=/(<([^>]+)>)/gi,qe=()=>e.jsx(v,{icon:e.jsx(ce,{}),size:"sm",variant:"plain",shape:"circle"}),Ve=()=>{const{category:s,id:t}=A(),[l,m]=d.useState(""),[o,c]=d.useState(!1),[a,n]=d.useState([]),r=w(i=>i.theme.direction),j=w(i=>i.mailList),{getMail:x}=H(),p=V();d.useEffect(()=>{const i=async()=>{await x()};c(!0),a.length===0&&i(),c(!1)},[]),d.useEffect(()=>{n(j.slice().reverse())},[j]),d.useEffect(()=>{m(t!=="all"&&t||"")},[t]);const M=i=>{if(!i)return"";const g=i.replace(Ge,"");return g.length>60?g.substring(0,57)+"...":g},D=i=>{p(`/mail/${s}/${i}`)};return e.jsxs("div",{className:C("min-w-[360px] ease-in-out duration-300 relative flex flex-auto flex-col ltr:border-r rtl:border-l border-gray-200 dark:border-gray-600",l?"hidden xl:flex":"xs:flex"),children:[e.jsxs("div",{className:"relative flex flex-0 items-center justify-between min-h-[55px] border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{}),e.jsx("h6",{children:s==null?void 0:s.toLocaleUpperCase()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ze,{}),e.jsx(Te,{})]})]}),e.jsx(X,{autoHide:!0,direction:r,children:e.jsx(U,{type:a.length>0?"cover":"default",spinnerClass:a.length>0?"hidden":"",loading:o,children:a.map(i=>e.jsx("div",{className:"relative flex border-b border-gray-200 dark:border-gray-600 last:border-0 hover:bg-hover",onClick:g=>D(i.chat_id),children:e.jsx("div",{className:`${String(i.chat_id)===String(t)?"bg-gray-50 dark:bg-gray-700":""} w-full py-6 pr-4 pl-5 cursor-pointer select-none hover:bg-gray-50 hover:dark:bg-gray-700 flex`,children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"font-semibold truncate text-gray-900 dark:text-gray-100",children:i.chat_name})}),e.jsx("div",{className:"flex items-center text-lg"})]}),e.jsxs("div",{className:"flex flex-auto w-full justify-between break-all",children:[e.jsx("p",{children:M(i.last_message)}),e.jsx("div",{className:"ltr:ml-2 rtl:mr-2",children:e.jsx("span",{className:"whitespace-nowrap",children:i.date})})]})]})})},i.chat_id))})})]})},P=()=>{const{smaller:s}=ke(),t=V(),l=()=>{t(`${ue}/message/inbox/all`)};return s.xl?e.jsx(v,{icon:e.jsx(fe,{}),variant:"plain",shape:"circle",size:"sm",onClick:l}):e.jsx(e.Fragment,{})},Ue=({isReply:s,updateReply:t,onMailSend:l,onMailReply:m})=>{const o=()=>{t==null||t(!0),m==null||m()},c=()=>{t==null||t(!1)},a=()=>{l==null||l()};return e.jsx("div",{className:C("relative flex items-center min-h-[55px] px-4 border-b border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800"),children:s?e.jsxs("div",{className:"flex items-center xl:justify-end justify-between gap-2 w-full",children:[e.jsx(P,{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{size:"sm",icon:e.jsx(oe,{}),onClick:c,children:"Discard"}),e.jsx(v,{variant:"solid",size:"sm",icon:e.jsx(de,{}),onClick:a,children:"Send"})]})]}):e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{}),e.jsx(v,{size:"sm",icon:e.jsx(me,{}),onClick:o,children:e.jsx("span",{className:"hidden sm:block",children:"Reply"})})]})})})},Y=d.forwardRef((s,t)=>{const{id:l}=A(),{mails:m=[],children:o}=s,c=w(z(l||""));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 px-4 py-8 shadow-sm border-b border-gray-200 dark:border-gray-600 md:flex items-center justify-between",children:e.jsx("h5",{children:c==null?void 0:c.chat_name})}),e.jsx(X,{ref:t,autoHide:!0,children:e.jsxs("div",{className:"m-6 h-full",children:[o,m.map((a,n)=>e.jsx("div",{className:"pb-6",children:e.jsxs(F,{children:[e.jsxs("div",{className:"md:flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{shape:"circle",src:a!=null&&a.image?a.image:"/img/others/Default.png"}),e.jsxs("div",{className:"ltr:ml-2 rtl:mr-2",children:[e.jsx("div",{className:"font-semibold truncate text-gray-900 dark:text-gray-100",children:a==null?void 0:a.sender_name}),e.jsxs("div",{children:["To: ",a==null?void 0:a.sender_email]})]})]}),e.jsx(Ee,{icon:e.jsx(he,{className:"text-lg"}),children:e.jsx("span",{className:"font-semibold",children:a==null?void 0:a.created_at})})]}),e.jsx("div",{className:"mt-8",children:Se((a==null?void 0:a.message)||"")})]})},n))]})})]})});Y.displayName="MailDetailContent";const Xe=()=>{const{id:s}=A(),t=d.useRef(null),l=d.useRef(null),m=N(),o=w(i=>i.currentMails),[c,a]=d.useState(!1),[n,r]=d.useState(!1),[j,x]=d.useState(""),{getMailById:p}=H();d.useEffect(()=>{const i=async()=>{await p(String(s))};a(!0),s!=="all"?(i(),r(!1)):m($([])),a(!1)},[s]),d.useEffect(()=>{var g;let i=!0;o.length>0&&i&&(x(((g=o[0])==null?void 0:g.sender)||""),i=!1)},[o]);const M=i=>{r(i)},D=async()=>{var i,g;await((g=(i=l.current)==null?void 0:i.formikRef)==null?void 0:g.submitForm())};return e.jsx("div",{className:C(s!=="all"&&o&&!c?"block xl:flex":"hidden xl:flex","flex-col w-full bg-gray-100 dark:bg-gray-900"),children:s!=="all"&&o?c?e.jsx(U,{loading:!0}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{isReply:n,updateReply:M,onMailSend:D}),e.jsx(Y,{ref:t,mails:o,children:n&&e.jsx("div",{className:"pb-6",children:e.jsx(F,{children:e.jsx(L,{ref:l,chatId:s,mailReceiver:j,mode:"reply",updateReply:M})})})})]}):e.jsxs("div",{className:"flex flex-col justify-center items-center h-full",children:[e.jsx(Ce,{className:"max-w-[200px]",src:"/img/others/no-mail-selected.png",darkModeSrc:"/img/others/no-mail-selected-dark.png"}),e.jsx("div",{className:"mt-4 text-2xl font-semibold",children:"Select a message to read"})]})})},Ye=()=>e.jsxs("div",{className:"flex flex-auto w-full",children:[e.jsx(Ve,{}),e.jsx(Xe,{})]}),xs=()=>e.jsx(ae,{className:"h-full overflow-hidden",bodyClass:"p-0 h-full absolute inset-0 flex min-w-0 overflow-hidden",children:e.jsx(Ye,{})});export{xs as default};
