import{aM as x,j as e,a0 as y,aN as S,aO as F,aP as M,r as j,G as L,t as q,aQ as D,J as k}from"./index-XEIncrLJ.js";import{A as O}from"./AdaptableCard-DR5OScNf.js";import{ac as T,C as R}from"./Views-DInV39d3.js";import{C as $,A as z,F as B}from"./Tag-MScPo-d6.js";import{T as I}from"./Upload-Dovppv8_.js";import{I as m,B as E}from"./hoist-non-react-statics.cjs-vrUR2keZ.js";import{F as P,a as p}from"./FormContainer-BcWWCs1J.js";import{F as _,a as C,b as f}from"./formik.esm-0Zptnvee.js";import{c as A,b as h,d as G}from"./index.esm-Dl9D5xIl.js";import"./Select-BAk-N8U6.js";import{t as N,N as v}from"./toast-BA_WAYTR.js";import"./cloneDeep-DznBgb_t.js";const g=({title:a,value:r})=>e.jsxs("div",{children:[e.jsx("span",{className:"block text-gray-500 dark:text-gray-400 font-medium",children:a}),e.jsx("p",{className:"text-gray-700 dark:text-gray-200 font-semibold",children:r||"N/A"})]}),H=()=>{const a=x(i=>i.profile.baseInformation);if(!a)return e.jsx("div",{children:"Loading..."});const{name:r,staff_id:c,email:n,phone:l,role:o,profile_image:s}=a;return e.jsx($,{children:e.jsxs("div",{className:"flex flex-col xl:justify-between h-full lg:w-64 mx-auto",children:[e.jsxs("div",{className:"flex xl:flex-col items-center gap-4",children:[e.jsx("div",{className:"relative",children:e.jsx(z,{size:100,shape:"circle",src:s||"/img/avatars/No_user.jpeg"})}),e.jsx("h4",{className:"font-bold text-xl",children:r})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-1 gap-y-7 gap-x-4 mt-8",children:[e.jsx(g,{title:"Email",value:n}),e.jsx(g,{title:"Phone",value:l}),e.jsx(g,{title:"Staff ID",value:c}),e.jsx(g,{title:"Role",value:o})]})]})})},V=()=>async a=>{try{const r=await y({url:"/personalinfo",method:"get"}),{base_information:c,personal_information:n,ippis_information:l}=r.data;a(S(c)),a(F(n)),a(M(l))}catch(r){console.error("Error fetching profile data:",r)}},J=async a=>{try{return await y({url:"/personalinfo",method:"POST",data:a})}catch(r){throw console.error("Error submitting profile data:",r),r}},U=async a=>{try{return await y({url:"/security",method:"POST",data:a})}catch(r){throw console.error("Error submitting profile data:",r),r}},Q=()=>{const a=x(s=>s.profile.personalInformation),r=x(s=>{var i;return(i=s.profile.baseInformation)==null?void 0:i.profile_image}),c=x(s=>{var i;return(i=s.profile.ippisInformation)==null?void 0:i.staff_id});if(!a)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-blue-500"})});const n=j.useMemo(()=>A().shape({firstName:h().required("First Name is required"),middleName:h(),lastName:h().required("Last Name is required"),recoveryEmail:h().email("Invalid recovery email").required("Recovery Email is required"),phoneNo:h().matches(/^[0-9]+$/,"Phone Number must contain only digits").min(10,"Phone Number must be at least 10 digits long").required("Phone Number is required")}),[]),l={firstName:a.F_name||"",middleName:a["Middle Name"]||"",lastName:a["Last Name"]||"",email:a.email||"",recoveryEmail:a.recovery_email||"",phoneNo:a.phone||""},o=async(s,{setSubmitting:i})=>{const u={staff_id:c,F_name:s.firstName,M_name:s.middleName||"",L_name:s.lastName,email:s.email,recovery_email:s.recoveryEmail,file:r};try{const d=await J(u);console.log("Profile data submitted successfully:",d.data),N.push(e.jsx(v,{title:"Success",type:"success",children:"Profile updated successfully!"}),{placement:"top-center"})}catch{console.error("Error submitting profile data:"),N.push(e.jsx(v,{title:"Error",type:"danger",children:"Unable to update profile. Please try again."}),{placement:"top-center"})}finally{i(!1)}};return e.jsx("div",{className:"p-4 sm:p-6 ",children:e.jsx(_,{enableReinitialize:!0,initialValues:l,validationSchema:n,onSubmit:o,children:({errors:s,touched:i,isSubmitting:u})=>e.jsx(C,{children:e.jsxs(P,{children:[e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"First Name",invalid:!!(i.firstName&&s.firstName),errorMessage:s.firstName,children:e.jsx(f,{name:"firstName",type:"text",placeholder:"First Name",as:m})}),e.jsx(p,{label:"Middle Name (Optional)",invalid:!!(i.middleName&&s.middleName),errorMessage:s.middleName,children:e.jsx(f,{name:"middleName",type:"text",placeholder:"Middle Name",as:m})})]}),e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Last Name",invalid:!!(i.lastName&&s.lastName),errorMessage:s.lastName,children:e.jsx(f,{name:"lastName",type:"text",placeholder:"Last Name",as:m})}),e.jsx(p,{label:"Phone Number",invalid:!!(i.phoneNo&&s.phoneNo),errorMessage:s.phoneNo,children:e.jsx(f,{name:"phoneNo",type:"text",placeholder:"Phone Number",as:m})})]}),e.jsx(p,{label:"Recovery Email",invalid:!!(i.recoveryEmail&&s.recoveryEmail),errorMessage:s.recoveryEmail,children:e.jsx(f,{name:"recoveryEmail",type:"email",placeholder:"Recovery Email",as:m})}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:e.jsx(E,{type:"submit",variant:"solid",loading:u,children:"Confirm"})})]})})})})},t=({label:a,value:r})=>e.jsx(p,{label:a,children:e.jsx(m,{type:"text",value:r,readOnly:!0,className:"bg-gray-100"})}),W=()=>{const a=x(r=>r.profile.ippisInformation);return a?e.jsx("div",{className:"p-6",children:e.jsxs(P,{children:[e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(t,{label:"IPPIS Number",value:a.ippis_no||"N/A"}),e.jsx(t,{label:"Staff ID",value:a.staff_id||"N/A"})]}),e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(t,{label:"Job Title",value:a.job_title||"N/A"}),e.jsx(t,{label:"Designation",value:a.designation||"N/A"})]}),e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(t,{label:"Cadre",value:a.cadre||"N/A"}),e.jsx(t,{label:"Date of Current Posting",value:a.date_of_current_posting||"N/A"})]}),e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(t,{label:"Date of Last Promotion",value:a.date_of_last_promotion||"N/A"}),e.jsx(t,{label:"Gender",value:a.gender||"N/A"})]}),e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(t,{label:"Grade Level",value:a.grade_level||"N/A"}),e.jsx(t,{label:"Organization",value:a.organization||"N/A"})]}),e.jsx("div",{className:"md:grid grid-cols-2 gap-4",children:e.jsx(t,{label:"Role",value:a.role||"N/A"})})]})}):e.jsx("div",{children:"Loading..."})};function Y(a){return L({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z"},child:[]},{tag:"path",attr:{d:"M8 11v-4a4 4 0 1 1 8 0v4"},child:[]},{tag:"path",attr:{d:"M15 16h.01"},child:[]},{tag:"path",attr:{d:"M12.01 16h.01"},child:[]},{tag:"path",attr:{d:"M9.02 16h.01"},child:[]}]})(a)}const K=()=>{const{signOut:a}=q(),r=A({password:h().required("Current password is required"),newPassword:h().min(6,"New password must be at least 6 characters").required("New password is required"),confirmPassword:h().oneOf([G("newPassword")],"Passwords must match").required("Confirm password is required")}),c={password:"",newPassword:"",confirmPassword:""},n=async(l,o)=>{try{const s=await U(l);console.log("Password changed successfully:",s.data),N.push(e.jsx(v,{title:"Success",type:"success",children:"Password changed successfully! You will be signed out now."}),{placement:"top-center"}),a()}catch{console.error("Error changing password:"),N.push(e.jsx(v,{title:"Error",type:"danger",children:"Unable to change password. Please try again."}),{placement:"top-center"})}finally{o.setSubmitting(!1)}};return e.jsx("div",{className:"p-6",children:e.jsx(_,{initialValues:c,validationSchema:r,onSubmit:n,children:({errors:l,touched:o,isSubmitting:s})=>e.jsx(C,{children:e.jsxs(P,{children:[e.jsxs("div",{className:"md:grid grid-cols-2 gap-4",children:[e.jsx(p,{label:"Current Password",invalid:!!(o.password&&l.password),errorMessage:l.password,children:e.jsx(f,{name:"password",type:"password",placeholder:"Enter current password",as:m})}),e.jsx(p,{label:"New Password",invalid:!!(o.newPassword&&l.newPassword),errorMessage:l.newPassword,children:e.jsx(f,{name:"newPassword",type:"password",placeholder:"Enter new password",as:m})})]}),e.jsx("div",{className:"md:grid grid-cols-2 gap-4",children:e.jsx(p,{label:"Confirm Password",invalid:!!(o.confirmPassword&&l.confirmPassword),errorMessage:l.confirmPassword,children:e.jsx(f,{name:"confirmPassword",type:"password",placeholder:"Confirm new password",as:m})})}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:e.jsx(E,{type:"submit",variant:"solid",loading:s,disabled:s,children:"Confirm"})})]})})})})},{TabNav:b,TabList:X,TabContent:w}=I,Z=()=>e.jsx("div",{children:e.jsxs(I,{defaultValue:"tab1",children:[e.jsxs(X,{children:[e.jsx(b,{value:"tab1",icon:e.jsx(T,{}),children:"Personal Information"}),e.jsx(b,{value:"tab3",icon:e.jsx(B,{}),children:"IPPIS Information"}),e.jsx(b,{value:"tab4",icon:e.jsx(Y,{}),children:"Change Password"})]}),e.jsxs("div",{className:"sm:p-4",children:[e.jsx(w,{value:"tab1",children:e.jsx(Q,{})}),e.jsx(w,{value:"tab3",children:e.jsx(W,{})}),e.jsx(w,{value:"tab4",children:e.jsx(K,{})})]})]})}),ee=()=>e.jsx("div",{className:"lg:flex items-center justify-between mb-4 gap-3",children:e.jsx("div",{className:"mb-4 lg:mb-0",children:e.jsx("h3",{children:"Profile"})})}),fe=()=>{const a=D(),[r,c]=j.useState(!0),[n,l]=j.useState(null),o=x(d=>d.profile.baseInformation),s=x(d=>d.profile.personalInformation),i=x(d=>d.profile.ippisInformation),u=j.useCallback(async()=>{try{await a(V())}catch(d){console.error("Failed to fetch profile data:",d),l("Failed to load profile data.")}finally{c(!1)}},[a]);return j.useEffect(()=>{u()},[u]),j.useEffect(()=>{o&&console.log("Base Information:",o),s&&console.log("Personal Information:",s),i&&console.log("IPPIS Information:",i)},[o,s,i]),r?e.jsx(k,{loading:!0}):n?e.jsx("div",{children:n}):!o||!s||!i?e.jsx("div",{children:"Error loading profile data."}):e.jsxs(R,{className:"h-full",children:[e.jsx(ee,{}),e.jsxs("div",{className:"flex flex-col xl:flex-row gap-4",children:[e.jsx("div",{children:e.jsx(H,{baseInformation:o})}),e.jsx("div",{className:"w-full",children:e.jsx(O,{children:e.jsx(Z,{})})})]})]})};export{fe as default};
