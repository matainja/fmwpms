import{aQ as Ne,aM as ue,j as e,aR as Ie,a0 as G,r as a,u as xe,aS as Ce,aT as $e,a2 as ke,p as Oe}from"./index-DxYrGPuB.js";import{H as Fe,I as Re,F as Ae}from"./FooterButtonpart-D9olLap1.js";import{T as Ee,b as se}from"./Upload-Ck9jiP_Q.js";import{C as Qe,b as D}from"./Tag-BddxHN8B.js";/* empty css               */import{I as Z,B as Y}from"./hoist-non-react-statics.cjs-Ci2CuKH8.js";import{R as Pe,ae as be}from"./Views-CqBX4VKw.js";import"./FormContainer-gQGx1Dsz.js";import"./Select-xF-sg4aH.js";import{t as ne,N as oe}from"./toast-DqtlumJS.js";import{C as qe,a as Ke,g as Me,b as Be}from"./competency-DNLlXs-j.js";import{A as Le}from"./AcknowledgementLayout-C1UuvXcw.js";import"./index-BPz91XzU.js";import"./Evidence-Bn3HDt4s.js";import"./html2canvas.esm-CLIajFEY.js";import"./index-C5oRzy9o.js";const{TabNav:le,TabList:Ye}=Ee,We=()=>{const s=Ne(),r=ue(t=>t.quaterTab.selectedQuarter),o=t=>{s(Ie(t))};return e.jsx("div",{children:e.jsx(Qe,{className:"bg-gray-50 card-body-padding mt-8",children:e.jsx(Ee,{value:r,variant:"pill",onChange:o,children:e.jsxs(Ye,{children:[e.jsx(le,{value:"1",className:`${r==="1"?"bg-green-700 text-white":""}`,children:"First Quarter"}),e.jsx(le,{value:"2",className:`${r==="2"?"bg-green-700 text-white":""}`,children:"Second Quarter"}),e.jsx(le,{value:"3",className:`${r==="3"?"bg-green-700 text-white":""}`,children:"Third Quarter"}),e.jsx(le,{value:"4",className:`${r==="4"?"bg-green-700 text-white":""}`,children:"Fourth Quarter"})]})})})})},He=async(s,r,o)=>{try{const t=await G({url:`/form_a?department_id=${s}&team_id=${r}&year=${o}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},ze=()=>{const[s,r]=a.useState(null),[o,t]=a.useState(!0),[g,d]=a.useState(null);a.useEffect(()=>{(async()=>{try{const p=localStorage.getItem("selectedDepartmentID")||"",u=localStorage.getItem("selectedTeamID"),f=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),w=await He(p,u?Number(u):null,f);if(w!=null&&w.data)r(w.data);else throw new Error("Invalid response data")}catch(p){console.error("Error fetching data:",p),d("Failed to load data. Please try again.")}finally{t(!1)}})()},[]);const l={1:0,2:0,3:0,4:0};return{data:s,loading:o,error:g,progress:(s==null?void 0:s.progress)||l}},Ge=()=>{const{data:s,loading:r,error:o,progress:t}=ze();if(r)return e.jsx("div",{children:"Loading..."});if(o)return e.jsx("div",{className:"text-red-500",children:o});const{department:g,team:d,supervisor:l,staff:x,officer:p}=s||{},u=localStorage.getItem("formPreview_2025");let f;return u&&(f=JSON.parse(u).staff_id),e.jsxs("div",{children:[e.jsx(Fe,{department:g,team:d,progress:t,title:"EMPLOYEE PERFORMANCE CONTRACT",downloadButton:!0,staffID:(x==null?void 0:x.staff_id)||f}),x&&l&&p&&e.jsx(Re,{staff:x,supervisor:l,officer:p}),e.jsx(We,{})]})};async function Ve(s){try{return await G({url:`form_a/kras?department_id=${s}`,method:"get"})}catch(r){throw console.error("Error making API request:",r),r}}const{Tr:fe,Th:ee,Td:V,THead:Je,TBody:Ue}=D,Xe=({onClose:s})=>{const r=Ne(),[o,t]=a.useState(""),[g,d]=a.useState([]),[l,x]=a.useState(null),[p,u]=a.useState(!1),[f,w]=a.useState(""),[b,E]=a.useState([]),[A,N]=a.useState(!1),h=xe(i=>i.quaterTab.selectedQuarter),I=async()=>{u(!0);try{const i=localStorage.getItem("selectedDepartmentID");if(!i)throw new Error("No department ID selected.");const m=await Ve(i);d(m.data.data||[])}catch(i){x(i instanceof Error?i.message:"An unknown error occurred.")}finally{u(!1)}};a.useEffect(()=>{I()},[]);const W=i=>{const m=parseInt(i.target.value,10);t(isNaN(m)?"":m);const y=g.flatMap(Q=>Q.kras).find(Q=>Q.kra_id===m);w(y?y.kra_weight:""),E([])},M=()=>{if(!o)return;const i=g.flatMap(m=>m.kras).find(m=>m.kra_id===o);!i||b.length>=i.objectives.length||E(m=>[...m,{id:Date.now(),selectedObjectiveId:""}])},$=(i,m)=>{E(y=>y.map(Q=>Q.id===i?{...Q,selectedObjectiveId:m}:Q))},O=g.flatMap(i=>i.kras).find(i=>i.kra_id===o),F=O?O.objectives:[],R=b.every(i=>i.selectedObjectiveId!=="")&&b.length>0,H=()=>{if(A)return;const i={[h]:[{kra_name:(O==null?void 0:O.kra_title)||"",kra_weight:f,objectives:b.map(m=>{const y=F.find(Q=>Q.obj_id===parseInt(m.selectedObjectiveId,10));return{objective_name:(y==null?void 0:y.title)||"",objective_weight:Number((y==null?void 0:y.obj_weight)||0),gradeed_weight:Number(f||0),target:(y==null?void 0:y.target)||"",kpi:(y==null?void 0:y.kpi)||"",units:"num",aggregate:"",quarter_marks:0,target_achieved:0,raw:0,weighted:0}})}]};console.log("Confirmed Data:",JSON.stringify(i,null,2)),r(Ce(i)),N(!0),setTimeout(()=>{N(!1)},7e3),s()};return p?e.jsx("div",{className:"p-4 text-center",children:"Loading..."}):l?e.jsx("div",{className:"p-4 text-center text-red-600",children:l}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Select KRA"}),e.jsxs("select",{id:"kraSelect",value:o,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white",onChange:W,children:[e.jsx("option",{value:"",children:"Select a KRA"}),g.map(i=>e.jsx("optgroup",{label:i.heading,children:i.kras.map(m=>e.jsx("option",{value:m.kra_id,children:m.kra_title},m.kra_id))},i.heading))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"weightInput",className:"mb-2 text-sm font-medium text-gray-700",children:"Weight"}),e.jsx(Z,{readOnly:!0,id:"weightInput",value:f,className:"w-full bg-gray-100"})]}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsx(Y,{variant:"solid",className:"w-full text-white hover:bg-blue-700",disabled:!o||b.length>=F.length,onClick:M,children:"Add Objective"})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(D,{compact:!0,className:"border border-gray-400 w-full",children:[e.jsx(Je,{children:e.jsxs(fe,{className:"bg-gray-200",children:[e.jsx(ee,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(ee,{className:"border border-gray-400 p-2",children:"Objective Weight"}),e.jsx(ee,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(ee,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(ee,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsx(Ue,{children:b.length===0?e.jsx(fe,{children:e.jsx(V,{colSpan:5,className:"text-center text-gray-500 py-4",children:"No Data Found"})}):b.map(i=>{const m=F.find(y=>y.obj_id===parseInt(i.selectedObjectiveId,10));return e.jsxs(fe,{children:[e.jsx(V,{className:"border border-gray-400",children:e.jsxs("select",{className:"w-full bg-white",value:i.selectedObjectiveId,onChange:y=>$(i.id,y.target.value),children:[e.jsx("option",{value:"",children:"Select Objective"}),F.map(y=>e.jsx("option",{value:y.obj_id,children:y.title},y.obj_id))]})}),e.jsx(V,{className:"border border-gray-400",children:(m==null?void 0:m.obj_weight)||""}),e.jsx(V,{className:"border border-gray-400",children:(m==null?void 0:m.kpi)||""}),e.jsx(V,{className:"border border-gray-400",children:(m==null?void 0:m.target)||""}),e.jsx(V,{className:"border border-gray-400",children:(m==null?void 0:m.Responsible)||""})]},i.id)})})]})}),e.jsx("div",{className:"text-right mt-4",children:e.jsx(Y,{variant:"solid",disabled:!R||A,className:`${R&&!A?"bg-blue-600":"bg-gray-400"}`,onClick:H,children:"Confirm"})})]})},{Tr:ve,Th:de,Td:ie,THead:Ze,TBody:er}=D,rr=[{grade:"O",description:"Outstanding - 100%",quarter:"Q1",value:"First Quarter"},{grade:"E",description:"Excellent - 90%",quarter:"Q2",value:"Second Quarter"},{grade:"VG",description:"Very Good - 80%",quarter:"Q3",value:"Third Quarter"},{grade:"G",description:"Good - 70%",quarter:"Q4",value:"Fourth Quarter"}],tr=()=>{const[s,r]=a.useState(!1),[o,t]=a.useState(!1),[g,d]=a.useState(window.innerWidth<=1024),l=ue(b=>b.quaterTab.selectedQuarter);a.useEffect(()=>{const b=()=>{d(window.innerWidth<=1024)};return window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]);const x=()=>{r(!0)},p=()=>{r(!1)},u=()=>{t(!0)},f=()=>{t(!1)},w=b=>{switch(b){case"1":return"First Quarter";case"2":return"Second Quarter";case"3":return"Third Quarter";case"4":return"Fourth Quarter";default:return"Unknown Quarter"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"SECTION 3 : EMPLOYEE'S TASKS (70%)"}),e.jsxs("div",{className:"flex space-x-2 ml-auto",children:[e.jsx(Y,{className:"mr-2",size:"xs",icon:e.jsx(Pe,{}),"aria-label":"Add KRA",onClick:u,children:e.jsx("span",{className:"hidden sm:block",children:"Add KRA"})}),e.jsx(Y,{variant:"twoTone",size:"xs",icon:e.jsx(be,{}),"aria-label":"View Scoring Criteria Values",onClick:x,children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Scoring Criteria Values"})})]})]})}),e.jsx(se,{title:"Vertical Drawer",isOpen:s,placement:"right",width:g?"100%":800,onClose:p,onRequestClose:p,children:e.jsxs(D,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(Ze,{children:e.jsxs(ve,{className:"bg-gray-100",children:[e.jsx(de,{className:"border border-gray-300 p-2",children:"Grade"}),e.jsx(de,{className:"border border-gray-300 p-2",children:"Description"}),e.jsx(de,{className:"border border-gray-300 p-2",children:"Quarter"}),e.jsx(de,{className:"border border-gray-300 p-2",children:"Value"})]})}),e.jsx(er,{children:rr.map((b,E)=>e.jsxs(ve,{children:[e.jsx(ie,{className:"border border-gray-300 p-2",children:b.grade}),e.jsx(ie,{className:"border border-gray-300 p-2",children:b.description}),e.jsx(ie,{className:"border border-gray-300 p-2",children:b.quarter}),e.jsx(ie,{className:"border border-gray-300 p-2",children:b.value})]},E))})]})}),e.jsx(se,{isOpen:o,title:`KRA add for ${w(l)} (${l})`,placement:"right",width:g?"100%":900,onClose:f,children:e.jsx(Xe,{onClose:f})})]})},ar=async(s,r,o)=>{try{const t=await G({url:`/employeetask?department_id=${s}&team_id=${r}&year=${o}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},sr=async s=>{try{const r=await G({url:"employeetask",method:"post",data:s});return console.log(r),r}catch(r){throw console.error("Error saving employee task:",r),r}},{Tr:re,Th:P,Td:k,THead:cr,TBody:nr}=D,or=({loading:s,data:r,calculateKraWeight:o,calculateGradedWeight:t,totalWeight:g,totalGradedWeight:d})=>e.jsx("div",{children:e.jsxs(D,{compact:!0,className:"border border-gray-400 w-full bg-white",children:[e.jsx(cr,{children:e.jsxs(re,{className:"bg-gray-200",children:[e.jsx(P,{className:"border border-gray-400 p-2",children:"S/N"}),e.jsx(P,{className:"border border-gray-400 p-2",children:"KRA"}),e.jsx(P,{className:"border border-gray-400 p-2",children:"KRA Weight"}),e.jsx(P,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(P,{className:"border border-gray-400 p-2",children:"OBJ Weight"}),e.jsx(P,{className:"border border-gray-400 p-2",children:"Grade Weight"}),e.jsx(P,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(P,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(P,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsxs(nr,{children:[s?e.jsx(re,{children:e.jsx(k,{className:"border border-gray-400 text-center",colSpan:9,children:"Loading..."})}):r.length===0?e.jsx(re,{children:e.jsx(k,{className:"border border-gray-400 text-center",colSpan:9,children:e.jsx("span",{className:"text-black font-semibold text-lg",children:"No data available"})})}):r.map((l,x)=>l.objectives.map((p,u)=>e.jsxs(re,{children:[u===0&&e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"border border-gray-400",rowSpan:l.objectives.length,children:x+1}),e.jsx(k,{className:"border border-gray-400",rowSpan:l.objectives.length,children:l.kra_name}),e.jsx(k,{className:"border border-gray-400 text-center",rowSpan:l.objectives.length,children:o(l.objectives).toFixed(2)})]}),e.jsx(k,{className:"border border-gray-400",children:p.objective_name}),e.jsx(k,{className:"border border-gray-400",children:p.objective_weight}),e.jsx(k,{className:"border border-gray-400 text-center",children:t(p.objective_weight).toFixed(2)}),e.jsx(k,{className:"border border-gray-400",children:p.target}),e.jsx(k,{className:"border border-gray-400",children:p.kpi}),e.jsx(k,{className:"border border-gray-400",children:p.unit})]},`${x}-${u}`))),!s&&r.length>0&&e.jsxs(re,{children:[e.jsx(k,{className:"border border-gray-400 text-center",colSpan:2,children:"Total"}),e.jsx(k,{className:"border border-gray-400 text-center",children:"70"}),e.jsx(k,{className:"border border-gray-400 text-center"}),e.jsx(k,{className:"border border-gray-400 text-center",children:g.toFixed(2)}),e.jsx(k,{className:"border border-gray-400 text-center",children:d.toFixed(2)}),e.jsx(k,{className:"border border-gray-400 text-center",colSpan:3})]})]})]})}),{Tr:J,Th:q,Td:T,THead:lr,TBody:dr}=D,ir=()=>{const s=Ne(),r=xe(n=>n.quaterTab.selectedQuarter),{quater_settings:o}=xe(n=>n.auth.user||{});console.log(o);const t=xe(n=>n.kra.selectedQuarterData),[g,d]=a.useState({}),[l,x]=a.useState(!0),[p,u]=a.useState(null),[f,w]=a.useState(!1),b=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),E=new Date().getFullYear(),A=async()=>{try{const n=localStorage.getItem("selectedDepartmentID"),c=localStorage.getItem("selectedTeamID"),j=await ar(n,c?Number(c):null,b?Number(b):null);d(j.data||{})}catch(n){console.error("Error fetching data:",n),u("Failed to load data. Please try again.")}finally{x(!1)}};a.useEffect(()=>{A()},[]);const N=a.useMemo(()=>{if(l||!g[r])return[];const n=g[r]||[],c=(t==null?void 0:t[r])||[],j=JSON.parse(JSON.stringify(c));return[...n,...j]},[t,r,g,l]),[h,I]=a.useState([]);a.useEffect(()=>{I(N)},[N]);const W=(n,c,j)=>{const v=n.target.value;if(/^\d{0,2}(\.\d{0,2})?$/.test(v)){const S=[...h];S[c].objectives[j].objective_weight=v,I(S)}else alert("Please enter up to 2 digits before and after the decimal point. Example: 12.75")},M=n=>n.reduce((c,j)=>c+Number($(j.objective_weight||"0")),0),$=n=>{if(!n||parseFloat(n)===0)return 0;const c=h.reduce((j,v)=>j+v.objectives.reduce((S,C)=>S+parseFloat(C.objective_weight||"0"),0),0);return c===0?0:70/c*parseFloat(n)},O=h.reduce((n,c)=>n+c.objectives.reduce((j,v)=>j+parseFloat(v.objective_weight||"0"),0),0),F=h.reduce((n,c)=>n+c.objectives.reduce((j,v)=>j+Number($(v.objective_weight||"0")),0),0),R=n=>{const c=[...h];c.splice(n,1),I(c)},H=(n,c)=>{const j=[...h];j[n].objectives.splice(c,1),I(j)},i=()=>{for(const n of h){if(!n.kra_name||n.kra_name.trim()==="")return alert("KRA name is required."),!1;for(const c of n.objectives){if(!c.objective_name||c.objective_name.trim()==="")return alert("Objective name is required."),!1;if(c.objective_weight===null||c.objective_weight===void 0||isNaN(parseFloat(c.objective_weight)))return alert("Objective weight is required and must be a valid number."),!1;if(c.target===null||c.target===void 0||isNaN(parseFloat(c.target)))return alert("Target is required and must be a valid number."),!1;if(!c.kpi||c.kpi.trim()==="")return alert("KPI is required."),!1}}return!0},m=async()=>{if(!i())return;const n=localStorage.getItem("selectedDepartmentID")||"",c=Number(localStorage.getItem("selectedTeamID"))||0,j=Number(localStorage.getItem("selectedYear"))||new Date().getFullYear(),v=Number(r),S=h.reduce((B,pe)=>{const je=pe.objectives.map(_=>({objective_name:_.objective_name.trim(),objective_weight:parseFloat(_.objective_weight)||0,gradeed_weight:parseFloat($(_.objective_weight).toFixed(2)),target:parseFloat(_.target)||0,kpi:_.kpi.trim(),unit:_.unit||"",aggregate:_.aggregate||null,quarter_marks:_.quarter_marks||0,target_achieved:_.target_achieved||0,raw:_.raw||0,weighted:_.weighted||0})),ce=B.find(_=>_.kra_name===pe.kra_name);return ce?(ce.objective.push(...je),ce.kra_weight=ce.objective.reduce((_,ye)=>_+ye.gradeed_weight,0)):B.push({kra_name:pe.kra_name,kra_weight:je.reduce((_,ye)=>_+ye.gradeed_weight,0),objective:je}),B},[]),C={department_id:n,team_id:c,year:j,quater:v,employee_task:S,total_weight:70,total_graded_weight:F.toFixed(2)};try{const B=await sr({department_id:n,team_id:c,year:j,quater:v,employee_task:C.employee_task,total_weight:70,total_graded_weight:F.toFixed(2)});alert("Data saved successfully!"),A(),s($e())}catch{alert("Failed to save data. Please try again.")}},y=()=>{const n=parseInt(r);if(n===1)return;const c=(n-1).toString(),j=g[c];if(!j){alert(`No data available in Q${c} to copy`);return}const v=JSON.parse(JSON.stringify(j));d(S=>({...S,[r]:v})),I(v),alert(`Data copied from Q${c} to Q${r}`),w(!0)},Q=()=>l||h.length>0?!1:parseInt(r)>1;return e.jsx("div",{children:b===E?e.jsxs(e.Fragment,{children:[e.jsxs(D,{compact:!0,className:"border border-gray-400 w-full bg-white",children:[e.jsx(lr,{children:e.jsxs(J,{className:"bg-gray-200",children:[e.jsx(q,{className:"border border-gray-400 p-2",children:"S/N"}),e.jsx(q,{className:"border border-gray-400 p-2",children:"KRA"}),e.jsx(q,{className:"border border-gray-400 p-2",children:"KRA Weight"}),e.jsx(q,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(q,{className:"border border-gray-400 p-2",children:"OBJ Weight"}),e.jsx(q,{className:"border border-gray-400 p-2",children:"Grade Weight"}),e.jsx(q,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(q,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(q,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsxs(dr,{children:[l?e.jsx(J,{children:e.jsx(T,{className:"border border-gray-400 text-center",colSpan:9,children:"Loading..."})}):h.length===0?o&&Q()?e.jsx(J,{children:e.jsx(T,{className:"border border-gray-400 text-center",colSpan:9,children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-4",children:[e.jsxs("span",{className:"text-black font-semibold text-lg mb-3",children:["No data for Q",r,". Would you like to copy from previous quarter?"]}),e.jsxs(Y,{variant:"solid",className:"w-64",onClick:y,children:["Copy from Q",parseInt(r)-1]})]})})}):e.jsx(J,{children:e.jsx(T,{className:"border border-gray-400 text-center",colSpan:9,children:e.jsxs("span",{className:"text-black font-semibold text-lg",children:["No data available for Q",r]})})}):h.map((n,c)=>n.objectives.map((j,v)=>e.jsxs(J,{children:[v===0&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"border border-gray-400",rowSpan:n.objectives.length,children:[c+1,e.jsx(qe,{className:"text-xl text-red-600 cursor-pointer",onClick:()=>R(c)})]}),e.jsx(T,{className:"border border-gray-400",rowSpan:n.objectives.length,children:n.kra_name}),e.jsx(T,{className:"border border-gray-400 text-center",rowSpan:n.objectives.length,children:M(n.objectives).toFixed(2)})]}),e.jsxs(T,{className:"border border-gray-400",children:[n.objectives.length>2&&e.jsx(Ke,{className:"text-xl text-red-600 cursor-pointer m-auto",onClick:()=>H(c,v)}),e.jsx(Z,{textArea:!0,value:j.objective_name,onChange:S=>{const C=[...h];C[c].objectives[v].objective_name=S.target.value,I(C)}})]}),e.jsx(T,{className:"border border-gray-400",children:e.jsx(Z,{className:"w-full",value:j.objective_weight,onChange:S=>W(S,c,v)})}),e.jsx(T,{className:"border border-gray-400 text-center",children:$(j.objective_weight).toFixed(2)}),e.jsx(T,{className:"border border-gray-400",children:e.jsx(Z,{value:j.target,onChange:S=>{const C=S.target.value;if(/^\d*\.?\d*$/.test(C)){const B=[...h];B[c].objectives[v].target=C,I(B)}}})}),e.jsx(T,{className:"border border-gray-400",children:e.jsx(Z,{textArea:!0,value:j.kpi,onChange:S=>{const C=[...h];C[c].objectives[v].kpi=S.target.value,I(C)}})}),e.jsx(T,{className:"border border-gray-400",children:e.jsx(Z,{textArea:!0,value:j.unit,onChange:S=>{const C=[...h];C[c].objectives[v].unit=S.target.value,I(C)}})})]},`${c}-${v}`))),!l&&h.length>0&&e.jsxs(J,{children:[e.jsx(T,{className:"border border-gray-400 text-center",colSpan:2,children:"Total"}),e.jsx(T,{className:"border border-gray-400 text-center",children:"70"}),e.jsx(T,{className:"border border-gray-400 text-center"}),e.jsx(T,{className:"border border-gray-400 text-center",children:O.toFixed(2)}),e.jsx(T,{className:"border border-gray-400 text-center",children:F.toFixed(2)}),e.jsx(T,{className:"border border-gray-400 text-center",colSpan:3})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end mt-4",children:[f&&e.jsx("div",{className:"size-10 animate-bounce mb-2 me-5",children:e.jsx("img",{src:"/img/others/down-arrow.svg",alt:"Down Arrow"})}),e.jsx(Y,{variant:"solid",color:"green-700",className:"mt-2",onClick:m,children:"Save"})]})]}):e.jsx(or,{loading:l,data:h,calculateKraWeight:M,calculateGradedWeight:$,totalWeight:O,totalGradedWeight:F})})},mr=()=>e.jsxs("div",{className:"mt-4",children:[e.jsx(tr,{}),e.jsx(ir,{})]}),{Tr:we,Th:Se,Td:Te,THead:gr,TBody:hr}=D,xr=({isOpen:s,setIsOpen:r})=>{const[o,t]=a.useState(window.innerWidth<=1024);a.useEffect(()=>{const d=()=>{t(window.innerWidth<=1024)};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const g=[{id:1,title:"Greatly Exceeds Expectations (5)",desc:"Performance far exceeded agreed target(s)..."},{id:2,title:"Exceeds Expectations (4)",desc:"Performance exceeded agreed target(s)..."},{id:3,title:"Meets Expectations (3)",desc:"Performance target(s) achieved..."},{id:4,title:"Occasionally Meets Expectations (2)",desc:"Performance failed to meet expectations..."}];return e.jsx(se,{isOpen:s,title:"Performance Rating Scale",width:o?"100%":750,onClose:()=>r(!1),children:e.jsxs(D,{compact:!0,className:"w-full text-left mt-4 border border-gray-300",children:[e.jsx(gr,{children:e.jsxs(we,{className:"bg-gray-100",children:[e.jsx(Se,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(Se,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsx(hr,{children:g.map(d=>e.jsxs(we,{children:[e.jsx(Te,{className:"border border-gray-300 p-2",children:d.title}),e.jsx(Te,{className:"border border-gray-300 p-2",children:d.desc})]},d.id))})]})})},ur=()=>{const[s,r]=a.useState(!1);return e.jsxs("div",{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 4 : COMPETENCIES (20%)"}),e.jsx("div",{className:"flex space-x-2 ml-auto",children:e.jsx(Y,{variant:"twoTone",size:"xs",icon:e.jsx(be,{}),onClick:()=>r(!0),children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})})]})}),e.jsx(xr,{isOpen:s,setIsOpen:r})]})},{Tr:De,Th:me,Td:ge,THead:br,TBody:pr}=D,jr=()=>{const[s,r]=a.useState([]),[o,t]=a.useState(!0),[g,d]=a.useState(null),l=async()=>{t(!0),d(null);try{const x=await Me();r(x.data||[])}catch(x){console.error("Error fetching data:",x),d("Failed to load data. Please try again.")}finally{t(!1)}};return a.useEffect(()=>{l()},[]),e.jsx("div",{className:"p-2",children:o?e.jsx("div",{className:"text-center text-gray-500",children:"Loading..."}):g?e.jsx("div",{className:"text-center text-red-500",children:g}):s.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No data available."}):e.jsxs(D,{className:"min-w-full border border-gray-300 text-sm",children:[e.jsx(br,{className:"bg-gray-200",children:e.jsxs(De,{children:[e.jsx(me,{className:"px-4 py-2 border border-gray-300 text-left",children:"Competency Name"}),e.jsx(me,{className:"px-4 py-2 border border-gray-300 text-left",children:"Cluster"}),e.jsx(me,{className:"px-4 py-2 border border-gray-300 text-left",children:"Sub Cluster"}),e.jsx(me,{className:"px-4 py-2 border border-gray-300 text-left",children:"Description"})]})}),e.jsx(pr,{children:s.map(x=>Object.entries(x.details).map(([p,u])=>u.map((f,w)=>e.jsxs(De,{className:"border-b border-gray-300",children:[w===0&&e.jsx(ge,{rowSpan:u.length,className:"px-4 py-2 border border-gray-300 font-semibold",children:x.competencies_name}),w===0&&e.jsx(ge,{rowSpan:u.length,className:"px-4 py-2 border border-gray-300",children:p}),e.jsx(ge,{className:"px-4 py-2 border border-gray-300",children:f.title}),e.jsx(ge,{className:"px-4 py-2 border border-gray-300",children:f.describe_expectations})]},`${x.competencies_name}-${p}-${w}`))))})]})})},{Tr:U,Th:X,Td:K,THead:yr,TBody:fr}=D,Nr=()=>{const[s,r]=a.useState(!1),[o,t]=a.useState({1:[],2:[],3:[],4:[]}),[g,d]=a.useState(!0),[l,x]=a.useState(null),[p,u]=a.useState(window.innerWidth<=1024);a.useEffect(()=>{const N=()=>{u(window.innerWidth<=1024)};return window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]);const f=ue(N=>N.quaterTab.selectedQuarter),w=async()=>{d(!0),x(null);try{const N=localStorage.getItem("selectedDepartmentID"),h=localStorage.getItem("selectedTeamID"),I=localStorage.getItem("selectedYear")||new Date().getFullYear(),W=await Be(N,h?Number(h):null,Number(I));t(W.data||{1:[],2:[],3:[],4:[]})}catch(N){console.error("Error fetching data:",N),x("Failed to load data. Please try again.")}finally{d(!1)}};a.useEffect(()=>{w()},[]);const b=()=>{r(!0)},E=()=>{r(!1)},A=o[f]||[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border overflow-hidden shadow-sm bg-white",children:e.jsxs(D,{compact:!0,className:"w-full",children:[e.jsx(yr,{children:e.jsxs(U,{className:"bg-gray-200",children:[e.jsx(X,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:e.jsxs("span",{className:"flex items-center gap-1",children:["Competency",e.jsx(be,{className:"text-gray-500 text-xl",onClick:()=>b()})]})}),e.jsx(X,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:"Cluster"}),e.jsx(X,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:"Sub Cluster"}),e.jsx(X,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:"Description"}),e.jsx(X,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400 w-[8%]",children:"Min"}),e.jsx(X,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400 w-[8%]",children:"Max"})]})}),e.jsx(fr,{children:g?e.jsx(U,{children:e.jsx(K,{colSpan:6,className:"p-4 text-center text-gray-500",children:"Loading competency data..."})}):l?e.jsx(U,{children:e.jsx(K,{colSpan:6,className:"p-4 text-center text-red-500",children:l})}):A.length===0?e.jsx(U,{children:e.jsx(K,{colSpan:6,className:"p-4 text-center text-gray-500 font-semibold",children:"No competency data available for the selected quarter."})}):A.map(N=>e.jsxs(ke.Fragment,{children:[e.jsx(U,{children:e.jsx(K,{className:"px-4 py-3 align-top font-semibold border border-gray-400",rowSpan:N.competencies_details.length+1,children:N.competencies})}),N.competencies_details.map(h=>e.jsxs(U,{children:[e.jsx(K,{className:"px-4 py-3 border border-gray-400",children:h.cluster}),e.jsx(K,{className:"px-4 py-3 border border-gray-400",children:h.sub_cluster}),e.jsx(K,{className:"px-4 py-3 border border-gray-400",children:h.describe_expectations}),e.jsx(K,{className:"px-4 py-3 border border-gray-400",children:h.min_score}),e.jsx(K,{className:"px-4 py-3 border border-gray-400",children:h.max_score})]},h.id))]},N.id))})]})}),e.jsx(se,{title:"Competency Information",width:p?"100%":800,isOpen:s,onClose:E,children:e.jsx(jr,{})})]})},vr=()=>e.jsxs("div",{className:"mt-8",children:[e.jsx(ur,{}),e.jsx(Nr,{})]}),{Tr:te,Th:_e,Td:L,THead:wr,TBody:Sr}=D,Tr=()=>{const[s,r]=a.useState(!1),[o,t]=a.useState(window.innerWidth<=1024);a.useEffect(()=>{const l=()=>{t(window.innerWidth<=1024)};return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]);const g=()=>{r(!0)},d=l=>{console.log("onDrawerClose",l),r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 5 : OPERATIONS AND PROCESSES (10%)"}),e.jsx("div",{className:"flex space-x-2 ml-auto",children:e.jsx(Y,{onClick:()=>g(),variant:"twoTone",size:"xs",icon:e.jsx(be,{}),children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})})]})}),e.jsx(se,{title:"Performance Rating Scale  ",isOpen:s,width:o?"100%":750,onClose:d,onRequestClose:d,children:e.jsxs(D,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(wr,{children:e.jsxs(te,{className:"bg-gray-100",children:[e.jsx(_e,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(_e,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsxs(Sr,{children:[e.jsxs(te,{children:[e.jsx(L,{className:"border border-gray-300 p-2",children:"Greatly Exceeds Expectations (5)"}),e.jsx(L,{className:"border border-gray-300 p-2",children:"Performance far exceeded agreed target(s) on all critical parameters on a consistent basis; overall quality of work and performance is excellent."})]}),e.jsxs(te,{children:[e.jsx(L,{className:"border border-gray-300 p-2",children:"Exceeds Expectations (4)"}),e.jsx(L,{className:"border border-gray-300 p-2",children:"Performance exceeded agreed target(s) on all critical parameters; overall quality of work and performance is very good."})]}),e.jsxs(te,{children:[e.jsx(L,{className:"border border-gray-300 p-2",children:"Meets Expectations (3)"}),e.jsx(L,{className:"border border-gray-300 p-2",children:"Performance target(s) achieved on all critical parameters; overall quality of work and performance is good."})]}),e.jsxs(te,{children:[e.jsx(L,{className:"border border-gray-300 p-2",children:"Occasionally Meets Expectations (2)"}),e.jsx(L,{className:"border border-gray-300 p-2",children:"Performance failed to meet expectations on agreed target(s) and on some critical parameters; performance deficiencies can however be addressed with support through guidance, coaching, mentoring and/ or training."})]})]})]})})]})},{Tr:ae,Th:he,Td:z,THead:Dr,TBody:_r}=D,kr=({filteredData:s,error:r,loading:o})=>e.jsxs(D,{compact:!0,className:"table-auto border-collapse border border-gray-400 w-full bg-white",children:[e.jsx(Dr,{children:e.jsxs(ae,{className:"bg-gray-200",children:[e.jsx(he,{className:"border border-gray-400 p-2 text-center align-middle",children:"Operations and Processes"}),e.jsx(he,{className:"border border-gray-400 p-2 text-center align-middle",children:"Describe Expectations"}),e.jsx(he,{className:"border border-gray-400 p-2 text-center align-middle",children:"Min Score"}),e.jsx(he,{className:"border border-gray-400 p-2 text-center align-middle",children:"Max Score"})]})}),e.jsx(_r,{children:o?e.jsx(ae,{children:e.jsx(z,{colSpan:4,className:"p-4 text-center text-gray-500",children:"Loading competency data..."})}):r?e.jsx(ae,{children:e.jsx(z,{colSpan:4,className:"p-4 text-center text-red-500",children:r})}):s.length===0?e.jsx(ae,{children:e.jsx(z,{colSpan:4,className:"p-4 text-center text-gray-500 font-semibold",children:"No competency data available for the selected quarter."})}):s.map((t,g)=>e.jsx(ke.Fragment,{children:t.details.map((d,l)=>e.jsxs(ae,{children:[l===0&&e.jsx(z,{className:"border border-gray-400 p-2 font-bold",rowSpan:t.details.length,children:t.operations_and_process}),e.jsx(z,{className:"border border-gray-400 p-2",children:d.describe_expectations}),e.jsx(z,{className:"border border-gray-400 p-2 text-center",children:d.min_score}),e.jsx(z,{className:"border border-gray-400 p-2 text-center",children:d.max_score})]},l))},g))})]}),Er=async(s,r,o)=>{try{const t=await G({url:`/operation_and_process?department_id=${s}&team_id=${r}&year=${o}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},Ir=()=>{const[s,r]=a.useState([]),[o,t]=a.useState(""),[g,d]=a.useState(!0),l=async()=>{try{const u=localStorage.getItem("selectedDepartmentID"),f=localStorage.getItem("selectedTeamID"),w=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),b=await Er(u,f?Number(f):null,w?Number(w):null);r(b.data||{})}catch(u){console.error("Error fetching data:",u),t("Failed to load data. Please try again.")}finally{d(!1)}};a.useEffect(()=>{l()},[]);const x=ue(u=>u.quaterTab.selectedQuarter),p=s[x];return console.log(p),e.jsxs("div",{className:"mt-8",children:[e.jsx(Tr,{}),e.jsx(kr,{filteredData:p||[],error:o,loading:g})]})},Cr=async(s,r,o)=>{try{const t=await G({url:`/form_a_comments?department_id=${s}&team_id=${r}&year=${o}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},$r=async s=>{try{const r=await G({url:"/form_a_comments",method:"post",data:s});return console.log(r),r}catch(r){throw console.error("Error fetching information data:",r),r}},Or=()=>{const s=Oe(),[r,o]=a.useState(null),[t,g]=a.useState(!0),[d,l]=a.useState(null),[x,p]=a.useState([]),[u,f]=a.useState(""),[w,b]=a.useState(!1),[E,A]=a.useState({declaration:null,date:null,signature:null,flag:0}),N=a.useRef(null);a.useEffect(()=>{(async()=>{try{const $=localStorage.getItem("selectedDepartmentID")||"",O=localStorage.getItem("selectedTeamID"),F=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),R=await Cr($,O?Number(O):null,F);if(R&&R.data)o(R.data);else throw new Error("Invalid response data")}catch($){console.error("Error fetching data:",$),l("Failed to load data. Please try again.")}finally{g(!1)}})()},[]);const h=async()=>{var M,$,O,F;if(!u.trim()){b(!0),(M=N.current)==null||M.scrollIntoView({behavior:"smooth",block:"center"}),($=N.current)==null||$.focus(),ne.push(e.jsx(oe,{type:"warning",children:"Appraisee's Comments is required"}),{placement:"top-center"});return}b(!1);try{const R=E.date instanceof Date?E.date.toISOString().split("T")[0]:null,H={department_id:localStorage.getItem("selectedDepartmentID")||"",team_id:localStorage.getItem("selectedTeamID"),year:localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),evidence_ids:x,comment:u,date:R,signature:E.signature,declaration:E.declaration,flag:E.flag};(await $r(H)).status===200?ne.push(e.jsx(oe,{title:"Success",type:"success",children:"Data submitted successfully!"}),{placement:"top-center"}):ne.push(e.jsx(oe,{title:"Error",type:"danger",children:"Unexpected server response"}),{placement:"top-center"})}catch(R){const H=((F=(O=R.response)==null?void 0:O.data)==null?void 0:F.error)||R.message||"An unexpected error occurred.";ne.push(e.jsx(oe,{title:"Error",type:"danger",children:H}),{placement:"top-center"})}},I=()=>s(-1),W=()=>s("/form/review");return t?e.jsx("div",{children:"Loading..."}):d?e.jsx("div",{className:"text-red-500",children:d}):e.jsxs("div",{className:"mt-4 mx-auto w-full",children:[e.jsx(Le,{data:r,commentInputRef:N,setSelectedEvidenceIds:p,setCommentText:f,showValidationError:w,setDeclarationData:A}),e.jsx(Ae,{back:"Back",handleBack:I,save:"Save",handleSave:h,next:"Next",handleNext:W})]})},Jr=()=>e.jsxs("div",{children:[e.jsx(Ge,{}),e.jsx(mr,{}),e.jsx(vr,{}),e.jsx(Ir,{}),e.jsx(Or,{})]});export{Jr as default};
