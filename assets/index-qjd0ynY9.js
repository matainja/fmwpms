import{j as e,L as R,r,J as A}from"./index-wWf852Ik.js";import{A as U}from"./AdaptableCard-B97CYy8Y.js";import{w as _,q as D,x as C,b as S,y as H,z as P}from"./Tag-CEdhY7rh.js";import"./SvgIcon-M4Lqzcjs.js";import{I as z,B as y}from"./hoist-non-react-statics.cjs-DtiQhq0b.js";import{E as B,ad as Q,r as k,W as q}from"./Views-Bx7dTT1E.js";import"./FormContainer-D1g8rKO9.js";import{b as J}from"./Upload-DCiQBwz_.js";import"./Select-D8BtPrxW.js";import{t as g,N as b}from"./toast-C_uKvaxB.js";import{d as M}from"./index-ZwnG87dO.js";import{g as L,d as V,a as W}from"./Evidence-CjlXIat9.js";import"./index-hq6mG_IV.js";import"./quill.snow-CcszUxl5.js";import"./cloneDeep-DznBgb_t.js";import"./useThemeClass-PN5gOg17.js";const $=({search:n,onChangeSearch:c})=>e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:gap-x-4",children:[e.jsx("div",{children:e.jsx(z,{size:"sm",placeholder:"Search",value:n,prefix:e.jsx(B,{className:"text-lg"}),onChange:a=>c(a.target.value)})}),e.jsx(R,{className:"block lg:inline-block md:mb-0 mb-4",to:"/Upload-evidence",children:e.jsx(y,{block:!0,variant:"solid",size:"sm",icon:e.jsx(Q,{}),children:"Add Evidence"})})]}),G=n=>{var a;const c=((a=n.split(".").pop())==null?void 0:a.toLowerCase())||"";return["jpg","jpeg","png","gif"].includes(c)?e.jsx("img",{src:n,alt:"thumbnail",className:"w-1/2 h-1/2 rounded"}):c==="pdf"?e.jsx(D,{className:"w-20 h-20 text-red-600"}):["doc","docx"].includes(c)?e.jsx(k,{className:"w-20 h-20 text-blue-600"}):["xls","xlsx"].includes(c)?e.jsx(C,{className:"w-20 h-20 text-green-600"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})},K=({isOpen:n,onClose:c,item:a})=>{const[x,p]=r.useState(!1),f=async m=>{try{p(!0);const d=(await L(m)).data,h=URL.createObjectURL(d),o=document.createElement("a");o.href=h,o.download=(a==null?void 0:a.name)||"file",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(h)}catch(u){console.error("Error fetching evidence data:",u)}finally{p(!1)}};return a?e.jsx(J,{title:"Evidence Details",isOpen:n,onClose:c,onRequestClose:c,children:e.jsxs("div",{className:"flex flex-col gap-2 mt-4 p-4 border rounded bg-white shadow-sm",children:[e.jsx("div",{className:"flex justify-center",children:G(a.file_path)}),e.jsx("div",{className:"font-bold text-black text-lg mt-1.5",children:a.name}),e.jsx("p",{children:a.description}),e.jsx(y,{variant:"solid",className:"flex items-center gap-2 justify-center",disabled:x,onClick:()=>f(a.evidence_id),children:x?e.jsx("span",{children:"Downloading..."}):e.jsxs(e.Fragment,{children:["Download",e.jsx(_,{className:"w-4 h-4"})]})})]})}):null},{Tr:E,Th:v,Td:w,THead:X,TBody:Y}=S,Z=({filteredData:n})=>{const[c,a]=r.useState([]),[x,p]=r.useState(null),[f,m]=r.useState(!1),[u,d]=r.useState(null);r.useEffect(()=>{a(n)},[n]);const h=s=>{d(s),m(!0)},o=()=>{m(!1),d(null)},i=s=>{const t=document.createElement("textarea");t.value=s,t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{if(document.execCommand("copy"))g.push(e.jsx(b,{title:"Success",type:"success",children:"Evidence ID copied to clipboard!"}),{placement:"top-center"});else throw new Error("Fallback copy failed.")}catch(l){console.error("Fallback copy error:",l),g.push(e.jsx(b,{title:"Error",type:"danger",children:"Failed to copy. Please copy manually."}),{placement:"top-center"})}document.body.removeChild(t)},N=s=>{var t;(t=navigator==null?void 0:navigator.clipboard)!=null&&t.writeText?navigator.clipboard.writeText(s).then(()=>{g.push(e.jsx(b,{title:"Success",type:"success",children:"Evidence ID copied to clipboard!"}),{placement:"top-center"})}).catch(l=>{console.error("Clipboard API error:",l),i(s)}):i(s)},j=async s=>{try{p(s),(await V(s)).status===200&&(a(c.filter(l=>l.id!==s)),g.push(e.jsx(b,{title:"Success",type:"success",children:"Evidence deleted successfully!"}),{placement:"top-center"}))}catch(t){console.error("Error deleting evidence:",t),g.push(e.jsx(b,{title:"Error",type:"danger",children:"Failed to delete evidence. Please try again."}),{placement:"top-center"})}finally{p(null)}},F=(s,t)=>s.length>t?`${s.substring(0,t)}...`:s,I=s=>{var l;const t=((l=s.split(".").pop())==null?void 0:l.toLowerCase())||"";return["jpg","jpeg","png","gif"].includes(t)?e.jsx(P,{className:"w-6 h-6 text-blue-600"}):t==="pdf"?e.jsx(D,{className:"w-6 h-6 text-red-600"}):["doc","docx"].includes(t)?e.jsx(k,{className:"w-6 h-6 text-blue-600"}):["xls","xlsx"].includes(t)?e.jsx(C,{className:"w-6 h-6 text-green-600"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})},T=async s=>{try{const l=(await L(s)).data,O=URL.createObjectURL(l);window.open(O,"_blank")}catch(t){console.error("Error fetching evidence data:",t)}};return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs(S,{compact:!0,children:[e.jsx(X,{children:e.jsxs(E,{className:"bg-gray-100 text-gray-700 text-sm",children:[e.jsx(v,{className:"p-4",children:"Name"}),e.jsx(v,{className:"p-4",children:"Description"}),e.jsx(v,{className:"p-4",children:"Url"}),e.jsx(v,{className:"p-4 text-center",children:"Actions"})]})}),e.jsx(Y,{children:c.map(s=>e.jsxs(E,{className:"border-b hover:bg-gray-50",children:[e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[I(s.file_path),e.jsx("span",{className:"font-medium text-gray-800",children:s.name})]})}),e.jsx(w,{className:"p-4 text-gray-600",children:F(s.description,50)}),e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-blue-600 underline max-w-[250px] truncate cursor-pointer",onClick:()=>T(s.evidence_id),children:s.evidence_id}),e.jsx(y,{variant:"solid",className:"text-white bg-blue-700 hover:bg-blue-800",title:"Copy Evidence ID",icon:e.jsx(H,{size:14}),onClick:()=>N(s.evidence_id)})]})}),e.jsx(w,{className:"p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(y,{className:"hover:text-red-600",disabled:x===s.id,onClick:()=>j(s.id),children:e.jsx(q,{className:"w-5 h-5"})}),e.jsx(y,{className:"hover:text-blue-600",onClick:()=>h(s),children:e.jsx(M,{className:"w-5 h-5"})})]})})]},s.id))})]}),u&&e.jsx(K,{isOpen:f,item:u,onClose:o})]})},fe=()=>{const[n,c]=r.useState([]),[a,x]=r.useState([]),[p,f]=r.useState(!0),[m,u]=r.useState(null),[d,h]=r.useState("");return r.useEffect(()=>{(async()=>{try{const i=await W();c(i.data),x(i.data)}catch(i){console.error("Error fetching evidence data:",i),u(i)}finally{f(!1)}})()},[]),r.useEffect(()=>{const o=d.toLowerCase(),i=n.filter(N=>Object.values(N).some(j=>j==null?void 0:j.toString().toLowerCase().includes(o)));x(i)},[d,n]),e.jsxs(U,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"List Of Evidence"}),e.jsx($,{search:d,onChangeSearch:h})]}),p?e.jsx(A,{loading:!0}):m?e.jsx("p",{children:"No evidence data found !!."}):e.jsx(Z,{filteredData:a})]})};export{fe as default};
