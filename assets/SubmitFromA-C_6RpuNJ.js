import{j as e,r as n,a0 as U,$ as J,p as Fe,aM as re,G as we,a as ge,u as G,aZ as Ie,a_ as Se,a$ as Ce,aQ as _e,J as $e,aR as Re,a2 as Ae,b0 as Oe}from"./index-CdXcW46_.js";import{S as oe}from"./Select-epRO6R5x.js";import{ae as ie,af as Pe,R as xe,ag as Qe,J as Me,ah as qe}from"./Views-YlTiOC4j.js";import"./FormContainer-B5i-gxwG.js";import{E as Le,q as Ye,x as We,b as Y,C as ze,G as pe}from"./Tag-BIrPdKNG.js";import{I as F,B as L}from"./hoist-non-react-statics.cjs-BYdDfNAW.js";import{b as de,e as He,T as De}from"./Upload-CkxX527j.js";import{t as H,N as B}from"./toast-DnPvOHpm.js";import{S as Be,h as Ve}from"./html2canvas.esm-G4AsU0nj.js";import{g as Ge}from"./Evidence-DfVwVGI_.js";import{F as Ue,H as Ke,I as Je}from"./FooterButtonpart-BY3ZRglS.js";import{C as Xe,a as Te,g as Ze}from"./competency-CcdfSGmM.js";import"./SvgIcon-789oDBY2.js";import"./index-8ORoQwk5.js";import"./index-GRSH0cfX.js";import"./quill.snow-CicULtXM.js";import"./cloneDeep-DznBgb_t.js";import"./useThemeClass-Cjhy4_sh.js";const et=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"SECTION 7 : CONFIRMATION AND ACKNOWLEDGEMENTS"})})})}),tt=({evidenceList:t=[],onChange:r})=>{const[a,m]=n.useState(!1),[d,N]=n.useState([]),b=Array.isArray(t)?t.map(u=>({label:u.name,value:u.evidence_id})):[],g=u=>{d.some(w=>w.value===u.evidence_id)||N(w=>[...w,{label:u.name,value:u.evidence_id}]),m(!1)},x=u=>{var w;const v=((w=u.split(".").pop())==null?void 0:w.toLowerCase())||"";return["jpg","jpeg","png","gif"].includes(v)?e.jsx(Le,{className:"w-8 h-8 text-blue-600"}):v==="pdf"?e.jsx(Ye,{className:"w-8 h-8 text-red-600"}):["xls","xlsx"].includes(v)?e.jsx(We,{className:"w-8 h-8 text-green-600"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})};return n.useEffect(()=>{const u=d.map(v=>v.value);r(u)},[d,r]),e.jsxs("div",{className:"w-full sm:w-1/2 mb-4",children:[e.jsx("label",{className:"text-gray-800 font-semibold mb-1.5 block",children:"Evidence Information:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsx(oe,{isMulti:!0,placeholder:"Please Select",className:"w-full flex-1",options:b,value:d,onChange:N}),e.jsx(ie,{className:"w-6 h-6 text-gray-500 hover:text-gray-700 cursor-pointer mt-1 sm:mt-0",onClick:()=>m(!0)}),e.jsx(de,{title:"Evidence Details",isOpen:a,width:500,onClose:()=>m(!1),onRequestClose:()=>m(!1),children:e.jsx("div",{className:"space-y-4 p-4 max-w-full",children:Array.isArray(t)&&t.map(u=>e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-100 border-blue-500 flex flex-col sm:flex-row justify-between items-start sm:items-center cursor-pointer hover:bg-blue-50",onClick:()=>g(u),children:[e.jsxs("div",{className:"space-y-1 w-full sm:w-3/4",children:[e.jsx("h4",{className:"font-semibold text-lg",children:u.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:u.description}),e.jsx("a",{href:u.file_path,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline mt-2 block text-sm font-bold",children:"View File"})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-4",children:x(u.file_path)})]},u.id))})})]})]})},st=({comments:t,onAppraisersCommentChange:r,showValidationError:a,commentInputRef:m})=>{var g;const[d,N]=n.useState("");n.useEffect(()=>{const x=t.staff.comment||"";N(x),r(x)},[t.staff.comment]);const b=x=>{const u=x.target.value;N(u),r(u)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Appraisee's Comments:"}),e.jsx(F,{textArea:!0,disabled:!0,className:"input-textarea mt-2",value:t.staff.comment||""})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Appraiser's Comments:"}),e.jsx(F,{required:!0,ref:m,textArea:!0,value:d,placeholder:"Enter your comments here",className:`textarea mt-2 w-full rounded-md border px-3 py-2 focus:outline-none ${a&&!d?"border-red-500":"border-gray-300"}`,onChange:b}),a&&!d&&e.jsxs("div",{className:"flex items-center text-red-500 mt-1",children:[e.jsx(Pe,{className:"mr-1"}),"This field is required."]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Countersigning Officer's Comments:"}),e.jsx(F,{disabled:!0,textArea:!0,value:((g=t.officer)==null?void 0:g.comment)||"",className:"input-textarea mt-2"})]})]})},rt=({Staff:t})=>{const r=[{value:1,label:"Agree"},{value:0,label:"Disagree"}],a=r.find(m=>m.value===(t==null?void 0:t.declaration));return e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"bg-gray-400 h-0.5"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"flex flex-col order-1",children:[e.jsx("label",{htmlFor:"declaration",className:"text-gray-800 font-semibold",children:"Appraisee's Declaration:"}),e.jsx(oe,{isDisabled:!0,id:"declaration",value:a,options:r,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col order-2",children:[e.jsx("label",{htmlFor:"date",className:"text-gray-800 font-semibold",children:"Date:"}),e.jsx(F,{disabled:!0,id:"date",value:(t==null?void 0:t.date)||"",className:"mt-2"})]}),e.jsx("div",{className:"order-3",children:e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold",children:"Appraisee's Signature:"})}),e.jsxs("div",{className:"flex flex-col order-4",children:[e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold underline",children:"Signatured by Appraisee"}),e.jsx("div",{id:"signature",className:"border border-gray-300 p-2 rounded-md mt-2 w-full h-35 flex items-center justify-center",children:t!=null&&t.signature?e.jsx("img",{src:t.signature,alt:"Appraiser's Signature",className:"h-full w-full rounded-md object-contain"}):e.jsx("span",{className:"text-gray-400",children:"No Signature"})})]})]})]})},be=[{value:1,label:"Agree"},{value:0,label:"Disagree"}],at=({Supervisor:t,onChange:r,officerDeclaration:a})=>{const[m,d]=n.useState(null),[N,b]=n.useState(null),[g,x]=n.useState(null),[u,v]=n.useState(null),[w,C]=n.useState(!1),[D,y]=n.useState(0),T=n.useRef(null),h=n.useRef(null),f=n.useRef(null);n.useEffect(()=>{t&&(d(t.declaration),x(t.signature),b(t.date?new Date(t.date):null),y((t.signature,0)))},[t]);const S=s=>{var j;const i=(j=s.target.files)==null?void 0:j[0];if(i){if(i.size>70*1024){alert("File size exceeds 70Kb. Please upload a smaller file.");return}if(!i.type.startsWith("image/")){alert("Invalid file type. Please upload an image.");return}const _=new FileReader;_.onloadend=()=>{const E=_.result;x(E),v(i.name),y(1)},_.readAsDataURL(i)}},c=()=>{C(!0)},p=async()=>{if(h.current&&!h.current.isEmpty()){if(f.current){const i=(await Ve(f.current)).toDataURL("image/png");x(i),y(1),C(!1)}}else alert("Please draw a signature before saving.")},l=()=>{var s;(s=h.current)==null||s.clear()};return n.useEffect(()=>{const s=N!==null?new Date(N.getFullYear(),N.getMonth(),N.getDate()+1):null,i={declaration:m,date:s,flag:D};D===1&&(i.signature=g),r(i)},[m,N,g,D]),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4 items-start mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Appraiser's Declaration:"}),e.jsx(oe,{isDisabled:a===1,placeholder:"Please Select",options:be,className:"mt-2",value:be.find(s=>s.value===m),onChange:s=>d((s==null?void 0:s.value)??null)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Date:"}),e.jsx(He,{disabled:a===1,className:"mt-2",value:N,onChange:s=>b(s)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold mb-1",children:"Appraiser's Signature:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",disabled:a===1,className:`flex items-center gap-2 focus:outline-none text-white font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2
                ${a===1?"bg-gray-400 cursor-not-allowed":"bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300"}`,onClick:c,children:[e.jsx(xe,{className:"w-5 h-5"}),"Add Signature"]}),e.jsxs("button",{type:"button",disabled:a===1,className:`flex items-center gap-2 focus:outline-none text-white font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2
                ${a===1?"bg-gray-400 cursor-not-allowed":"bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300"}`,onClick:()=>{var s;return(s=T.current)==null?void 0:s.click()},children:[e.jsx(Qe,{className:"w-5 h-5"}),"Upload"]}),e.jsx("input",{ref:T,type:"file",accept:"image/*",className:"hidden",onChange:S})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"Uploaded Image:"}),g&&e.jsx("div",{className:"border border-gray-400 p-2 rounded-md mt-2 w-50 h-44 flex items-center justify-center",children:e.jsx("img",{src:g,alt:"Uploaded Preview",className:"h-full w-full object-fill rounded-md"})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Draw Your Signature"}),e.jsx("button",{onClick:()=>C(!1),children:e.jsx(Me,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{ref:f,className:" rounded-md mt-4 bg-white",children:e.jsx(Be,{ref:h,canvasProps:{width:330,height:150,className:"sigCanvas "}})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(L,{size:"sm",variant:"default",onClick:l,children:"Clear"}),e.jsx(L,{size:"sm",variant:"solid",onClick:p,children:"Save"})]})]})})]})},lt=({officer:t})=>{const r=[{value:1,label:"Agree"},{value:0,label:"Disagree"}],a=r.find(m=>m.value===(t==null?void 0:t.declaration));return e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"bg-gray-400 h-0.5"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-4",children:[e.jsxs("div",{className:"flex flex-col order-1",children:[e.jsx("label",{htmlFor:"declaration",className:"text-gray-800 font-semibold",children:"Countersigning Officer's Declaration:"}),e.jsx(oe,{isDisabled:!0,id:"declaration",value:a,options:r,className:"mt-2"})]}),e.jsxs("div",{className:"flex flex-col order-2",children:[e.jsx("label",{htmlFor:"date",className:"text-gray-800 font-semibold",children:"Date:"}),e.jsx(F,{disabled:!0,id:"date",value:(t==null?void 0:t.date)||"",className:"mt-2"})]}),e.jsx("div",{className:"order-3",children:e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold",children:"Countersigning Officer's Signature:"})}),e.jsxs("div",{className:"flex flex-col order-4",children:[e.jsx("label",{htmlFor:"signature",className:"text-gray-800 font-semibold underline",children:"Signatured by Countersigning Officer's"}),e.jsx("div",{id:"signature",className:"border border-gray-300 p-2 rounded-md mt-2 w-full h-35 flex items-center justify-center",children:t!=null&&t.signature?e.jsx("img",{src:t.signature,alt:"Appraiser's Signature",className:"h-full w-full rounded-md object-contain"}):e.jsx("span",{className:"text-gray-400",children:"No Signature"})})]})]})]})},nt=async(t,r,a,m)=>{try{const d=await U({url:`/supervisor/form_a_comments?department_id=${t}&team_id=${r}&year=${a}&staff_id=${m}`,method:"get"});return console.log(d),d}catch(d){throw console.error("Error fetching information data:",d),d}},ct=async t=>{try{const r=await U({url:"/supervisor/form_a_comments",method:"post",data:t});return console.log(r),r}catch(r){throw console.error("Error fetching information data:",r),r}},ot=({submittedEvidence:t})=>{if(!t||t.length===0)return e.jsx("p",{className:"text-gray-500",children:"No submitted evidence available."});const r=async a=>{try{const d=(await Ge(a)).data,N=URL.createObjectURL(d);window.open(N,"_blank")}catch(m){console.error("Error fetching evidence data:",m)}};return e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-800 font-semibold mb-1.5 block",children:"Submitted Evidence:"}),e.jsx("div",{className:"flex flex-col gap-4",children:t.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-md",children:[e.jsx("span",{className:"text-blue-600 underline max-w-[250px] truncate cursor-pointer",onClick:()=>r(a.evidence_id),children:a.evidence_id}),e.jsx("div",{className:"flex-1 text-right",children:e.jsxs("p",{className:"text-gray-500 text-sm",children:[e.jsx("strong",{children:"Created:"})," ",new Date(a.created_at).toLocaleDateString()]})})]},a.id))})]})},it=()=>{var l,s,i,j,_,E,I,k,z,W;const{id:t}=J(),r=Fe(),[a,m]=n.useState(null),[d,N]=n.useState(!0),[b,g]=n.useState(null),[x,u]=n.useState([]),[v,w]=n.useState(""),[C,D]=n.useState(!1),y=async()=>{try{const P=localStorage.getItem("selectedDepartmentID")||"",K=localStorage.getItem("selectedTeamID"),ee=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),M=await nt(P,K?Number(K):null,ee,String(t));if(M&&M.data)m(M.data);else throw new Error("Invalid response data")}catch(P){console.error("Error fetching data:",P),g("Failed to load data. Please try again.")}finally{N(!1)}};n.useEffect(()=>{y()},[]);const[T,h]=n.useState({declaration:null,date:null,signature:null,flag:0}),f=n.useRef(null),S=async()=>{var P,K,ee;if(!v.trim()){D(!0),(P=f.current)==null||P.scrollIntoView({behavior:"smooth",block:"center"}),H.push(e.jsx(B,{title:"Error",type:"danger",children:"Appraiser 's Comments is reuired"}),{placement:"top-center"});return}try{const M=T.date instanceof Date?T.date.toISOString().split("T")[0]:null,o={department_id:localStorage.getItem("selectedDepartmentID")||"",team_id:localStorage.getItem("selectedTeamID"),year:localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),evidence_ids:x,comment:v,date:M,signature:T.signature,declaration:T.declaration,flag:T.flag,staff_id:String(t)};(await ct(o)).status===200?H.push(e.jsx(B,{title:"Success",type:"success",children:"Data submitted successfully!"}),{placement:"top-center"}):H.push(e.jsx(B,{title:"Error",type:"danger",children:"Unexpected response from the server. Please try again."}),{placement:"top-center"})}catch(M){const o=((ee=(K=M.response)==null?void 0:K.data)==null?void 0:ee.error)||M.message||"An unexpected error occurred.";H.push(e.jsx(B,{title:"Error",type:"danger",children:o}),{placement:"top-center"}),console.error("Error submitting data:",M)}},c=()=>{r(-1)},p=()=>{r(`/form/supervisor/review/${t}`)};return d?e.jsx("div",{children:"Loading..."}):b?e.jsx("div",{className:"text-red-500",children:b}):e.jsxs("div",{className:"mt-4  mx-auto w-full ",children:[e.jsx(et,{}),e.jsxs("div",{className:"bg-white p-4",children:[e.jsx("div",{className:"mt-4",children:e.jsx(ot,{submittedEvidence:((s=(l=a==null?void 0:a.comments)==null?void 0:l.staff)==null?void 0:s.evidence)||[]})}),e.jsx("div",{className:"mt-4",children:e.jsx(tt,{evidenceList:(a==null?void 0:a.evidence_list)||[],onChange:u})}),e.jsx("div",{className:"mt-4",children:e.jsx(st,{commentInputRef:f,comments:{staff:((i=a==null?void 0:a.comments)==null?void 0:i.staff)||{comment:""},supervisor:((j=a==null?void 0:a.comments)==null?void 0:j.supervisor)||{comment:""},officer:((_=a==null?void 0:a.comments)==null?void 0:_.officer)||{comment:""}},showValidationError:C,onAppraisersCommentChange:w})}),e.jsx("div",{className:"mt-4",children:e.jsx(rt,{Staff:(E=a==null?void 0:a.comments)==null?void 0:E.staff})}),e.jsx("div",{className:"mt-4",children:e.jsx(at,{Supervisor:(I=a==null?void 0:a.comments)==null?void 0:I.supervisor,onChange:P=>{h(P)},officerDeclaration:(z=(k=a==null?void 0:a.comments)==null?void 0:k.officer)==null?void 0:z.declaration})}),e.jsx("div",{className:"mt-4",children:e.jsx(lt,{officer:(W=a==null?void 0:a.comments)==null?void 0:W.officer})})]}),e.jsx(Ue,{back:"Back",handleBack:c,save:"Save",handleSave:S,next:"Next",handleNext:p})]})},{Tr:je,Th:ae,Td:le,THead:dt,TBody:mt}=Y,ut=[{grade:"O",description:"Outstanding - 100%",quarter:"Q1",value:"First Quarter"},{grade:"E",description:"Excellent - 90%",quarter:"Q2",value:"Second Quarter"},{grade:"VG",description:"Very Good - 80%",quarter:"Q3",value:"Third Quarter"},{grade:"G",description:"Good - 70%",quarter:"Q4",value:"Fourth Quarter"}],gt=()=>{const[t,r]=n.useState(!1),[a,m]=n.useState(window.innerWidth<=1024);re(b=>b.quaterTab.selectedQuarter),n.useEffect(()=>{const b=()=>{m(window.innerWidth<=1024)};return window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]);const d=()=>{r(!0)},N=()=>{r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"SECTION 3 : EMPLOYEE'S TASKS (70%)"}),e.jsx("div",{className:"flex space-x-2 ml-auto",children:e.jsx(L,{variant:"twoTone",size:"xs",icon:e.jsx(ie,{}),"aria-label":"View Scoring Criteria Values",onClick:d,children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Scoring Criteria Values"})})})]})}),e.jsx(de,{title:"Vertical Drawer",isOpen:t,placement:"right",width:a?"100%":800,onClose:N,onRequestClose:N,children:e.jsxs(Y,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(dt,{children:e.jsxs(je,{className:"bg-gray-100",children:[e.jsx(ae,{className:"border border-gray-300 p-2",children:"Grade"}),e.jsx(ae,{className:"border border-gray-300 p-2",children:"Description"}),e.jsx(ae,{className:"border border-gray-300 p-2",children:"Quarter"}),e.jsx(ae,{className:"border border-gray-300 p-2",children:"Value"})]})}),e.jsx(mt,{children:ut.map((b,g)=>e.jsxs(je,{children:[e.jsx(le,{className:"border border-gray-300 p-2",children:b.grade}),e.jsx(le,{className:"border border-gray-300 p-2",children:b.description}),e.jsx(le,{className:"border border-gray-300 p-2",children:b.quarter}),e.jsx(le,{className:"border border-gray-300 p-2",children:b.value})]},g))})]})})]})},xt=async(t,r,a,m)=>{try{return await U({url:`/supervisor/employeetask?department_id=${t}&team_id=${r}&year=${a}&staff_id=${m}`,method:"get"})}catch(d){throw console.error("Error fetching information data:",d),d}},ht=async t=>{try{return await U({url:"supervisor/employeetask",method:"post",data:t})}catch(r){throw console.error("Error saving employee task:",r),r}},{Tr:me,Th:V,Td:A,THead:pt,TBody:bt}=Y,jt=({MainData:t})=>{const{id:r}=J(),a=re(h=>h.quaterTab.selectedQuarter),m=Number(localStorage.getItem("selectedTeamID"))||0,d=Number(localStorage.getItem("selectedYear"))||new Date().getFullYear(),N=localStorage.getItem("selectedDepartmentID")||"";console.log(t);const[b,g]=n.useState(t);n.useEffect(()=>{g(t)},[t]),console.log(b);const x=h=>h.reduce((f,S)=>f+Number(v(S.objectiveWeight||"0")),0),u=(h,f,S)=>{const c=h.target.value;if(/^[0-9]*\.?[0-9]*$/.test(c)){const p=[...b];p[f].rows[S].objectiveWeight=c,g(p)}},v=h=>{if(!h||parseFloat(h)===0)return 0;const f=b.reduce((S,c)=>S+c.rows.reduce((p,l)=>p+parseFloat(l.objectiveWeight||"0"),0),0);return f===0?0:70/f*parseFloat(h)},w=b.reduce((h,f)=>h+f.rows.reduce((S,c)=>S+parseFloat(c.objectiveWeight||"0"),0),0),C=b.reduce((h,f)=>h+f.rows.reduce((S,c)=>S+Number(v(c.objectiveWeight||"0")),0),0),D=h=>{const f=[...b];f.splice(h,1),g(f)},y=(h,f)=>{const S=[...b];S[h].rows.splice(f,1),g(S)},T=async()=>{const h=b.map(S=>({kra_name:S.selectedKRA,kra_weight:parseFloat(x(S.rows).toFixed(2)),objective:S.rows.map(c=>({objective_name:c.selectedObjective,objective_weight:parseFloat(c.objectiveWeight),gradeed_weight:parseFloat(v(c.objectiveWeight).toFixed(2)),target:parseFloat(c.target),kpi:c.selectedKPI,unit:c.notes,aggregate:null,quarter_marks:0,target_achieved:0,raw:0,weighted:0}))})),f={department_id:N,staff_id:r,team_id:m,year:d,quater:a,employee_task:h,total_weight:70,total_graded_weight:parseFloat(C.toFixed(2))};console.log("Saved Data:",f);try{(await ht(f)).status===201&&H.push(e.jsx(B,{title:"Success",type:"success",children:"Data saves Successfully"}),{placement:"top-center"})}catch(S){console.error("Error saving data:",S),H.push(e.jsx(B,{title:"Error",type:"danger",children:"Failed to save data. Please try again."}),{placement:"top-center"})}};return e.jsxs("div",{children:[e.jsxs(Y,{compact:!0,className:"border border-gray-400 bg-white",children:[e.jsx(pt,{children:e.jsxs(me,{className:"bg-gray-200",children:[e.jsx(V,{className:"border border-gray-400 p-2",children:"S/N"}),e.jsx(V,{className:"border border-gray-400 p-2",children:"Key Result Areas"}),e.jsx(V,{className:"border border-gray-400 p-2",children:"Weight"}),e.jsx(V,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(V,{className:"border border-gray-400 p-2",children:"Weight"}),e.jsx(V,{className:"border border-gray-400 p-2",children:"Grade Weight"}),e.jsx(V,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(V,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(V,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsxs(bt,{children:[b.map((h,f)=>h.rows.map((S,c)=>e.jsxs(me,{children:[c===0&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{className:"border border-gray-400",rowSpan:h.rows.length,children:[h.serialNumber||f+1,e.jsx(Xe,{className:"text-xl text-red-600 cursor-pointer",onClick:()=>D(f)})]}),e.jsx(A,{className:"border border-gray-400",rowSpan:h.rows.length,children:h.selectedKRA}),e.jsx(A,{className:"border border-gray-400",rowSpan:h.rows.length,children:x(h.rows).toFixed(2)})]}),e.jsxs(A,{className:"border border-gray-400",children:[h.rows.length>2&&e.jsx(Te,{className:"text-xl text-red-600 cursor-pointer m-auto",onClick:()=>y(f,c)}),e.jsx(F,{textArea:!0,value:S.selectedObjective,onChange:p=>{const l=[...b];l[f].rows[c].selectedObjective=p.target.value,g(l)}})]}),e.jsx(A,{className:"border border-gray-400",children:e.jsx(F,{className:"w-full",value:S.objectiveWeight,onChange:p=>u(p,f,c)})}),e.jsx(A,{className:"border border-gray-400 text-center",children:v(S.objectiveWeight).toFixed(2)}),e.jsx(A,{className:"border border-gray-400",children:e.jsx(F,{value:S.target,onChange:p=>{const l=p.target.value;if(/^\d*\.?\d*$/.test(l)){const s=[...b];s[f].rows[c].target=l,g(s)}}})}),e.jsx(A,{className:"border border-gray-400",children:e.jsx(F,{textArea:!0,value:S.selectedKPI,onChange:p=>{const l=[...b];l[f].rows[c].selectedKPI=p.target.value,g(l)}})}),e.jsx(A,{className:"border border-gray-400",children:e.jsx(F,{textArea:!0,value:S.notes,onChange:p=>{const l=[...b];l[f].rows[c].notes=p.target.value,g(l)}})})]},`${f}-${c}`))),e.jsxs(me,{children:[e.jsx(A,{className:"border border-gray-400 text-center",colSpan:2,children:"Total"}),e.jsx(A,{className:"border border-gray-400 text-center",children:"70"}),e.jsx(A,{className:"border border-gray-400 text-center"}),e.jsx(A,{className:"border border-gray-400 text-center",children:w.toFixed(2)}),e.jsx(A,{className:"border border-gray-400 text-center",children:C.toFixed(2)}),e.jsx(A,{className:"border border-gray-400 text-center",colSpan:3})]})]})]}),e.jsx("div",{className:"text-right mt-4",children:e.jsx(L,{variant:"solid",color:"green-700",onClick:T,children:"Save"})})]})},ft=()=>{const t=re(w=>w.quaterTab.selectedQuarter);console.log("Selected Quarter:",t);const{id:r}=J(),[a,m]=n.useState(!0),[d,N]=n.useState(null),[b,g]=n.useState({1:[],2:[],3:[],4:[]}),x=n.useCallback(async()=>{m(!0),N(null);try{const w=localStorage.getItem("selectedDepartmentID"),C=localStorage.getItem("selectedTeamID"),D=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),y=await xt(w,C?Number(C):null,D,r);g(y.data||{})}catch(w){console.error("Error fetching data:",w),N("Failed to load data. Please try again.")}finally{m(!1)}},[r]);n.useEffect(()=>{r&&x()},[x,r]);const v=(b[t]||[]).map((w,C)=>({serialNumber:C+1,selectedKRA:w.kra_name,rows:w.objectives.map(D=>({selectedObjective:D.objective_name,objectiveWeight:D.objective_weight.toString(),target:D.target.toString(),selectedKPI:D.kpi,notes:D.unit}))}));return console.log("Transformed Data:",v),e.jsxs("div",{className:"mt-4",children:[e.jsx(gt,{}),e.jsx(jt,{MainData:v})]})},yt=async(t,r,a,m)=>{try{return await U({url:`/supervisor/competencies?department_id=${t}&team_id=${r}&year=${a}&staff_id=${m}`,method:"get"})}catch(d){throw console.error("Error fetching information data:",d),d}},Nt=async t=>{try{return await U({url:"supervisor/competencies",method:"post",data:t})}catch(r){throw console.error("Error fetching information data:",r),r}};function ue(t){return we({attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 3c-4.963 0-9 4.038-9 9s4.037 9 9 9 9-4.038 9-9-4.037-9-9-9zm0 16c-3.859 0-7-3.14-7-7s3.141-7 7-7 7 3.14 7 7-3.141 7-7 7zM12.707 12l2.646-2.646c.194-.194.194-.512 0-.707-.195-.194-.513-.194-.707 0l-2.646 2.646-2.646-2.647c-.195-.194-.513-.194-.707 0-.195.195-.195.513 0 .707l2.646 2.647-2.646 2.646c-.195.195-.195.513 0 .707.097.098.225.147.353.147s.256-.049.354-.146l2.646-2.647 2.646 2.646c.098.098.226.147.354.147s.256-.049.354-.146c.194-.194.194-.512 0-.707l-2.647-2.647z"},child:[]}]})(t)}function vt(t){return we({attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16.972 6.251c-.967-.538-2.185-.188-2.72.777l-3.713 6.682-2.125-2.125c-.781-.781-2.047-.781-2.828 0-.781.781-.781 2.047 0 2.828l4 4c.378.379.888.587 1.414.587l.277-.02c.621-.087 1.166-.46 1.471-1.009l5-9c.537-.966.189-2.183-.776-2.72z"},child:[]}]})(t)}const{Tr:te,Th:X,Td:Q,THead:wt,TBody:St}=Y,Ct=({competencyData:t,loading:r,allQuarterData:a,onCopy:m,isConfirmed:d})=>{const{id:N}=J(),b=ge(),g=G(l=>l.quaterTab.selectedQuarter),x=G(l=>l.competency.isEditing),[u,v]=n.useState([]);n.useEffect(()=>{v(t)},[t]);const w=()=>{const l=parseInt(g);if(l===1)return;const s=(l-1).toString(),i=a[s];if(!i||i.length===0){alert(`No data available in Q${s} to copy`);return}const j=JSON.parse(JSON.stringify(i));m(g,j),alert(`Data copied from Q${s} to Q${g}`)},C=()=>!r&&u.length===0&&parseInt(g)>1,D=(l,s)=>{v(i=>{const j=[...i],_={...j[l]},E=[..._.competencies_details||[]].filter((I,k)=>k!==s);return E.length===0?j.splice(l,1):(_.competencies_details=E,j[l]=_),j})},y=u.reduce((l,s)=>l+s.competencies_details.reduce((i,j)=>i+Number(j.min_score),0),0),T=u.reduce((l,s)=>l+s.competencies_details.reduce((i,j)=>i+Number(j.max_score),0),0),h=T>0?20*y/T:0,f=(l,s)=>l<0||l>4?{isValid:!1,message:"Min score must be between 0 and 4"}:s<1||s>5?{isValid:!1,message:"Max score must be between 1 and 5"}:s<=l?{isValid:!1,message:"Max score must be greater than Min score"}:{isValid:!0},S=(l,s,i,j)=>{const _=Number(j);v(E=>{const I=[...E],k={...I[l]},z=[...k.competencies_details||[]];if(z[s]){const W={...z[s],[i]:_},{isValid:P}=f(W.min_score,W.max_score);z[s]=P?W:{...z[s],[i]:0}}return k.competencies_details=z,I[l]=k,I})},c=(l,s,i,j)=>{v(_=>{const E=[..._],I={...E[l]};if(i==="competencies")I.competencies=j;else{const k=[...I.competencies_details||[]];k[s]&&(k[s]={...k[s],[i]:j}),I.competencies_details=k}return E[l]=I,E})},p=async()=>{b(Ie()),b(Se(u)),b(Ce(!1));const l=localStorage.getItem("selectedDepartmentID")||"",s=localStorage.getItem("selectedTeamID"),i=localStorage.getItem("selectedYear")||new Date().getFullYear().toString(),j=g,_=u.map(I=>({competencies_name:I.competencies,details:I.competencies_details.map(k=>({cluster:k.cluster,sub_cluster:k.sub_cluster,describe_expectations:k.describe_expectations,min_score:Number(k.min_score),max_score:Number(k.max_score),quarter_marks:0}))})),E={department_id:l,staff_id:N,team_id:s?Number(s):null,year:Number(i),quater:Number(j),data:_,total_max_score:20,total_min_score:h};try{(await Nt(E)).status===201&&H.push(e.jsx(B,{title:"Success",type:"success",children:"Data saved successfully"}),{placement:"top-center"})}catch(I){console.error("Error saving data:",I),H.push(e.jsx(B,{title:"Error",type:"danger",children:"Failed to save data. Please try again."}),{placement:"top-center"})}};return e.jsxs("div",{children:[e.jsxs(Y,{compact:!0,className:"w-full border border-gray-400 bg-white",children:[e.jsx(wt,{children:e.jsxs(te,{className:"bg-gray-200",children:[e.jsx(X,{className:"border border-gray-400 text-center w-[5%]",children:"Action"}),e.jsx(X,{className:"border border-gray-400",children:"Competency"}),e.jsx(X,{className:"border border-gray-400",children:"Cluster"}),e.jsx(X,{className:"border border-gray-400",children:"Sub Cluster"}),e.jsx(X,{className:"border border-gray-400",children:"Description"}),e.jsx(X,{className:"border border-gray-400 text-center w-[8%]",children:"Min"}),e.jsx(X,{className:"border border-gray-400 text-center w-[8%]",children:"Max"})]})}),e.jsxs(St,{children:[r?e.jsx(te,{children:e.jsx(Q,{colSpan:7,className:"text-center py-4 text-blue-500",children:"Loading..."})}):C()?e.jsx(te,{children:e.jsx(Q,{colSpan:7,className:"text-center py-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("span",{className:"text-black font-semibold text-lg mb-3",children:["No data for Q",g,". Copy from Q",parseInt(g)-1,"?"]}),e.jsxs(L,{className:"w-64",onClick:w,children:["Copy from Q",parseInt(g)-1]})]})})}):u.length===0?e.jsx(te,{children:e.jsx(Q,{colSpan:7,className:"text-center py-4",children:e.jsxs("span",{className:"text-black font-semibold text-lg",children:["No data available for Q",g]})})}):u.map((l,s)=>l.competencies_details.map((i,j)=>e.jsxs(te,{children:[e.jsx(Q,{className:"text-center border border-gray-400",children:x?e.jsx("button",{onClick:()=>D(s,j),className:"text-red-500 text-xl",children:e.jsx(ue,{})}):d(l)?e.jsx("span",{className:"text-green-600 text-xl",children:e.jsx(vt,{})}):null}),e.jsx(Q,{className:"px-2 py-1 border border-gray-400",children:x?e.jsx(F,{value:l.competencies,onChange:_=>c(s,j,"competencies",_.target.value),className:"w-full"}):l.competencies}),e.jsx(Q,{className:"border border-gray-400",children:x?e.jsx(F,{textArea:!0,value:i.cluster,className:"w-full",onChange:_=>c(s,j,"cluster",_.target.value)}):i.cluster}),e.jsx(Q,{className:"border border-gray-400",children:x?e.jsx(F,{textArea:!0,value:i.sub_cluster,className:"w-full",onChange:_=>c(s,j,"sub_cluster",_.target.value)}):i.sub_cluster}),e.jsx(Q,{className:"border border-gray-400",children:x?e.jsx(F,{textArea:!0,value:i.describe_expectations,className:"w-full",onChange:_=>c(s,j,"describe_expectations",_.target.value)}):i.describe_expectations}),e.jsx(Q,{className:"text-center border border-gray-400",children:x?e.jsx(F,{value:i.min_score.toString(),className:"text-center",onChange:_=>S(s,j,"min_score",_.target.value)}):i.min_score}),e.jsx(Q,{className:"text-center border border-gray-400",children:x?e.jsx(F,{value:i.max_score.toString(),className:"text-center",onChange:_=>S(s,j,"max_score",_.target.value)}):i.max_score})]},`${l.id}-${i.id}`))),e.jsxs(te,{className:"bg-gray-200",children:[e.jsx(Q,{className:"text-center",colSpan:5,children:"Total"}),e.jsx(Q,{className:"text-center border border-gray-400",children:h.toFixed(2)}),e.jsx(Q,{className:"text-center border border-gray-400",children:"20"})]})]})]}),e.jsx("div",{className:"text-right mt-4",children:e.jsx(L,{variant:"solid",color:"green-700",onClick:p,children:"Save"})})]})},_t=({onClose:t,onConfirm:r})=>{var M;const a=re(o=>o.quaterTab.selectedQuarter),m=_e(),[d,N]=n.useState([]),[b,g]=n.useState(!0),[x,u]=n.useState(null),[v,w]=n.useState([]),[C,D]=n.useState(""),[y,T]=n.useState(""),[h,f]=n.useState(""),[S,c]=n.useState(""),[p,l]=n.useState(!0),[s,i]=n.useState(!1),j=async()=>{g(!0),u(null);try{const o=await Ze();N(o.data||[])}catch(o){console.error("Error fetching data:",o),u("Failed to load data. Please try again.")}finally{g(!1)}};n.useEffect(()=>{j()},[]);const _=()=>{C&&(w(o=>[...o,{competency:C,subcategory:y||"",title:h||"",description:S||"",isCustom:!1}]),D(""),T(""),f(""),c(""),l(!0))},E=()=>{s||(w(o=>[...o,{competency:"",subcategory:"",title:"",description:"",isCustom:!0}]),i(!0),setTimeout(()=>i(!1),3e3))},I=o=>{D(o),T(""),f(""),c(""),l(!o)},k=o=>{T(o),f(""),c("")},z=o=>{f(o),c("")},W=(o,$,R)=>{w(Ee=>Ee.map((he,ke)=>ke===o?{...he,[$]:R}:he))},P=()=>{const o=v.filter(R=>R.competency.trim()!=="");if(o.length===0){alert("Please select at least a competency.");return}const $=o.map(R=>({id:"",staff_id:"",dept_id:"",team_id:"",year:"",competencies:R.competency,quarter:a,aggregate:null,created_at:"",updated_at:"",competencies_details:[{id:"",competencies_id:"",cluster:R.subcategory||"",sub_cluster:R.title||"",describe_expectations:R.description||"",min_score:0,max_score:0,quarter_marks:0,created_at:null,updated_at:null}]}));r($),m(Se($)),t()},K=()=>{var o;return((o=d.find($=>$.competencies_name===C))==null?void 0:o.details[y])||[]},ee=()=>{const o=K();return Array.from(new Map(o.map($=>[$.title,$])).values())};return e.jsxs("div",{className:"p-2",children:[b?e.jsx("div",{className:"text-center text-gray-500",children:e.jsx($e,{loading:!0})}):x?e.jsx("div",{className:"text-center text-red-500",children:x}):d.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No data available."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block mb-2 text-sm font-semibold text-gray-900",children:"Select Competency"}),e.jsxs("select",{value:C,className:"bg-gray-50 border-2 border-gray-300 text-gray-500 text-sm rounded-lg block w-full p-2.5",onChange:o=>I(o.target.value),children:[e.jsx("option",{value:"",children:"-- Select Competency --"}),d.map(o=>e.jsx("option",{value:o.competencies_name,children:o.competencies_name},o.competencies_name))]})]}),C&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"block mb-2 text-sm font-semibold text-gray-900",children:"Select Cluster"}),e.jsxs("select",{value:y,className:"bg-gray-50 border-2 border-gray-300 text-gray-500 text-sm rounded-lg block w-full p-2.5",onChange:o=>k(o.target.value),children:[e.jsx("option",{value:"",children:"-- Select Cluster --"}),Object.keys(((M=d.find(o=>o.competencies_name===C))==null?void 0:M.details)||{}).map(o=>e.jsx("option",{value:o,children:o},o))]})]}),y&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 text-sm font-semibold text-gray-900",children:"Select SubCluster"}),e.jsxs("select",{value:h,className:"bg-gray-50 border-2 border-gray-300 text-gray-500 text-sm rounded-lg block w-full p-2.5",onChange:o=>z(o.target.value),children:[e.jsx("option",{value:"",children:"-- Select SubCluster --"}),ee().map((o,$)=>e.jsx("option",{value:o.title,children:o.title},`${o.title}-${$}`))]})]}),h&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 text-sm font-semibold text-gray-900",children:"Select Description"}),e.jsxs("select",{value:S,className:"bg-gray-50 border-2 border-gray-300 text-gray-500 text-sm rounded-lg block w-full p-2.5",onChange:o=>c(o.target.value),children:[e.jsx("option",{value:"",children:"-- Select Description --"}),K().filter(o=>o.title===h).map((o,$)=>e.jsx("option",{value:o.describe_expectations,children:o.describe_expectations},`${o.describe_expectations}-${$}`))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded disabled:bg-gray-300 mr-2",disabled:!C,onClick:_,children:"Add Row"}),e.jsx("button",{className:"px-4 py-2 bg-green-500 text-white rounded disabled:bg-gray-300",disabled:!p||s,onClick:E,children:"Add Custom Row"})]})]}),e.jsxs("table",{className:"min-w-full border border-gray-500 text-sm",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border",children:"Competency"}),e.jsx("th",{className:"px-4 py-2 border",children:"Cluster"}),e.jsx("th",{className:"px-4 py-2 border",children:"Sub Cluster"}),e.jsx("th",{className:"px-4 py-2 border",children:"Description"})]})}),e.jsx("tbody",{children:v.map((o,$)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2 border",children:o.isCustom?e.jsx("input",{type:"text",className:"w-full border p-1 rounded",value:o.competency,onChange:R=>W($,"competency",R.target.value)}):e.jsx("span",{children:o.competency})}),e.jsx("td",{className:"px-4 py-2 border",children:o.isCustom?e.jsx("input",{type:"text",className:"w-full border p-1 rounded",value:o.subcategory,onChange:R=>W($,"subcategory",R.target.value)}):e.jsx("span",{children:o.subcategory})}),e.jsx("td",{className:"px-4 py-2 border",children:o.isCustom?e.jsx("input",{type:"text",className:"w-full border p-1 rounded",value:o.title,onChange:R=>W($,"title",R.target.value)}):e.jsx("span",{children:o.title})}),e.jsx("td",{className:"px-4 py-2 border",children:o.isCustom?e.jsx("textarea",{className:"w-full border p-1 rounded",value:o.description,onChange:R=>W($,"description",R.target.value)}):e.jsx("span",{children:o.description})})]},$))})]})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{className:"px-4 py-2 bg-green-500 text-white rounded disabled:bg-gray-500",disabled:v.length===0,onClick:P,children:"Confirm"})})]})},{Tr:fe,Th:ye,Td:Ne,THead:Dt,TBody:Tt}=Y,Et=({onConfirm:t})=>{const r=ge(),a=G(y=>y.competency.isEditing),m=G(y=>y.quaterTab.selectedQuarter),[d,N]=n.useState(!1),[b,g]=n.useState(window.innerWidth<=1024),[x,u]=n.useState("rating");n.useEffect(()=>{const y=()=>{g(window.innerWidth<=1024)};return window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]);const v=y=>{u(y),N(!0)},w=()=>{N(!1)},C=()=>{a||r(Ce(!0))},D=y=>{t(y)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 4 : COMPETENCIES (20%)"}),e.jsxs("div",{className:"flex space-x-2 ml-auto",children:[e.jsx(L,{className:"mr-2",size:"xs",icon:e.jsx(qe,{}),onClick:C,children:e.jsx("span",{className:"hidden sm:block",children:"Edit"})}),e.jsx(L,{className:"mr-2",size:"xs",icon:e.jsx(xe,{}),onClick:()=>v("competency"),children:e.jsx("span",{className:"hidden sm:block",children:"Add Competency"})}),e.jsx(L,{variant:"twoTone",size:"xs",icon:e.jsx(ie,{}),onClick:()=>v("rating"),children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})]})]})}),e.jsx(de,{title:x==="rating"?"Performance Rating Scale":`Add Competency(Q${m})`,isOpen:d,width:b?"100%":750,onClose:w,onRequestClose:w,children:x==="rating"?e.jsxs(Y,{compact:!0,className:"w-full text-left mt-4 border border-gray-300",children:[e.jsx(Dt,{children:e.jsxs(fe,{className:"bg-gray-100",children:[e.jsx(ye,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(ye,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsx(Tt,{children:[{title:"Greatly Exceeds Expectations (5)",desc:"Performance far exceeded agreed target(s)..."},{title:"Exceeds Expectations (4)",desc:"Performance exceeded agreed target(s)..."},{title:"Meets Expectations (3)",desc:"Performance target(s) achieved..."},{title:"Occasionally Meets Expectations (2)",desc:"Performance failed to meet expectations..."}].map((y,T)=>e.jsxs(fe,{children:[e.jsx(Ne,{className:"border border-gray-300 p-2",children:y.title}),e.jsx(Ne,{className:"border border-gray-300 p-2",children:y.desc})]},T))})]}):e.jsx(_t,{onClose:w,onConfirm:D})})]})},kt=()=>{const t=G(y=>y.quaterTab.selectedQuarter),{id:r}=J(),[a,m]=n.useState({1:[],2:[],3:[],4:[]}),[d,N]=n.useState(!1),[b,g]=n.useState(null),[x,u]=n.useState([]),v=y=>{const T=y.map(h=>({...h,isConfirmed:!0}));u(h=>[...h,...T])};n.useEffect(()=>{(async()=>{N(!0),g(null);try{const T=localStorage.getItem("selectedDepartmentID"),h=localStorage.getItem("selectedTeamID"),f=localStorage.getItem("selectedYear")||new Date().getFullYear().toString(),S=await yt(T,h?Number(h):null,Number(f),r??null);m(S.data)}catch{g("Failed to load data. Please try again.")}finally{N(!1)}})()},[r]);const w=a[t]||[],C=x.filter(y=>y.quarter===t),D=[...w,...C];return e.jsxs("div",{className:"mt-4",children:[d&&e.jsx("div",{children:"Loading..."}),b&&e.jsx("div",{className:"text-red-500",children:b}),e.jsx(Et,{onConfirm:v}),e.jsx(Ct,{competencyData:D,loading:d,allQuarterData:a,isConfirmed:y=>!!y.isConfirmed,onCopy:(y,T)=>{m(h=>({...h,[y]:T}))}})]})},{TabNav:ne,TabList:Ft}=De,It=()=>{const t=_e(),r=re(m=>m.quaterTab.selectedQuarter),a=m=>{t(Re(m))};return e.jsx("div",{children:e.jsx(ze,{className:"bg-gray-50 card-body-padding mt-8",children:e.jsx(De,{value:r,variant:"pill",onChange:a,children:e.jsxs(Ft,{children:[e.jsx(ne,{value:"1",className:`${r==="1"?"bg-green-700 text-white":""}`,children:"First Quarter"}),e.jsx(ne,{value:"2",className:`${r==="2"?"bg-green-700 text-white":""}`,children:"Second Quarter"}),e.jsx(ne,{value:"3",className:`${r==="3"?"bg-green-700 text-white":""}`,children:"Third Quarter"}),e.jsx(ne,{value:"4",className:`${r==="4"?"bg-green-700 text-white":""}`,children:"Fourth Quarter"})]})})})})},$t=async(t,r,a,m)=>{try{const d=await U({url:`/supervisor/form_a?department_id=${t}&team_id=${r}&year=${a}&staff_id=${m}`,method:"get"});return console.log(d),d}catch(d){throw console.error("Error fetching information data:",d),d}},Rt=()=>{const{id:t}=J(),[r,a]=n.useState(null),[m,d]=n.useState(!0),[N,b]=n.useState(null),g=async()=>{try{const y=localStorage.getItem("selectedDepartmentID")||"",T=localStorage.getItem("selectedTeamID"),h=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),f=await $t(y,T?Number(T):null,h,t);if(f&&f.data)a(f.data);else throw new Error("Invalid response data")}catch(y){console.error("Error fetching data:",y),b("Failed to load data. Please try again.")}finally{d(!1)}};if(n.useEffect(()=>{g()},[]),m)return e.jsx("div",{children:"Loading..."});if(N)return e.jsx("div",{className:"text-red-500",children:N});const{department:x,team:u,supervisor:v,staff:w,officer:C,progress:D}=r||{};return e.jsxs("div",{children:[e.jsx(Ke,{department:x,team:u,progress:D,title:"EMPLOYEE PERFORMANCE CONTRACT"}),w&&v&&C&&e.jsx(Je,{staff:w,supervisor:v,officer:C}),e.jsx(It,{})]})},{Tr:Z,Th:ve,Td:q,THead:At,TBody:Ot}=Y,Pt=()=>e.jsx("div",{children:e.jsxs(Y,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(At,{children:e.jsxs(Z,{className:"bg-gray-100",children:[e.jsx(ve,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(ve,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsxs(Ot,{children:[e.jsxs(Z,{children:[e.jsx(q,{className:"border border-gray-300 p-2",children:"Greatly Exceeds Expectations (5)"}),e.jsx(q,{className:"border border-gray-300 p-2",children:"Performance far exceeded agreed target(s) on all critical parameters on a consistent basis; overall quality of work and performance is excellent."})]}),e.jsxs(Z,{children:[e.jsx(q,{className:"border border-gray-300 p-2",children:"Exceeds Expectations (4)"}),e.jsx(q,{className:"border border-gray-300 p-2",children:"Performance exceeded agreed target(s) on all critical parameters; overall quality of work and performance is very good."})]}),e.jsxs(Z,{children:[e.jsx(q,{className:"border border-gray-300 p-2",children:"Meets Expectations (3)"}),e.jsx(q,{className:"border border-gray-300 p-2",children:"Performance target(s) achieved on all critical parameters; overall quality of work and performance is good."})]}),e.jsxs(Z,{children:[e.jsx(q,{className:"border border-gray-300 p-2",children:"Occasionally Meets Expectations (2)"}),e.jsx(q,{className:"border border-gray-300 p-2",children:"Performance failed to meet expectations on agreed target(s) and on some critical parameters; performance deficiencies can however be addressed with support through guidance, coaching, mentoring and/ or training."})]}),e.jsxs(Z,{children:[e.jsx(q,{className:"border border-gray-300 p-2",children:"Unsatisfactory (1)"}),e.jsx(q,{className:"border border-gray-300 p-2",children:"Performance failed to meet expectations on agreed target(s) and on most critical parameters; definite and significant corrective action needs to be taken immediately."})]}),e.jsxs(Z,{children:[e.jsx(q,{className:"border border-gray-300 p-2",children:"Not Applicable (N/A):"}),e.jsx(q,{className:"border border-gray-300 p-2",children:"The activity(s) is not being carried out within the Assessment Quarter."})]})]})]})}),Qt=async(t,r,a,m)=>{try{return await U({url:`/supervisor/operation_and_process?department_id=${t}&team_id=${r}&year=${a}&staff_id=${m}`,method:"get"})}catch(d){throw console.error("Error fetching information data:",d),d}},Mt=async t=>{try{return await U({url:"/supervisor/operation_and_process",method:"post",data:t})}catch(r){throw console.error("Error fetching information data:",r),r}},{Tr:ce,Th:se,Td:O,THead:qt,TBody:Lt}=Y,Yt=({addRowTrigger:t,setAddRowTrigger:r})=>{const{id:a}=J(),m=G(c=>c.quaterTab.selectedQuarter),[d,N]=n.useState(!1),b=G(c=>c.OprationProcess2.data),g=n.useMemo(()=>b[m]||[],[b,m]),[x,u]=n.useState([]),v=c=>{const p=[...x];p[c].children.push({expectation:"",min:1,max:5,QuarterMarks:0}),u(p)},w=n.useCallback(()=>{u(c=>[...c,{title:"",children:[]}])},[]);n.useEffect(()=>{t&&(w(),r(!1))},[t,w,r]),n.useEffect(()=>{const c=["Punctuality/Attendance","Work turn around time","Innovation on the job"],p=c.map(s=>{const i=g==null?void 0:g.find(j=>j.operations_and_process===s);return{title:s,children:i?i.details.map(j=>({expectation:j.describe_expectations,min:String(j.min_score),max:String(j.max_score),QuarterMarks:String(j.quarter_marks)})):[]}}),l=(g==null?void 0:g.filter(s=>!c.includes(s.operations_and_process)).map(s=>({title:s.operations_and_process,children:s.details.map(i=>({expectation:i.describe_expectations,min:String(i.min_score),max:String(i.max_score),QuarterMarks:String(i.quarter_marks)}))})))||[];u([...p,...l])},[g]);const C=(c,p,l,s)=>{const i=[...x];i[c].children[p][l]=s,u(i)},D=(c,p)=>{const l=[...x];l[c].title=p,u(l)},y=c=>{const p=[...x];p.splice(c,1),u(p)},T=(c,p)=>{const l=[...x];l[c].children.splice(p,1),u(l)},h=()=>{const c=x.reduce((s,i)=>s+i.children.reduce((j,_)=>{const E=Number(_.min)||0;return j+E},0),0),p=x.reduce((s,i)=>s+i.children.reduce((j,_)=>{const E=Number(_.max)||0;return j+E},0),0);return{total_value:p>0?c/p*10:0}},{total_value:f}=h(),S=async()=>{const c=x.map(l=>({operations_and_process:l.title,details:l.children.map(s=>({describe_expectations:s.expectation,min_score:s.min,max_score:s.max,quarter_marks:s.QuarterMarks}))})).filter(l=>l.details.length>0),p={department_id:localStorage.getItem("selectedDepartmentID"),team_id:localStorage.getItem("selectedTeamID"),year:localStorage.getItem("selectedYear")||new Date().getFullYear().toString(),quater:m,staff_id:a,data:c,total_min_score:f,total_max_score:10};try{N(!0),(await Mt(p)).status===201&&(localStorage.setItem(`oprationData-Q${m}`,JSON.stringify(x)),H.push(e.jsx(B,{title:"Success",type:"success",children:"Data saved successfully!"}),{placement:"top-center"}))}catch{H.push(e.jsx(B,{title:"Error",type:"danger",children:"Something went wrong."}),{placement:"top-center"})}finally{N(!1)}};return e.jsxs("div",{children:[e.jsxs(Y,{compact:!0,className:"bg-white w-full",children:[e.jsx(qt,{children:e.jsxs(ce,{className:"bg-gray-200",children:[e.jsx(se,{className:"border border-green-600 p-2 w-[28%]",children:"Operations and Processes"}),e.jsx(se,{className:"border border-green-600 p-2",children:"Describe Expectations"}),e.jsx(se,{className:"border border-green-600 p-2 text-center w-[10%]",children:"Min Score"}),e.jsx(se,{className:"border border-green-600 p-2 text- w-[10%]",children:"Max Score"}),e.jsxs(se,{className:"border border-green-600 p-2 text-center w-[12%]",children:["Quarter Marks (Q",m,")"]})]})}),e.jsxs(Lt,{children:[x.map((c,p)=>e.jsx(Ae.Fragment,{children:c.children.length>0?c.children.map((l,s)=>e.jsxs(ce,{children:[s===0&&e.jsxs(O,{rowSpan:c.children.length,className:"border border-gray-400 p-2 relative w-[250px]",children:[e.jsx(ue,{className:"text-red-600 cursor-pointer text-2xl absolute top-1 left-1",onClick:()=>y(p)}),e.jsxs("div",{className:"flex justify-between items-center mt-6 gap-2",children:[p<3?e.jsx("span",{className:"text-sm font-medium",children:c.title}):e.jsx(F,{value:c.title,className:"text-sm font-medium",onChange:i=>D(p,i.target.value)}),e.jsx(pe,{className:"text-green-700 h-4 w-4 cursor-pointer",onClick:()=>v(p)})]})]}),e.jsxs(O,{className:"border border-gray-400 p-2",children:[c.children.length>1&&e.jsx(Te,{className:"text-xl text-red-600 cursor-pointer m-auto mb-1",onClick:()=>T(p,s)}),e.jsx(F,{value:l.expectation,onChange:i=>C(p,s,"expectation",i.target.value)})]}),e.jsx(O,{className:"border border-gray-400 p-2",children:e.jsx(F,{type:"number",value:l.min,onChange:i=>{const j=i.target.value;j===""||Number(j)>=0&&Number(j)<=4?C(p,s,"min",j):alert("Min value must be between 0 and 4")}})}),e.jsx(O,{className:"border border-gray-400 p-2",children:e.jsx(F,{type:"number",value:l.max,onChange:i=>{const j=i.target.value;j===""||Number(j)>=1&&Number(j)<=5?C(p,s,"max",j):alert("Max value must be between 1 and 5")}})}),e.jsx(O,{className:"border border-gray-400 p-2 text-center",children:l.QuarterMarks})]},`${p}-${s}`)):e.jsxs(ce,{children:[e.jsxs(O,{className:"border border-gray-400 p-2 relative w-[250px]",children:[e.jsx(ue,{className:"text-red-600 cursor-pointer text-2xl absolute top-1 left-1",onClick:()=>y(p)}),e.jsxs("div",{className:"flex justify-between items-center mt-6 gap-2",children:[p<3?e.jsx("span",{className:"text-sm font-medium",children:c.title}):e.jsx(F,{value:c.title,className:"text-sm font-medium",onChange:l=>D(p,l.target.value)}),e.jsx(pe,{className:"text-green-700 h-4 w-4 cursor-pointer",onClick:()=>v(p)})]})]}),e.jsx(O,{className:"border border-gray-400 p-2"}),e.jsx(O,{className:"border border-gray-400 p-2"}),e.jsx(O,{className:"border border-gray-400 p-2"}),e.jsx(O,{className:"border border-gray-400 p-2"})]})},p)),x.length>0&&e.jsxs(ce,{className:"bg-gray-100 border ",children:[e.jsx(O,{className:"border border-gray-400 text-center font-bold",colSpan:2,children:"Total"}),e.jsx(O,{className:"border border-gray-400 text-center",children:Math.round(f)}),e.jsx(O,{className:"border border-gray-400 text-center",children:"10"}),e.jsx(O,{className:"border border-gray-400"})]})]})]}),x.length>0&&e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(L,{variant:"solid",color:"green-700",loading:d,onClick:S,children:"Save"})})]})},Wt=()=>{const[t,r]=n.useState(!1),[a,m]=n.useState(!1),[d,N]=n.useState(window.innerWidth<=1024);n.useEffect(()=>{const u=()=>{N(window.innerWidth<=1024)};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const b=()=>r(!0),g=()=>r(!1),x=()=>m(!0);return e.jsx("div",{children:e.jsxs("section",{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2 mt-4 ",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 5 : OPERATIONS AND PROCESSES (10%)"}),e.jsxs("div",{className:"flex space-x-2 ml-auto",children:[e.jsx(L,{className:"mr-2",size:"xs",icon:e.jsx(xe,{}),onClick:x,children:e.jsx("span",{className:"hidden sm:block",children:"Add Row"})}),e.jsx(L,{variant:"twoTone",size:"xs",icon:e.jsx(ie,{}),onClick:b,children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})]})]})}),e.jsx(Yt,{addRowTrigger:a,setAddRowTrigger:m}),e.jsx(de,{title:"Performance Rating Scale",isOpen:t,width:d?"100%":750,onClose:g,onRequestClose:g,children:e.jsx(Pt,{})})]})})},zt=()=>{const t=ge(),r=G(x=>x.quaterTab.selectedQuarter),{id:a}=J(),[m,d]=n.useState(!0),[N,b]=n.useState(null),g=G(x=>x.OprationProcess2.data);return console.log("redux Data",g),n.useEffect(()=>{(async()=>{try{const u=localStorage.getItem("selectedDepartmentID"),v=localStorage.getItem("selectedTeamID"),w=localStorage.getItem("selectedYear")||new Date().getFullYear().toString(),D=(await Qt(u,v?Number(v):null,Number(w),a??null)).data||{},y=Array.isArray(D[r])?D[r]:[];t(Oe({quarter:r,data:y}))}catch(u){console.error("Error fetching data:",u),b("Failed to load data. Please try again.")}finally{d(!1)}})()},[a,r,t]),e.jsx(e.Fragment,{children:m?e.jsx("p",{children:"Loading..."}):N?e.jsx("p",{className:"text-red-500",children:N}):e.jsx(Wt,{})})},is=()=>e.jsxs("div",{children:[e.jsx(Rt,{}),e.jsx(ft,{}),e.jsx(kt,{}),e.jsx(zt,{}),e.jsx(it,{})]});export{is as default};
