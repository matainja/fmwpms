import{aQ as Ne,aM as pe,j as e,aR as Oe,a0 as J,r as a,u as be,aS as Fe,aT as Ae,a2 as ke,p as Re}from"./index-C8vrx0GC.js";import{H as Qe,I as Pe,F as qe}from"./FooterButtonpart-SgAAMaj5.js";import{T as Ee,b as ne}from"./Upload-CmWJa32f.js";import{C as Ke,b as I}from"./Tag-pKP05xju.js";/* empty css               */import{I as re,B as z}from"./hoist-non-react-statics.cjs-CJs8X_wk.js";import{R as Me,ae as je}from"./Views-BVfBl8-H.js";import"./FormContainer-3VQFa0ev.js";import"./Select-C0lH1PzN.js";import{t as le,N as de}from"./toast-ULNuDdpd.js";import{C as Be,a as Le,g as Ye,b as We}from"./competency-DAIzfh0m.js";import{A as He}from"./AcknowledgementLayout-BoHRhCx1.js";import"./index-UkhjE42A.js";import"./Evidence-B6S1D7e4.js";import"./html2canvas.esm-C2pek-1f.js";import"./index-Cab3mh8_.js";const{TabNav:ie,TabList:ze}=Ee,Ge=()=>{const s=Ne(),r=pe(t=>t.quaterTab.selectedQuarter),l=t=>{s(Oe(t))};return e.jsx("div",{children:e.jsx(Ke,{className:"bg-gray-50 card-body-padding mt-8",children:e.jsx(Ee,{value:r,variant:"pill",onChange:l,children:e.jsxs(ze,{children:[e.jsx(ie,{value:"1",className:`${r==="1"?"bg-green-700 text-white":""}`,children:"First Quarter"}),e.jsx(ie,{value:"2",className:`${r==="2"?"bg-green-700 text-white":""}`,children:"Second Quarter"}),e.jsx(ie,{value:"3",className:`${r==="3"?"bg-green-700 text-white":""}`,children:"Third Quarter"}),e.jsx(ie,{value:"4",className:`${r==="4"?"bg-green-700 text-white":""}`,children:"Fourth Quarter"})]})})})})},Ve=async(s,r,l)=>{try{const t=await J({url:`/form_a?department_id=${s}&team_id=${r}&year=${l}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},Je=()=>{const[s,r]=a.useState(null),[l,t]=a.useState(!0),[m,i]=a.useState(null);a.useEffect(()=>{(async()=>{try{const b=localStorage.getItem("selectedDepartmentID")||"",x=localStorage.getItem("selectedTeamID"),v=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),S=await Ve(b,x?Number(x):null,v);if(S!=null&&S.data)r(S.data);else throw new Error("Invalid response data")}catch(b){console.error("Error fetching data:",b),i("Failed to load data. Please try again.")}finally{t(!1)}})()},[]);const o={1:0,2:0,3:0,4:0};return{data:s,loading:l,error:m,progress:(s==null?void 0:s.progress)||o}},Ue=()=>{const{data:s,loading:r,error:l,progress:t}=Je();if(r)return e.jsx("div",{children:"Loading..."});if(l)return e.jsx("div",{className:"text-red-500",children:l});const{department:m,team:i,supervisor:o,staff:h,officer:b}=s||{},x=localStorage.getItem("formPreview_2025");let v;return x&&(v=JSON.parse(x).staff_id),e.jsxs("div",{children:[e.jsx(Qe,{department:m,team:i,progress:t,title:"EMPLOYEE PERFORMANCE CONTRACT",downloadButton:!0,staffID:(h==null?void 0:h.staff_id)||v}),h&&o&&b&&e.jsx(Pe,{staff:h,supervisor:o,officer:b}),e.jsx(Ge,{})]})};async function Xe(s){try{return await J({url:`form_a/kras?department_id=${s}`,method:"get"})}catch(r){throw console.error("Error making API request:",r),r}}const{Tr:ye,Th:ae,Td:U,THead:Ze,TBody:er}=I,rr=({onClose:s})=>{const r=Ne(),[l,t]=a.useState(""),[m,i]=a.useState([]),[o,h]=a.useState(null),[b,x]=a.useState(!1),[v,S]=a.useState(""),[p,F]=a.useState([]),[R,T]=a.useState(!1),O=be(d=>d.quaterTab.selectedQuarter),j=async()=>{x(!0);try{const d=localStorage.getItem("selectedDepartmentID");if(!d)throw new Error("No department ID selected.");const g=await Xe(d);i(g.data.data||[])}catch(d){h(d instanceof Error?d.message:"An unknown error occurred.")}finally{x(!1)}};a.useEffect(()=>{j()},[]);const W=d=>{const g=parseInt(d.target.value,10);t(isNaN(g)?"":g);const f=m.flatMap(q=>q.kras).find(q=>q.kra_id===g);S(f?f.kra_weight:""),F([])},w=()=>{if(!l)return;const d=m.flatMap(g=>g.kras).find(g=>g.kra_id===l);!d||p.length>=d.objectives.length||F(g=>[...g,{id:Date.now(),selectedObjectiveId:""}])},k=(d,g)=>{F(f=>f.map(q=>q.id===d?{...q,selectedObjectiveId:g}:q))},A=m.flatMap(d=>d.kras).find(d=>d.kra_id===l),Q=A?A.objectives:[],C=p.every(d=>d.selectedObjectiveId!=="")&&p.length>0,H=()=>{if(R)return;const d={[O]:[{kra_name:(A==null?void 0:A.kra_title)||"",kra_weight:v,objectives:p.map(g=>{const f=Q.find(q=>q.obj_id===parseInt(g.selectedObjectiveId,10));return{objective_name:(f==null?void 0:f.title)||"",objective_weight:Number((f==null?void 0:f.obj_weight)||0),gradeed_weight:Number(v||0),target:(f==null?void 0:f.target)||"",kpi:(f==null?void 0:f.kpi)||"",units:"num",aggregate:"",quarter_marks:0,target_achieved:0,raw:0,weighted:0}})}]};console.log("Confirmed Data:",JSON.stringify(d,null,2)),r(Fe(d)),T(!0),setTimeout(()=>{T(!1)},7e3),s()};return b?e.jsx("div",{className:"p-4 text-center",children:"Loading..."}):o?e.jsx("div",{className:"p-4 text-center text-red-600",children:o}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Select KRA"}),e.jsxs("select",{id:"kraSelect",value:l,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white",onChange:W,children:[e.jsx("option",{value:"",children:"Select a KRA"}),m.map(d=>e.jsx("optgroup",{label:d.heading,children:d.kras.map(g=>e.jsx("option",{value:g.kra_id,children:g.kra_title},g.kra_id))},d.heading))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"weightInput",className:"mb-2 text-sm font-medium text-gray-700",children:"Weight"}),e.jsx(re,{readOnly:!0,id:"weightInput",value:v,className:"w-full bg-gray-100"})]}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsx(z,{variant:"solid",className:"w-full text-white hover:bg-blue-700",disabled:!l||p.length>=Q.length,onClick:w,children:"Add Objective"})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(I,{compact:!0,className:"border border-gray-400 w-full",children:[e.jsx(Ze,{children:e.jsxs(ye,{className:"bg-gray-200",children:[e.jsx(ae,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(ae,{className:"border border-gray-400 p-2",children:"Objective Weight"}),e.jsx(ae,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(ae,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(ae,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsx(er,{children:p.length===0?e.jsx(ye,{children:e.jsx(U,{colSpan:5,className:"text-center text-gray-500 py-4",children:"No Data Found"})}):p.map(d=>{const g=Q.find(f=>f.obj_id===parseInt(d.selectedObjectiveId,10));return e.jsxs(ye,{children:[e.jsx(U,{className:"border border-gray-400",children:e.jsxs("select",{className:"w-full bg-white",value:d.selectedObjectiveId,onChange:f=>k(d.id,f.target.value),children:[e.jsx("option",{value:"",children:"Select Objective"}),Q.map(f=>e.jsx("option",{value:f.obj_id,children:f.title},f.obj_id))]})}),e.jsx(U,{className:"border border-gray-400",children:(g==null?void 0:g.obj_weight)||""}),e.jsx(U,{className:"border border-gray-400",children:(g==null?void 0:g.kpi)||""}),e.jsx(U,{className:"border border-gray-400",children:(g==null?void 0:g.target)||""}),e.jsx(U,{className:"border border-gray-400",children:(g==null?void 0:g.Responsible)||""})]},d.id)})})]})}),e.jsx("div",{className:"text-right mt-4",children:e.jsx(z,{variant:"solid",disabled:!C||R,className:`${C&&!R?"bg-blue-600":"bg-gray-400"}`,onClick:H,children:"Confirm"})})]})},{Tr:ve,Th:me,Td:ge,THead:tr,TBody:ar}=I,sr=[{grade:"O",description:"Outstanding - 100%",quarter:"Q1",value:"First Quarter"},{grade:"E",description:"Excellent - 90%",quarter:"Q2",value:"Second Quarter"},{grade:"VG",description:"Very Good - 80%",quarter:"Q3",value:"Third Quarter"},{grade:"G",description:"Good - 70%",quarter:"Q4",value:"Fourth Quarter"}],cr=()=>{const[s,r]=a.useState(!1),[l,t]=a.useState(!1),[m,i]=a.useState(window.innerWidth<=1024),o=pe(p=>p.quaterTab.selectedQuarter);a.useEffect(()=>{const p=()=>{i(window.innerWidth<=1024)};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]);const h=()=>{r(!0)},b=()=>{r(!1)},x=()=>{t(!0)},v=()=>{t(!1)},S=p=>{switch(p){case"1":return"First Quarter";case"2":return"Second Quarter";case"3":return"Third Quarter";case"4":return"Fourth Quarter";default:return"Unknown Quarter"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"SECTION 3 : EMPLOYEE'S TASKS (70%)"}),e.jsxs("div",{className:"flex space-x-2 ml-auto",children:[e.jsx(z,{className:"mr-2",size:"xs",icon:e.jsx(Me,{}),"aria-label":"Add KRA",onClick:x,children:e.jsx("span",{className:"hidden sm:block",children:"Add KRA"})}),e.jsx(z,{variant:"twoTone",size:"xs",icon:e.jsx(je,{}),"aria-label":"View Scoring Criteria Values",onClick:h,children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Scoring Criteria Values"})})]})]})}),e.jsx(ne,{title:"Vertical Drawer",isOpen:s,placement:"right",width:m?"100%":800,onClose:b,onRequestClose:b,children:e.jsxs(I,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(tr,{children:e.jsxs(ve,{className:"bg-gray-100",children:[e.jsx(me,{className:"border border-gray-300 p-2",children:"Grade"}),e.jsx(me,{className:"border border-gray-300 p-2",children:"Description"}),e.jsx(me,{className:"border border-gray-300 p-2",children:"Quarter"}),e.jsx(me,{className:"border border-gray-300 p-2",children:"Value"})]})}),e.jsx(ar,{children:sr.map((p,F)=>e.jsxs(ve,{children:[e.jsx(ge,{className:"border border-gray-300 p-2",children:p.grade}),e.jsx(ge,{className:"border border-gray-300 p-2",children:p.description}),e.jsx(ge,{className:"border border-gray-300 p-2",children:p.quarter}),e.jsx(ge,{className:"border border-gray-300 p-2",children:p.value})]},F))})]})}),e.jsx(ne,{isOpen:l,title:`KRA add for ${S(o)} (${o})`,placement:"right",width:m?"100%":900,onClose:v,children:e.jsx(rr,{onClose:v})})]})},nr=async(s,r,l)=>{try{const t=await J({url:`/employeetask?department_id=${s}&team_id=${r}&year=${l}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},or=async s=>{try{const r=await J({url:"employeetask",method:"post",data:s});return console.log(r),r}catch(r){throw console.error("Error saving employee task:",r),r}},{Tr:se,Th:B,Td:$,THead:lr,TBody:dr}=I,ir=({loading:s,data:r,calculateKraWeight:l,calculateGradedWeight:t,totalWeight:m,totalGradedWeight:i})=>e.jsx("div",{children:e.jsxs(I,{compact:!0,className:"border border-gray-400 w-full bg-white",children:[e.jsx(lr,{children:e.jsxs(se,{className:"bg-gray-200",children:[e.jsx(B,{className:"border border-gray-400 p-2",children:"S/N"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"KRA"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"KRA Weight"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"OBJ Weight"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"Grade Weight"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(B,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsxs(dr,{children:[s?e.jsx(se,{children:e.jsx($,{className:"border border-gray-400 text-center",colSpan:9,children:"Loading..."})}):r.length===0?e.jsx(se,{children:e.jsx($,{className:"border border-gray-400 text-center",colSpan:9,children:e.jsx("span",{className:"text-black font-semibold text-lg",children:"No data available"})})}):r.map((o,h)=>o.objectives.map((b,x)=>e.jsxs(se,{children:[x===0&&e.jsxs(e.Fragment,{children:[e.jsx($,{className:"border border-gray-400",rowSpan:o.objectives.length,children:h+1}),e.jsx($,{className:"border border-gray-400",rowSpan:o.objectives.length,children:o.kra_name}),e.jsx($,{className:"border border-gray-400 text-center",rowSpan:o.objectives.length,children:l(o.objectives).toFixed(2)})]}),e.jsx($,{className:"border border-gray-400",children:b.objective_name}),e.jsx($,{className:"border border-gray-400",children:b.objective_weight}),e.jsx($,{className:"border border-gray-400 text-center",children:t(b.objective_weight).toFixed(2)}),e.jsx($,{className:"border border-gray-400",children:b.target}),e.jsx($,{className:"border border-gray-400",children:b.kpi}),e.jsx($,{className:"border border-gray-400",children:b.unit})]},`${h}-${x}`))),!s&&r.length>0&&e.jsxs(se,{children:[e.jsx($,{className:"border border-gray-400 text-center",colSpan:2,children:"Total"}),e.jsx($,{className:"border border-gray-400 text-center",children:"70"}),e.jsx($,{className:"border border-gray-400 text-center"}),e.jsx($,{className:"border border-gray-400 text-center",children:m.toFixed(2)}),e.jsx($,{className:"border border-gray-400 text-center",children:i.toFixed(2)}),e.jsx($,{className:"border border-gray-400 text-center",colSpan:3})]})]})]})}),{Tr:X,Th:L,Td:E,THead:mr,TBody:gr}=I,hr=()=>{const s=Ne(),r=be(n=>n.quaterTab.selectedQuarter),{quater_settings:l}=be(n=>n.auth.user||{});console.log(l);const t=be(n=>n.kra.selectedQuarterData),[m,i]=a.useState({}),[o,h]=a.useState(!0),[b,x]=a.useState(null),[v,S]=a.useState(!1),[p,F]=a.useState(!1),R=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),T=new Date().getFullYear(),O=async()=>{var n,c,u;try{const y=localStorage.getItem("selectedDepartmentID"),D=localStorage.getItem("selectedTeamID"),N=await nr(y,D?Number(D):null,R?Number(R):null),K=((n=N==null?void 0:N.data)==null?void 0:n.supervisor_confirmed)===!0||((c=N==null?void 0:N.data)==null?void 0:c.supervisor_confirmation)===!0;F(K),i(((u=N==null?void 0:N.data)==null?void 0:u.result)||{})}catch(y){console.error("Error fetching data:",y),x("Failed to load data. Please try again.")}finally{h(!1)}};a.useEffect(()=>{O()},[]);const j=p;console.log("Fetched Employee Task Data:",m,"isReadOnly:",j);const W=a.useMemo(()=>{if(o||!m[r])return[];const n=m[r]||[],c=(t==null?void 0:t[r])||[],u=JSON.parse(JSON.stringify(c));return[...n,...u]},[t,r,m,o]),[w,k]=a.useState([]);a.useEffect(()=>{k(W)},[W]);const A=(n,c,u)=>{if(j)return;const y=n.target.value;if(/^\d{0,2}(\.\d{0,2})?$/.test(y)){const D=[...w];D[c].objectives[u].objective_weight=y,k(D)}else alert("Please enter up to 2 digits before and after the decimal point. Example: 12.75")},Q=n=>n.reduce((c,u)=>c+Number(C(u.objective_weight||"0")),0),C=n=>{if(!n||parseFloat(n)===0)return 0;const c=w.reduce((u,y)=>u+y.objectives.reduce((D,N)=>D+parseFloat(N.objective_weight||"0"),0),0);return c===0?0:70/c*parseFloat(n)},H=w.reduce((n,c)=>n+c.objectives.reduce((u,y)=>u+parseFloat(y.objective_weight||"0"),0),0),d=w.reduce((n,c)=>n+c.objectives.reduce((u,y)=>u+Number(C(y.objective_weight||"0")),0),0),g=n=>{if(j)return;const c=[...w];c.splice(n,1),k(c)},f=(n,c)=>{if(j)return;const u=[...w];u[n].objectives.splice(c,1),k(u)},q=()=>{if(j)return!1;for(const n of w){if(!n.kra_name||n.kra_name.trim()==="")return alert("KRA name is required."),!1;for(const c of n.objectives){if(!c.objective_name||c.objective_name.trim()==="")return alert("Objective name is required."),!1;if(c.objective_weight===null||c.objective_weight===void 0||isNaN(parseFloat(c.objective_weight)))return alert("Objective weight is required and must be a valid number."),!1;if(c.target===null||c.target===void 0||isNaN(parseFloat(c.target)))return alert("Target is required and must be a valid number."),!1;if(!c.kpi||c.kpi.trim()==="")return alert("KPI is required."),!1}}return!0},Ie=async()=>{if(j||!q())return;const n=localStorage.getItem("selectedDepartmentID")||"",c=Number(localStorage.getItem("selectedTeamID"))||0,u=Number(localStorage.getItem("selectedYear"))||new Date().getFullYear(),y=Number(r),D=w.reduce((K,fe)=>{const oe=fe.objectives.map(_=>({objective_name:_.objective_name.trim(),objective_weight:parseFloat(_.objective_weight)||0,gradeed_weight:parseFloat(C(_.objective_weight).toFixed(2)),target:parseFloat(_.target)||0,kpi:_.kpi.trim(),unit:_.unit||"",aggregate:_.aggregate||null,quarter_marks:_.quarter_marks||0,target_achieved:_.target_achieved||0,raw:_.raw||0,weighted:_.weighted||0})),M=K.find(_=>_.kra_name===fe.kra_name);return M?M.objective&&Array.isArray(M.objective)?(M.objective.push(...oe),M.kra_weight=M.objective.reduce((_,te)=>_+te.gradeed_weight,0)):(M.objective||(M.objective=[]),M.objective.push(...oe),M.kra_weight=M.objective.reduce((_,te)=>_+te.gradeed_weight,0)):K.push({kra_name:fe.kra_name,kra_weight:oe.reduce((_,te)=>_+te.gradeed_weight,0),objective:oe}),K},[]),N={department_id:n,team_id:c,year:u,quater:y,employee_task:D,total_weight:70,total_graded_weight:d.toFixed(2)};try{const K=await or({department_id:n,team_id:c,year:u,quater:y,employee_task:N.employee_task,total_weight:70,total_graded_weight:d.toFixed(2)});alert("Data saved successfully!"),O(),s(Ae())}catch(K){console.error(K),alert("Failed to save data. Please try again.")}},Ce=()=>{if(j)return;const n=parseInt(r);if(n===1)return;const c=(n-1).toString(),u=m[c];if(!u){alert(`No data available in Q${c} to copy`);return}const y=JSON.parse(JSON.stringify(u));i(D=>({...D,[r]:y})),k(y),alert(`Data copied from Q${c} to Q${r}`),S(!0)},$e=()=>o||w.length>0||j?!1:parseInt(r)>1;return e.jsx("div",{children:R===T?e.jsxs(e.Fragment,{children:[e.jsxs(I,{compact:!0,className:"border border-gray-400 w-full bg-white",children:[e.jsx(mr,{children:e.jsxs(X,{className:"bg-gray-200",children:[e.jsx(L,{className:"border border-gray-400 p-2",children:"S/N"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"KRA"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"KRA Weight"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"Objective"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"OBJ Weight"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"Grade Weight"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"Target"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"KPI"}),e.jsx(L,{className:"border border-gray-400 p-2",children:"Unit of Measurement"})]})}),e.jsxs(gr,{children:[o?e.jsx(X,{children:e.jsx(E,{className:"border border-gray-400 text-center",colSpan:9,children:"Loading..."})}):w.length===0?$e()?e.jsx(X,{children:e.jsx(E,{className:"border border-gray-400 text-center",colSpan:9,children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-4",children:[e.jsxs("span",{className:"text-black font-semibold text-lg mb-3",children:["No data for Q",r,". Would you like to copy from previous quarter?"]}),e.jsxs(z,{variant:"solid",className:"w-64",onClick:Ce,disabled:j,children:["Copy from Q",parseInt(r)-1]})]})})}):e.jsx(X,{children:e.jsx(E,{className:"border border-gray-400 text-center",colSpan:9,children:e.jsxs("span",{className:"text-black font-semibold text-lg",children:["No data available for Q",r]})})}):w.map((n,c)=>n.objectives.map((u,y)=>e.jsxs(X,{children:[y===0&&e.jsxs(e.Fragment,{children:[e.jsxs(E,{className:"border border-gray-400",rowSpan:n.objectives.length,children:[c+1,!j&&e.jsx(Be,{className:"text-xl text-red-600 cursor-pointer",onClick:()=>g(c)})]}),e.jsx(E,{className:"border border-gray-400",rowSpan:n.objectives.length,children:n.kra_name}),e.jsx(E,{className:"border border-gray-400 text-center",rowSpan:n.objectives.length,children:Q(n.objectives).toFixed(2)})]}),e.jsxs(E,{className:"border border-gray-400",children:[!j&&n.objectives.length>2&&e.jsx(Le,{className:"text-xl text-red-600 cursor-pointer m-auto",onClick:()=>f(c,y)}),e.jsx(re,{textArea:!0,disabled:j,value:u.objective_name,onChange:D=>{if(j)return;const N=[...w];N[c].objectives[y].objective_name=D.target.value,k(N)}})]}),e.jsx(E,{className:"border border-gray-400",children:e.jsx(re,{disabled:j,className:"w-full",value:u.objective_weight,onChange:D=>A(D,c,y)})}),e.jsx(E,{className:"border border-gray-400 text-center",children:C(u.objective_weight).toFixed(2)}),e.jsx(E,{className:"border border-gray-400",children:e.jsx(re,{disabled:j,value:u.target,onChange:D=>{if(j)return;const N=D.target.value;if(/^\d*\.?\d*$/.test(N)){const K=[...w];K[c].objectives[y].target=N,k(K)}}})}),e.jsx(E,{className:"border border-gray-400",children:e.jsx(re,{disabled:j,textArea:!0,value:u.kpi,onChange:D=>{if(j)return;const N=[...w];N[c].objectives[y].kpi=D.target.value,k(N)}})}),e.jsx(E,{className:"border border-gray-400",children:e.jsx(re,{disabled:j,textArea:!0,value:u.unit,onChange:D=>{if(j)return;const N=[...w];N[c].objectives[y].unit=D.target.value,k(N)}})})]},`${c}-${y}`))),!o&&w.length>0&&e.jsxs(X,{children:[e.jsx(E,{className:"border border-gray-400 text-center",colSpan:2,children:"Total"}),e.jsx(E,{className:"border border-gray-400 text-center",children:"70"}),e.jsx(E,{className:"border border-gray-400 text-center"}),e.jsx(E,{className:"border border-gray-400 text-center",children:H.toFixed(2)}),e.jsx(E,{className:"border border-gray-400 text-center",children:d.toFixed(2)}),e.jsx(E,{className:"border border-gray-400 text-center",colSpan:3})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end mt-4",children:[v&&!j&&e.jsx("div",{className:"size-10 animate-bounce mb-2 me-5",children:e.jsx("img",{src:"/img/others/down-arrow.svg",alt:"Down Arrow"})}),!j&&e.jsx(z,{variant:"solid",color:"green-700",className:"mt-2",onClick:Ie,children:"Save"})]})]}):e.jsx(ir,{loading:o,data:w,calculateKraWeight:Q,calculateGradedWeight:C,totalWeight:H,totalGradedWeight:d})})},xr=()=>e.jsxs("div",{className:"mt-4",children:[e.jsx(cr,{}),e.jsx(hr,{})]}),{Tr:we,Th:Se,Td:Te,THead:ur,TBody:br}=I,pr=({isOpen:s,setIsOpen:r})=>{const[l,t]=a.useState(window.innerWidth<=1024);a.useEffect(()=>{const i=()=>{t(window.innerWidth<=1024)};return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const m=[{id:1,title:"Greatly Exceeds Expectations (5)",desc:"Performance far exceeded agreed target(s)..."},{id:2,title:"Exceeds Expectations (4)",desc:"Performance exceeded agreed target(s)..."},{id:3,title:"Meets Expectations (3)",desc:"Performance target(s) achieved..."},{id:4,title:"Occasionally Meets Expectations (2)",desc:"Performance failed to meet expectations..."},{id:5,title:"Unsatisfactory (1)",desc:"Performance failed to meet expectations on agreed target(s) and on most critical parameters; definite and significant corrective action needs to be taken immediately."},{id:6,title:"Not Applicable (N/A):",desc:"The activity(s) is not being carried out within the Assessment Quarter."}];return e.jsx(ne,{isOpen:s,title:"Performance Rating Scale",width:l?"100%":750,onClose:()=>r(!1),children:e.jsxs(I,{compact:!0,className:"w-full text-left mt-4 border border-gray-300",children:[e.jsx(ur,{children:e.jsxs(we,{className:"bg-gray-100",children:[e.jsx(Se,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(Se,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsx(br,{children:m.map(i=>e.jsxs(we,{children:[e.jsx(Te,{className:"border border-gray-300 p-2",children:i.title}),e.jsx(Te,{className:"border border-gray-300 p-2",children:i.desc})]},i.id))})]})})},jr=()=>{const[s,r]=a.useState(!1);return e.jsxs("div",{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 4 : COMPETENCIES (20%)"}),e.jsx("div",{className:"flex space-x-2 ml-auto",children:e.jsx(z,{variant:"twoTone",size:"xs",icon:e.jsx(je,{}),onClick:()=>r(!0),children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})})]})}),e.jsx(pr,{isOpen:s,setIsOpen:r})]})},{Tr:De,Th:he,Td:xe,THead:fr,TBody:yr}=I,Nr=()=>{const[s,r]=a.useState([]),[l,t]=a.useState(!0),[m,i]=a.useState(null),o=async()=>{t(!0),i(null);try{const h=await Ye();r(h.data||[])}catch(h){console.error("Error fetching data:",h),i("Failed to load data. Please try again.")}finally{t(!1)}};return a.useEffect(()=>{o()},[]),e.jsx("div",{className:"p-2",children:l?e.jsx("div",{className:"text-center text-gray-500",children:"Loading..."}):m?e.jsx("div",{className:"text-center text-red-500",children:m}):s.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No data available."}):e.jsxs(I,{className:"min-w-full border border-gray-300 text-sm",children:[e.jsx(fr,{className:"bg-gray-200",children:e.jsxs(De,{children:[e.jsx(he,{className:"px-4 py-2 border border-gray-300 text-left",children:"Competency Name"}),e.jsx(he,{className:"px-4 py-2 border border-gray-300 text-left",children:"Cluster"}),e.jsx(he,{className:"px-4 py-2 border border-gray-300 text-left",children:"Sub Cluster"}),e.jsx(he,{className:"px-4 py-2 border border-gray-300 text-left",children:"Description"})]})}),e.jsx(yr,{children:s.map(h=>Object.entries(h.details).map(([b,x])=>x.map((v,S)=>e.jsxs(De,{className:"border-b border-gray-300",children:[S===0&&e.jsx(xe,{rowSpan:x.length,className:"px-4 py-2 border border-gray-300 font-semibold",children:h.competencies_name}),S===0&&e.jsx(xe,{rowSpan:x.length,className:"px-4 py-2 border border-gray-300",children:b}),e.jsx(xe,{className:"px-4 py-2 border border-gray-300",children:v.title}),e.jsx(xe,{className:"px-4 py-2 border border-gray-300",children:v.describe_expectations})]},`${h.competencies_name}-${b}-${S}`))))})]})})},{Tr:Z,Th:ee,Td:Y,THead:vr,TBody:wr}=I,Sr=()=>{const[s,r]=a.useState(!1),[l,t]=a.useState({1:[],2:[],3:[],4:[]}),[m,i]=a.useState(!0),[o,h]=a.useState(null),[b,x]=a.useState(window.innerWidth<=1024);a.useEffect(()=>{const T=()=>{x(window.innerWidth<=1024)};return window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]);const v=pe(T=>T.quaterTab.selectedQuarter),S=async()=>{i(!0),h(null);try{const T=localStorage.getItem("selectedDepartmentID"),O=localStorage.getItem("selectedTeamID"),j=localStorage.getItem("selectedYear")||new Date().getFullYear(),W=await We(T,O?Number(O):null,Number(j));t(W.data||{1:[],2:[],3:[],4:[]})}catch(T){console.error("Error fetching data:",T),h("Failed to load data. Please try again.")}finally{i(!1)}};a.useEffect(()=>{S()},[]);const p=()=>{r(!0)},F=()=>{r(!1)},R=l[v]||[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border overflow-hidden shadow-sm bg-white",children:e.jsxs(I,{compact:!0,className:"w-full",children:[e.jsx(vr,{children:e.jsxs(Z,{className:"bg-gray-200",children:[e.jsx(ee,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:e.jsxs("span",{className:"flex items-center gap-1",children:["Competency",e.jsx(je,{className:"text-gray-500 text-xl",onClick:()=>p()})]})}),e.jsx(ee,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:"Cluster"}),e.jsx(ee,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:"Sub Cluster"}),e.jsx(ee,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400",children:"Description"}),e.jsx(ee,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400 w-[8%]",children:"Min"}),e.jsx(ee,{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 border border-gray-400 w-[8%]",children:"Max"})]})}),e.jsx(wr,{children:m?e.jsx(Z,{children:e.jsx(Y,{colSpan:6,className:"p-4 text-center text-gray-500",children:"Loading competency data..."})}):o?e.jsx(Z,{children:e.jsx(Y,{colSpan:6,className:"p-4 text-center text-red-500",children:o})}):R.length===0?e.jsx(Z,{children:e.jsx(Y,{colSpan:6,className:"p-4 text-center text-gray-500 font-semibold",children:"No competency data available for the selected quarter."})}):R.map(T=>e.jsxs(ke.Fragment,{children:[e.jsx(Z,{children:e.jsx(Y,{className:"px-4 py-3 align-top font-semibold border border-gray-400",rowSpan:T.competencies_details.length+1,children:T.competencies})}),T.competencies_details.map(O=>e.jsxs(Z,{children:[e.jsx(Y,{className:"px-4 py-3 border border-gray-400",children:O.cluster}),e.jsx(Y,{className:"px-4 py-3 border border-gray-400",children:O.sub_cluster}),e.jsx(Y,{className:"px-4 py-3 border border-gray-400",children:O.describe_expectations}),e.jsx(Y,{className:"px-4 py-3 border border-gray-400",children:O.min_score}),e.jsx(Y,{className:"px-4 py-3 border border-gray-400",children:O.max_score})]},O.id))]},T.id))})]})}),e.jsx(ne,{title:"Competency Information",width:b?"100%":800,isOpen:s,onClose:F,children:e.jsx(Nr,{})})]})},Tr=()=>e.jsxs("div",{className:"mt-8",children:[e.jsx(jr,{}),e.jsx(Sr,{})]}),{Tr:G,Th:_e,Td:P,THead:Dr,TBody:_r}=I,kr=()=>{const[s,r]=a.useState(!1),[l,t]=a.useState(window.innerWidth<=1024);a.useEffect(()=>{const o=()=>{t(window.innerWidth<=1024)};return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const m=()=>{r(!0)},i=o=>{console.log("onDrawerClose",o),r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md text-base text-white bg-green-700 p-2 w-full mb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm tracking-wide font-semibold",children:"Section 5 : OPERATIONS AND PROCESSES (10%)"}),e.jsx("div",{className:"flex space-x-2 ml-auto",children:e.jsx(z,{onClick:()=>m(),variant:"twoTone",size:"xs",icon:e.jsx(je,{}),children:e.jsx("span",{className:"hidden sm:block text-gray-600",children:"Rating"})})})]})}),e.jsx(ne,{title:"Performance Rating Scale  ",isOpen:s,width:l?"100%":750,onClose:i,onRequestClose:i,children:e.jsxs(I,{compact:!0,className:"table-auto border-collapse border border-gray-300 w-full text-left mt-4",children:[e.jsx(Dr,{children:e.jsxs(G,{className:"bg-gray-100",children:[e.jsx(_e,{className:"border border-gray-300 p-2",children:"Title"}),e.jsx(_e,{className:"border border-gray-300 p-2",children:"Description"})]})}),e.jsxs(_r,{children:[e.jsxs(G,{children:[e.jsx(P,{className:"border border-gray-300 p-2",children:"Greatly Exceeds Expectations (5)"}),e.jsx(P,{className:"border border-gray-300 p-2",children:"Performance far exceeded agreed target(s) on all critical parameters on a consistent basis; overall quality of work and performance is excellent."})]}),e.jsxs(G,{children:[e.jsx(P,{className:"border border-gray-300 p-2",children:"Exceeds Expectations (4)"}),e.jsx(P,{className:"border border-gray-300 p-2",children:"Performance exceeded agreed target(s) on all critical parameters; overall quality of work and performance is very good."})]}),e.jsxs(G,{children:[e.jsx(P,{className:"border border-gray-300 p-2",children:"Meets Expectations (3)"}),e.jsx(P,{className:"border border-gray-300 p-2",children:"Performance target(s) achieved on all critical parameters; overall quality of work and performance is good."})]}),e.jsxs(G,{children:[e.jsx(P,{className:"border border-gray-300 p-2",children:"Occasionally Meets Expectations (2)"}),e.jsx(P,{className:"border border-gray-300 p-2",children:"Performance failed to meet expectations on agreed target(s) and on some critical parameters; performance deficiencies can however be addressed with support through guidance, coaching, mentoring and/ or training."})]}),e.jsxs(G,{children:[e.jsx(P,{className:"border border-gray-300 p-2",children:"Unsatisfactory (1)"}),e.jsx(P,{className:"border border-gray-300 p-2",children:"Performance failed to meet expectations on agreed target(s) and on most critical parameters; definite and significant corrective action needs to be taken immediately."})]}),e.jsxs(G,{children:[e.jsx(P,{className:"border border-gray-300 p-2",children:"Not Applicable (N/A):"}),e.jsx(P,{className:"border border-gray-300 p-2",children:"The activity(s) is not being carried out within the Assessment Quarter."})]})]})]})})]})},{Tr:ce,Th:ue,Td:V,THead:Er,TBody:Ir}=I,Cr=({filteredData:s,error:r,loading:l})=>e.jsxs(I,{compact:!0,className:"table-auto border-collapse border border-gray-400 w-full bg-white",children:[e.jsx(Er,{children:e.jsxs(ce,{className:"bg-gray-200",children:[e.jsx(ue,{className:"border border-gray-400 p-2 text-center align-middle",children:"Operations and Processes"}),e.jsx(ue,{className:"border border-gray-400 p-2 text-center align-middle",children:"Describe Expectations"}),e.jsx(ue,{className:"border border-gray-400 p-2 text-center align-middle",children:"Min Score"}),e.jsx(ue,{className:"border border-gray-400 p-2 text-center align-middle",children:"Max Score"})]})}),e.jsx(Ir,{children:l?e.jsx(ce,{children:e.jsx(V,{colSpan:4,className:"p-4 text-center text-gray-500",children:"Loading competency data..."})}):r?e.jsx(ce,{children:e.jsx(V,{colSpan:4,className:"p-4 text-center text-red-500",children:r})}):s.length===0?e.jsx(ce,{children:e.jsx(V,{colSpan:4,className:"p-4 text-center text-gray-500 font-semibold",children:"No competency data available for the selected quarter."})}):s.map((t,m)=>e.jsx(ke.Fragment,{children:t.details.map((i,o)=>e.jsxs(ce,{children:[o===0&&e.jsx(V,{className:"border border-gray-400 p-2 font-bold",rowSpan:t.details.length,children:t.operations_and_process}),e.jsx(V,{className:"border border-gray-400 p-2",children:i.describe_expectations}),e.jsx(V,{className:"border border-gray-400 p-2 text-center",children:i.min_score}),e.jsx(V,{className:"border border-gray-400 p-2 text-center",children:i.max_score})]},o))},m))})]}),$r=async(s,r,l)=>{try{const t=await J({url:`/operation_and_process?department_id=${s}&team_id=${r}&year=${l}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},Or=()=>{const[s,r]=a.useState([]),[l,t]=a.useState(""),[m,i]=a.useState(!0),o=async()=>{try{const x=localStorage.getItem("selectedDepartmentID"),v=localStorage.getItem("selectedTeamID"),S=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),p=await $r(x,v?Number(v):null,S?Number(S):null);r(p.data||{})}catch(x){console.error("Error fetching data:",x),t("Failed to load data. Please try again.")}finally{i(!1)}};a.useEffect(()=>{o()},[]);const h=pe(x=>x.quaterTab.selectedQuarter),b=s[h];return console.log(b),e.jsxs("div",{className:"mt-8",children:[e.jsx(kr,{}),e.jsx(Cr,{filteredData:b||[],error:l,loading:m})]})},Fr=async(s,r,l)=>{try{const t=await J({url:`/form_a_comments?department_id=${s}&team_id=${r}&year=${l}`,method:"get"});return console.log(t),t}catch(t){throw console.error("Error fetching information data:",t),t}},Ar=async s=>{try{const r=await J({url:"/form_a_comments",method:"post",data:s});return console.log(r),r}catch(r){throw console.error("Error fetching information data:",r),r}},Rr=()=>{const s=Re(),[r,l]=a.useState(null),[t,m]=a.useState(!0),[i,o]=a.useState(null),[h,b]=a.useState([]),[x,v]=a.useState(""),[S,p]=a.useState(!1),[F,R]=a.useState({declaration:null,date:null,signature:null,flag:0}),T=a.useRef(null);a.useEffect(()=>{(async()=>{try{const k=localStorage.getItem("selectedDepartmentID")||"",A=localStorage.getItem("selectedTeamID"),Q=localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),C=await Fr(k,A?Number(A):null,Q);if(C&&C.data)l(C.data);else throw new Error("Invalid response data")}catch(k){console.error("Error fetching data:",k),o("Failed to load data. Please try again.")}finally{m(!1)}})()},[]);const O=async()=>{var w,k,A,Q;if(!x.trim()){p(!0),(w=T.current)==null||w.scrollIntoView({behavior:"smooth",block:"center"}),(k=T.current)==null||k.focus(),le.push(e.jsx(de,{type:"warning",children:"Appraisee's Comments is required"}),{placement:"top-center"});return}p(!1);try{const C=F.date instanceof Date?F.date.toISOString().split("T")[0]:null,H={department_id:localStorage.getItem("selectedDepartmentID")||"",team_id:localStorage.getItem("selectedTeamID"),year:localStorage.getItem("selectedYear")?Number(localStorage.getItem("selectedYear")):new Date().getFullYear(),evidence_ids:h,comment:x,date:C,signature:F.signature,declaration:F.declaration,flag:F.flag};(await Ar(H)).status===200?le.push(e.jsx(de,{title:"Success",type:"success",children:"Data submitted successfully!"}),{placement:"top-center"}):le.push(e.jsx(de,{title:"Error",type:"danger",children:"Unexpected server response"}),{placement:"top-center"})}catch(C){const H=((Q=(A=C.response)==null?void 0:A.data)==null?void 0:Q.error)||C.message||"An unexpected error occurred.";le.push(e.jsx(de,{title:"Error",type:"danger",children:H}),{placement:"top-center"})}},j=()=>s(-1),W=()=>s("/form/review");return t?e.jsx("div",{children:"Loading..."}):i?e.jsx("div",{className:"text-red-500",children:i}):e.jsxs("div",{className:"mt-4 mx-auto w-full",children:[e.jsx(He,{data:r,commentInputRef:T,setSelectedEvidenceIds:b,setCommentText:v,showValidationError:S,setDeclarationData:R}),e.jsx(qe,{back:"Back",handleBack:j,save:"Save",handleSave:O,next:"Next",handleNext:W})]})},Zr=()=>e.jsxs("div",{children:[e.jsx(Ue,{}),e.jsx(xr,{}),e.jsx(Tr,{}),e.jsx(Or,{}),e.jsx(Rr,{})]});export{Zr as default};
